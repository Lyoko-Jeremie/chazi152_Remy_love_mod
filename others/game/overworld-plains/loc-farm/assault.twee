:: Farm Assault
<<set $outside to 1>><<set $location to "alex_farm">><<effects>>
<<farm_work_update>>
<<if $farm_assault.movement is "field">>
	你低姿前进，匆忙穿过农场。
<<elseif $farm_assault.movement is "tower">>
	你尽可能放低身段，向瞭望塔的方向跑去。
<<elseif $farm_assault.movement is "climb">>
	你爬上瞭望塔。楼梯在你的脚下嘎吱作响。
<<elseif $farm_assault.movement is "wait">>
	你在阴影中等待，观察着入侵者的动向。
<<elseif $farm_assault.movement is "struggle">>
	<<if $farm_assault.bindings lte 0>>
		你试图挣脱身上的绑带。<span class="green">它们松动了。</span>
		<<if $worn.face.type.includes("gag")>>你把嘴上的东西扯了下来。<</if>>
		<<if $farm_assault.alex is "bound">>
			<<npc Alex>><<person1>>
			你看到了不远处的艾利克斯，你撕开了<<his>>嘴上的胶布，并帮<<his>>松绑。"一帮混蛋,"<<he>>站起来，"我们没时间可以浪费了。"
			<<set $farm_assault.bindings_alex to 0>>
			<<set $farm_assault.alex to "patrol">>
			<<endevent>>
		<</if>>
		<<farm_assault_unbind>>
	<<else>>
		你试图挣脱身上的绑带。<span class="teal">它们似乎有一点松动。</span>
	<</if>>
<<else>>
	你监视着四周，观察着入侵者的动向
<</if>>
<<set $farm_assault.movement to "none">>
<br><br>

<<farm_assault_progress>>

<<farm_assault_alex>>

<<if _smoke>>
	<span class="red">风中传来了物品燃烧的气味。</span>
	<br><br>
<</if>>

<<if $farm_assault.tower is "manned" or $farm_assault.tower is "attacked" or _guard_won is true or _guard_lost is true>>
	<<farm_assault_info guard>>
<<elseif $farm_assault.tower is "defeated">>
	<span class="red">$farm.tower_guard 被击败了，在当前的入侵结束前将无法提供帮助。</span>
	<br><br>
<</if>>

<<if $bus is "tower_top">>
	<<farm_assault_info>>
<</if>>

<<if _dogs_status is "victorious">>
	<span class="green">你听见猎犬们胜利的嚎叫声。</span>
	<br><br>
<<elseif _dogs_status is "defeated">>
	<span class="red">你听见猎犬们惊慌失措的叫声。</span>
	<br><br>
<</if>>

<<if $farm_destroyed is true>>
	<<farm_assault_unbind>>
	<<if $fields_damaged is 0>>
		<span class="purple">由于无地可烧，暴徒们撤出了农田。</span><<lcontrol>><<gtrauma>><<control -10>><<trauma 6>>
		<br><br>
		<<npc Remy>><<person1>>
		雷米在山头上观察着整个过程。<<He>>掉转马头，转身离开。
		<br><br>
		<<endevent>>
		<<link [[继续|Farm Assault Victory]]>><</link>>
		<br>
	<<else>>
		<span class="red">暴徒们的任务完成了，他们撤出了农田，只留下了一片被燃烧殆尽的废墟。</span>
		<<lllcontrol>><<gggtrauma>><<control -50>><<trauma 24>>
		<br><br>
		<<npc Remy>><<person1>>
		雷米在山头上观察着整个过程。<<He>>掉转马头，转身离开。
		<br><br>
		<<endevent>>
		<<link [[继续|Farm Assault Defeat]]>><</link>>
		<br>
	<</if>>
<<elseif _farm_assault_active isnot true>>
	<<farm_assault_unbind>>
	<span class="green">暴徒们丢盔弃甲，逃离了农场。</span>
	<<if $fields_damaged gte 2>>
		<span class="pink">他们设法点燃了<<number $fields_damaged>>块农田。</span><<llcontrol>><<ggtrauma>><<control -25>><<trauma 12>>
	<<elseif $fields_damaged gte 1>>
		<span class="blue">他们只点燃了一块农田。</span><<lcontrol>><<gtrauma>><<control -10>><<trauma 6>>
	<<else>>
		<span class="green">他们没能破坏哪怕一块农田。</span><<ggcontrol>><<lltrauma>><<control 25>><<trauma -25>>
		<<if $farm_stage gte 12>>
			<<earnFeat "Heroic Victory">>
		<</if>>
	<</if>>
	<br><br>
	<<npc Remy>><<person1>>
	雷米在山头上观察着整个过程。<<He>>掉转马头，转身离开。
	<br><br>
	<<endevent>>
	<<link [[继续|Farm Assault Victory]]>><</link>>
	<br>
<<else>>

	<<farm_assault_actions>>

<</if>>


:: Farm Assault Defeat
<<effects>>

<<npc Alex>><<person1>>
你在田地里发现了不省人事的艾利克斯。<<his>>头朝下栽在地里，身边有一个已经空了的瓶子。<<llldom>><<npcincr Alex dom -15>>
<br><br>

<<if $farm_assault.tower is "defeated">>
	你设法把<<him>>带回了小屋，将<<him>>安置在床上，然后动身去寻找$farm.tower_guard。
	<<endevent>>
	<<loadNPC 0 "farm_tower_guard">><<person1>>
	你看见<<him>>坐在瞭望塔的底部，
	<<if $NPCList[0].traits.includes("relaxed")>>
		正试着点燃一根捡来的烟屁股。"这活可比我想象中难多了,"<<he>>说，"能拉我一把不？"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		正在跟别人打电话。"-老大来了，一会再打给你。"<<He>>冲你笑了笑："你真该看看我是怎么放倒那几个杂种的——在更多人过来之前。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		盯着天空。"抱歉，老大"<<he>>看到了你，"我已经尽力了。"
	<<else>>
		看着你走近。"是天使来带我上天堂了吗？"<<he>>哈哈大笑。
	<</if>>
	你帮<<him>>起身。
	<<if $NPCList[0].traits.includes("relaxed")>>
		"我没事"<<he>>继续说，"伸展伸展腿脚就好了。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"那里面有把椅子"<<he>>指了指瞭望塔，"我得稍微休息一下。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"不用担心我"<<he>>说，"我能照顾好自己。"
	<<else>>
		"光是碰碰你的小手就已经快治好我了，"<<he>>继续说，"我甚至觉得现在就能回到岗位上去了。"
	<</if>>
	<br><br>
	你回到了小屋。雷米赢了这一回合，但战争还没有结束。
	<br><br>
<<elseif $farm_assault.tower is "manned" or $farm_assault.tower is "attacked">>
	$farm.tower_guard 一瘸一拐的走了过来。

	<<endevent>>
	<<loadNPC 0 "farm_tower_guard">><<person1>>

	<<if $NPCList[0].traits.includes("relaxed")>>
		"我们一起把<<nnpc_him Alex>>抬进去，"<<he>>指了指地上的艾利克斯，"然后我得去找根烟清醒清醒。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"<<nnpc_he Alex>>还好吧？"<<he>>问道，然后注意到了地上的瓶子，"啊。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"抱歉，老大"<<he>>说，"至少你还没事。我们把<<nnpc_him Alex>>抬进屋里吧。"
	<<else>>
		"一团乱啊，"<<he>>说："睡一觉是挺好的，就是这地方可不太对。"
	<</if>>
	<br><br>

	<<endevent>>
	<<npc Alex>><<person1>>
	你们一起把艾利克斯抬回了小屋，把<<him>>安置在床上。雷米赢了这一回合，但战争还没有结束。
	<br><br>
<<else>>
	你把<<him>>带回了小屋，把<<him>>安置在床上。雷米赢了这一回合，但战争还没有结束。
	<br><br>
<</if>>

<<unset $fields_damaged>>
<<unset $farm_destroyed>>
<<farm_assault_end>>

<<link [[继续|Farm Bedroom]]>><<endevent>><</link>>
<br>

:: Farm Assault Victory
<<effects>>

<<npc Alex>><<person1>>

<<if $farm_destroyed is true>>
	"最好别他妈让我再看见你们"艾利克斯朝他们吼道。<<He>>转身向你："很高兴这次他们只是白白浪费了自己的时间，但我们真的不应该让他们继续在农场里横行霸道了。"
	<br><br>
<<elseif $fields_damaged gte 1>>
	"最好别他妈让我再看见你们"艾利克斯朝他们吼道。<<He>>转身向你，又看了看身后冒着浓烟的农田："至少我们控制住了损失，"<<he>>说，"我们下次会准备得更加充分。"
	<br><br>
<<else>>
	"最好别他妈让我再看见你们"艾利克斯朝他们吼道。<<He>>转身向你，浑身是泥，却难掩<<his>>的兴奋之情："我们做到了，以后也一定都能做到！"
	<br><br>
<</if>>

<<if $farm_assault.tower is "defeated">>
	<<He>>看向瞭望塔的方向："操，我希望 $farm.tower_guard 没事。"
	<br><br>
	<<endevent>>
	<<loadNPC 0 "farm_tower_guard">><<person1>>
	你们看见守卫坐在瞭望塔的底部，
	<<if $NPCList[0].traits.includes("relaxed")>>
		正试着点燃一根捡来的烟屁股。"这活可比我想象中难多了,"<<he>>说，"能拉我一把不？"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		正在跟别人打电话。"-老大来了，一会再打给你。"<<He>>冲你咧了咧嘴："你真该看看我是怎么放倒那几个杂种的——在更多人过来之前。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		盯着天空。"抱歉，老大"<<he>>看到了你，"我已经尽力了。"
	<<else>>
		看着你走近。"天使们要来带我上天堂了吗？"<<he>>哈哈大笑。
	<</if>>
	你和艾利克斯帮<<him>>起身。
	<<if $NPCList[0].traits.includes("relaxed")>>
		"我没事"<<he>>继续说，"伸展伸展腿脚就好了。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"那里面有把椅子"<<he>>指了指瞭望塔，"我得稍微休息一下。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"不用担心我"<<he>>说，"我能照顾好自己。"
	<<else>>
		"光是碰碰你的小手就已经快治好我了，"<<he>>继续说，"我甚至觉得现在就能回到岗位上去了。"
	<</if>>
	<br><br>

<<elseif $farm_assault.tower is "manned" or $farm_assault.tower is "attacked">>
	你看到 $farm.tower_guard 走了过来。
	<<endevent>>
	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<if $NPCList[0].traits.includes("relaxed")>>
		"很高兴看到你们都没事，"<<he>>说，"刚才可真惊险啊。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"事情变得有趣了，"<<he>>说道。"我想我需要喘口气。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"干得好，"<<he>>说道。"希望我有帮到忙。"
	<<else>>
		"你应该看到我在那上面的样子，"<<he>>说道。"三个——"<<he>>停顿了一下。"我是说，五个，壮硕的怪物攀爬着塔的一侧，但我让他们离开了。"
	<</if>>
	<br><br>
<<else>>

<</if>>

<<endevent>>
<<npc Alex>><<person1>>
你们一起走回小屋。
<<if isLoveInterest("Alex")>>
	艾利克斯搂着你的肩。
<<else>>
	艾利克斯拍了拍你的肩膀。
<</if>>
"我们赢了，但雷米还会再回来的。我们会做好准备。"
<br><br>
<span class="red">雷米将在<<number $farm_attack_timer>>天后再次攻击。</span>
<br><br>

<<unset $fields_damaged>>
<<unset $farm_destroyed>>
<<farm_assault_end>>

<<link [[继续|Farm Cottage]]>><<endevent>><</link>>
<br>

:: Farm Assault Intro
<<effects>>
<<set $bus to "yard">>
<<farm_assault_init>>

你冲了出去，发现艾利克斯站在院子里。
<br><br>
<<set $farm_attack_timer to random(17, 24)>>
<<npc Alex>><<person1>>
"他们不会从这里通过，"<<he>>点点头，指着路。"他们会试图潜入。"<<he>>递给你一台对讲机。"地面很广阔，所以我们需要分开搜索。但如果我们联合起来对抗他们，我们会更强大。"

<<if $farm.tower gte 2 and $farm.tower_guard>>
	<<He>>向守望塔挥手，$farm.tower_guard回应地闪了一下搜索灯。
<<elseif $farm.tower and $farm.tower_guard>>
	<<He>>向守望塔挥手，你看到$farm.tower_guard回应地挥手。
<<elseif $farm.tower>>
	<<He>>指着守望塔。"如果需要更好的视野，我们可以爬上去。"
<</if>>
<br><br>

<<if $leftarm is "bound" or $rightarm is "bound">>
	艾利克斯解开了绑着你的东西。你不能那样保卫农场。
	<<unbind>>
	<br><br>
<</if>>

<<link [[继续|Farm Assault]]>><<endevent>><</link>>
<br>



:: Farm Assault Wardrobe
<<effects>>

<<if $phase is 2>>
	你走进小屋，爬上楼梯，打开古朴的衣橱。
<<elseif $phase is 1>>
	你从床上爬起来，打开古朴的衣橱。
<<elseif $phase is 3>>
	你进入你的房间，打开古朴的衣橱。
<<else>>
	你查看了一下古朴的衣橱。
<</if>>
<<set $phase to 0>>
你听到外面有人喊叫。
<br><br>
<<set $wardrobe_location to "alexFarm">>
<<wardrobeSelection>>
<<wardrobewear>>
<div id="wardrobeExits"><<wardrobeExits>></div>
<<wardrobe>>

:: Farm Assault Widgets [widget]
<<widget "farm_assault_init">>
	<<set $farm_assault to {}>>
	<<set $farm_assault.no to [0, 1, 2, 3]>>
	<<if $farm_stage gte 8>>
		<<set $farm_assault.no.push(4)>>
	<</if>>
	<<if $farm_stage gte 9>>
		<<set $farm_assault.no.push(5)>>
	<</if>>
	<<if $farm_stage gte 10>>
		<<set $farm_assault.no.push(6)>>
	<</if>>
	<<if $farm_stage gte 11>>
		<<set $farm_assault.no.push(7)>>
	<</if>>
	<<if $farm_stage gte 12>>
		<<set $farm_assault.no.push(8)>>
	<</if>>
	<<set $farm_assault.teams to {}>>

	<<if $farm_stage gte 12>>
		<<set $farm_assault.teams.team_1 to {}>>
		<<set $farm_assault.teams.team_2 to {}>>
		<<set $farm_assault.teams.team_3 to {}>>
		<<set $farm_assault.teams.team_4 to {}>>
		<<set $farm_assault.teams.team_5 to {}>>
		<<if $bailey_encroach>>
			<<set $farm_assault.teams.team_6 to {}>>
			<<set $farm_assault.teams.team_6.type to "bailey">>
		<</if>>
	<<elseif $farm_stage gte 10>>
		<<set $farm_assault.teams.team_1 to {}>>
		<<set $farm_assault.teams.team_2 to {}>>
		<<set $farm_assault.teams.team_3 to {}>>
		<<set $farm_assault.teams.team_4 to {}>>
		<<if $bailey_encroach>>
			<<set $farm_assault.teams.team_5 to {}>>
			<<set $farm_assault.teams.team_5.type to "bailey">>
		<</if>>
	<<elseif $farm_stage gte 8>>
		<<set $farm_assault.teams.team_1 to {}>>
		<<set $farm_assault.teams.team_2 to {}>>
		<<set $farm_assault.teams.team_3 to {}>>
		<<if $bailey_encroach>>
			<<set $farm_assault.teams.team_4 to {}>>
			<<set $farm_assault.teams.team_4.type to "bailey">>
		<</if>>
	<<else>>
		<<set $farm_assault.teams.team_1 to {}>>
		<<set $farm_assault.teams.team_2 to {}>>
		<<if $bailey_encroach>>
			<<set $farm_assault.teams.team_3 to {}>>
			<<set $farm_assault.teams.team_3.type to "bailey">>
		<</if>>
	<</if>>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
		<<set $farm_assault.teams[_assault_keys[_s]].wall_progress to 0>>
		<<set $farm_assault.teams[_assault_keys[_s]].field_progress to 0>>
		<<set $farm_assault.teams[_assault_keys[_s]].number to 3>>
		<<if $wraith.state is "haunt" and $farm_assault.wraith is undefined and $hallucinations gte 2 and random(1,15-Math.floor(C.npc["Ivory Wraith"].lust/5)) is 1>>
			<<set $farm_assault.teams[_assault_keys[_s]].type to "wraith">>
			<<set $farm_assault.teams[_assault_keys[_s]].number to 1>>
			<<set $farm_assault.teams[_assault_keys[_s]].torched to 0>>
			<<set $farm_assault.wraith to _s>>
		<</if>>
		<<if !$farm_assault.teams[_assault_keys[_s]].type>>
			<<set $farm_assault.teams[_assault_keys[_s]].type to "remy">>
		<</if>>
	<</for>>
	<<set $fields_damaged to 0>>
	<<if $farm.kennel gte 1>>
		<<set $farm_assault.dogs to 2>>
	<<else>>
		<<set $farm_assault.dogs to 1>>
	<</if>>
	<<set $farm_assault.dogs_state to "guarding">>
	<<if $farm.tower_guard>>
		<<set $farm_assault.tower to "manned">>
	<<else>>
		<<set $farm_assault.tower to "empty">>
	<</if>>
	<<set $farm_assault.alex to "patrol">>
<</widget>>

<<widget "farm_assault_end">>
	<<unset $farm_assault>>
	<<unset $fields_damaged>>
	<<unset $farm_destroyed>>
<</widget>>

<<widget "farm_assault_progress">>
	<<set $farm_assault_done to 0>>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $farm_assault.teams[_assault_keys[_s]].state is undefined>>
			<<set $farm_assault.teams[_assault_keys[_s]].state to "wall">>
		<</if>>
		/*Fleeing checked before and after other actions. */
		<<farm_assault_flight>>
		<<if $farm_assault.teams[_assault_keys[_s]].location isnot "done">>
			/*Assaulting the tower. */
			<<if $farm_assault.teams[_assault_keys[_s]].location is "tower">>
				<<if $farm_assault.teams[_assault_keys[_s]].state is "approach">>
					<<set $farm_assault.teams[_assault_keys[_s]].state to "climb">>
				<<elseif $farm_assault.teams[_assault_keys[_s]].state is "climb">>
					<<set $farm_assault.teams[_assault_keys[_s]].state to "fight">>
				<<elseif $farm_assault.teams[_assault_keys[_s]].state is "fight">>
					<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
						<<if $farm.tower_guard_skill gte random(1, 2000)>>
							<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
							<<if $farm_assault.teams[_assault_keys[_s]].number lte 0>>
								<<set $farm_assault.tower to "manned">>
							<</if>>
							<<set _guard_won to true>>
						<<else>>
							<<set $farm_assault.tower to "defeated">>
							<<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
							<<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
							<<set _guard_lost to true>>
						<</if>>
					<<else>>
						<<if $farm.tower_guard_skill gte random(1, 1000)>>
							<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
							<<if $farm_assault.teams[_assault_keys[_s]].number lte 0>>
								<<set $farm_assault.tower to "manned">>
							<</if>>
							<<set _guard_won to true>>
						<<else>>
							<<set $farm_assault.tower to "defeated">>
							<<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
							<<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
							<<set _guard_lost to true>>
						<</if>>
					<</if>>
				<</if>>
			<</if>>
			/*Successfully burning. */
			<<if $farm_assault.teams[_assault_keys[_s]].state is "celebrate">>
				<<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
				<<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
				<<if $farm_assault.teams[_assault_keys[_s]].location is undefined or $farm_assault.teams[_assault_keys[_s]].torched gte Math.floor(C.npc["Ivory Wraith"].lust/4)>>
					<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
				<</if>>
			<</if>>
			/*Burning a field. */
			<<if $farm_assault.teams[_assault_keys[_s]].state is "field">>
				<<if $farm_assault.teams[_assault_keys[_s]].field_progress gte 4>>
					<<set $farm_assault.teams[_assault_keys[_s]].field_progress to 0>>
					<<set $farm_assault.teams[_assault_keys[_s]].state to "celebrate">>
					<<set _smoke to true>>
					<<damage_farm "target" $farm_assault.teams[_assault_keys[_s]].location>>
					<<if $farm_assault.teams[_assault_keys[_s]].type is "wraith">>
						<<set $farm_assault.teams[_assault_keys[_s]].torched++>>
					<</if>>
				<<else>>
					<<set $farm_assault.teams[_assault_keys[_s]].field_progress++>>
					<<if $farm_assault.teams[_assault_keys[_s]].type is "wraith" and random(0,1) is 1>>
						<<set $farm_assault.teams[_assault_keys[_s]].field_progress++>>
					<</if>>
				<</if>>
			<</if>>
			/*Responding to hounds. */
			<<if $farm_assault.teams[_assault_keys[_s]].state is "dogs_recover">>
				<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
					<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
					<<if $farm_assault.tower is "manned">>
						<<set $farm_assault.no.push($farm_assault.teams[_assault_keys[_s]].location)>>/*Add their location back to the pool.*/
						<<set $farm_assault.teams[_assault_keys[_s]].location to "tower">>
						<<set $farm_assault.teams[_assault_keys[_s]].state to "approach">>
						<<set $farm_assault.tower to "attacked">>
					<<else>>
						<<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
					<</if>>
				<<else>>
					<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
				<</if>>
				<<set $farm_assault.dogs -= 1>>
				<<if $farm_assault.dogs gte 1>>
					<<set $farm_assault.dogs_state to "guarding">>
					<<set _dogs_status to "victorious">>
				<<else>>
					<<set $farm_assault.dogs_state to "defeated">>
					<<set _dogs_status to "defeated">>
				<</if>>
				<<set $farm_assault.dogs_target to _assault_keys[_s]>>
			<</if>>
			/*Intercepted by hounds. */
			<<if $farm_assault.teams[_assault_keys[_s]].state is "dogs">>
				<<set $farm_assault.teams[_assault_keys[_s]].state to "dogs_recover">>
			<</if>>
			/*Entering. */
			<<if $farm_assault.teams[_assault_keys[_s]].state is "entry">>
				<<if $farm_assault.dogs gte 1 and $farm_assault.dogs_state is "guarding" and $farm_assault.teams[_assault_keys[_s]].type isnot "wraith">>
					<<set $farm_assault.teams[_assault_keys[_s]].state to "dogs">>
					<<set $farm_assault.dogs_state to "fighting">>
				<<elseif ($farm_assault.teams[_assault_keys[_s]].type is "bailey" or random(1, 2) is 2) and $farm_assault.tower is "manned" and $farm_assault.teams[_assault_keys[_s]].type isnot "wraith">>
					<<set $farm_assault.no.push($farm_assault.teams[_assault_keys[_s]].location)>>/*Add their location back to the pool.*/
					<<set $farm_assault.teams[_assault_keys[_s]].location to "tower">>
					<<set $farm_assault.teams[_assault_keys[_s]].state to "approach">>
					<<set $farm_assault.tower to "attacked">>
				<<else>>
					<<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
				<</if>>
			<</if>>
			/*Breaking in. */
			<<if $farm_assault.teams[_assault_keys[_s]].state is "wall">>
				<<if $farm_assault.teams[_assault_keys[_s]].wall_progress gte $farm.wall>>
					<<set $farm_assault.teams[_assault_keys[_s]].state to "entry">>
					<<set $farm_assault.teams[_assault_keys[_s]].wall_progress to 0>>
				<<else>>
					<<if $farm_assault.teams[_assault_keys[_s]].type is "wraith">>
						<<set $farm_assault.teams[_assault_keys[_s]].wall_progress to $farm.wall>>
					<<elseif $farm.wall gte 4 and $farm_assault.teams[_assault_keys[_s]].type isnot "bailey">>
						<<if random(1, 3) is 3>>
							<<set $farm_assault.teams[_assault_keys[_s]].wall_progress++>>
						<</if>>
					<<elseif $farm.wall gte 3 and $farm_assault.teams[_assault_keys[_s]].type isnot "bailey">>
						<<if random(1, 3) gte 2>>
							<<set $farm_assault.teams[_assault_keys[_s]].wall_progress++>>
						<</if>>
					<<else>>
						<<set $farm_assault.teams[_assault_keys[_s]].wall_progress++>>
					<</if>>
				<</if>>
			<</if>>
		<</if>>
		/*Fleeing. */
		<<farm_assault_flight>>
		/*Alex. */
		<<if $farm_assault.alex is "patrol">>
			<<if $farm_assault.teams[_assault_keys[_s]].location isnot "done" and $farm_assault.teams[_assault_keys[_s]].type isnot "wraith">>
				<<set $farm_assault.alex to _assault_keys[_s]>>
			<</if>>
		<<elseif $farm_assault.alex is _assault_keys[_s]>>
			<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
				<<if random(1, 100) gte 80>>
					<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
					<<set _alex_success to true>>
				<</if>>
			<<else>>
				<<if random(1, 100) gte 60>>
					<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
					<<set _alex_success to true>>
				<</if>>
			<</if>>
		<</if>>
		/*Fleeing. */
		<<farm_assault_flight>>
	<</for>>
<</widget>>

<<widget "farm_assault_flight">>
	<<if $farm_assault.teams[_assault_keys[_s]].number lte 0>>/*Flee if numbers reduced to 0.*/
		<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<<if $farm_assault.alex is _assault_keys[_s]>>/*Alex patrols again. */
			<<set $farm_assault.alex to "patrol">>
		<</if>>
	<</if>>
	<<if $farm_assault.teams[_assault_keys[_s]].location isnot "done">>/*Assault ends when !_farm_assault_active.*/
		<<set _farm_assault_active to true>>
	<<elseif $farm_assault.teams[_assault_keys[_s]].location gte 0>>
		<<set $farm_assault.no.push($farm_assault.teams[_assault_keys[_s]].location)>>/*Add their location back to the pool.*/
		<<if $farm_assault.alex is _assault_keys[_s]>>/*Alex patrols again. */
			<<set $farm_assault.alex to "patrol">>
		<</if>>
	<<elseif $farm_assault.alex is _assault_keys[_s] and $farm_assault.teams[_assault_keys[_s]].location is "done">>
		<<set $farm_assault.alex to "patrol">>
	<</if>>
<</widget>>

<<widget "farm_assault_info">>
	<<if _args[0] is "guard">>
		<<set _skill to $farm.tower_guard_skill>>
	<<else>>
		<<set _skill to 0>>
	<</if>>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $farm_assault.teams[_assault_keys[_s]].location is "tower" and $farm_assault.teams[_assault_keys[_s]].state is "fight">>
			<<set _fighting to true>>
		<</if>>
	<</for>>

	<<if _fighting is true or _guard_won is true or _guard_lost is true>>
		你的对讲机接收到另一个信号。<span class="red">你听到一阵斗争声，伴随着静电。</span>
		<<if _guard_won is true>>
			你凝视着守望塔。一个身影从塔顶摔下来。<span class="green">那不是 $farm.tower_guard。</span>看起来他们制服了其中一个攻击者。
		<<elseif _guard_lost is true>>
			你凝视着守望塔。一个身影从塔顶摔下来。<span class="red">那是 $farm.tower_guard。</span>他们不会在剩余的攻击中提供帮助。
		<</if>>
		<br><br>
	<<else>>
		<<if _args[0] is "guard">>
			你的对讲机接收到另一个信号， $farm.tower_guard让你了解敌人的活动情况:
		<<else>>
			你看着农场，试图发现敌人的动向:
		<</if>>
		<br>
		<<set _assault_keys to Object.keys($farm_assault.teams)>>
		<<for _s to 0; _s lt _assault_keys.length; _s++>>
			<<if $farm_assault.teams[_assault_keys[_s]].type is "wraith">>
				<<if $farm_assault.teams[_assault_keys[_s]].location is "done">>
					<span class="green"><<farm_assault_thugs>>离开了，<<print $wraith.seenFarm ? "它" : "它们">>似乎失去了兴趣。</span>
					<<if $wraith.seen gte 5 and !$farm_assault.wraithStress>>
						<<stress -6>><<lstress>><<set $farm_assault.wraithStress to true>>
					<</if>>
				<<else>>
					<<if _skill gte random(400, 1400) or !$wraith.seenFarm>>
						<<switch $farm_assault.teams[_assault_keys[_s]].state>>
						<<case wall>>
							<<farm_assault_thugs>>正在<span class="purple">穿过<<print $farm.wall gte 3 ? "围栏" : "墙">></span>。
						<<case entry>>
							<<farm_assault_thugs>>正蹒跚着朝<<farm_assault_location>>走去。
						<<case field>>
							<<if $farm_assault.teams[_assault_keys[_s]].field_progress lte 1>>
								<span class="blue"><<farm_assault_thugs>>进入了<<farm_assault_location>>.</span>
							<<else>>
								<span class="blue"><<farm_assault_thugs>>在<<farm_assault_location>>徘徊.</span>
							<</if>>
						<<case celebrate>>
							<<farm_assault_thugs>>完全静止.<span class="red"><<farm_assault_location "cap">>着火了.</span>
						<</switch>>
					<<else>>
						<<farm_assault_location>>似乎有些不对劲。
					<</if>>
				<</if>>
			<<else>>
				<<if $farm_assault.teams[_assault_keys[_s]].location is "done">>
					<span class="green">一伙<<farm_assault_thugs>>正朝山丘溃退。</span>
				<<elseif $farm_assault.teams[_assault_keys[_s]].state is "dogs">>
					你听到了<<farm_assault_location>>里的狗叫声。
				<<elseif $farm_assault.teams[_assault_keys[_s]].location is "tower">>
					<<switch $farm_assault.teams[_assault_keys[_s]].state>>
					<<case "approach">>
						<span class="purple">一伙<<farm_assault_thugs>>正接近瞭望塔。</span>
					<<case "climb">>
						<span class="pink">一伙<<farm_assault_thugs>>正在登上瞭望塔。</span>
					<</switch>>
				<<else>>
					<<if _skill gte random(1, 1000)>>
						<<switch $farm_assault.teams[_assault_keys[_s]].state>>
						<<case wall>>
							一伙<<farm_assault_thugs>>正在
							<<if $farm.wall gte 3>>
								<span class="pink">破坏</span>在<<farm_assault_location>>的围栏。
							<<else>>
								攀爬着<<farm_assault_location>>附近的墙。
							<</if>>
						<<case entry>>
							一伙<<farm_assault_thugs>>正冲进<<farm_assault_location>>。
						<<case field>>
						<<switch $farm_assault.teams[_assault_keys[_s]].field_progress>>
						<<case 0>>
								<span class="blue">一伙<<farm_assault_thugs>>正在进入<<farm_assault_location>>。</span>
						<<case 1>>
								<span class="purple">一伙<<farm_assault_thugs>>在<<farm_assault_location>>打开了汽油罐。</span>
						<<case 2>>
								<span class="pink">一伙<<farm_assault_thugs>>正在<<farm_assault_location>>浇洒汽油。</span>
						<<case 3>>
								<span class="red">一伙<<farm_assault_thugs>>在<<farm_assault_location>>点燃了火柴。</span>
						<</switch>>
						<<case celebrate>>
							<span class="red">一伙<<farm_assault_thugs>>正在沉醉在田野燃烧的欢愉中。</span>
						<</switch>>
					<<else>>
						<<farm_assault_location>>有动静。
					<</if>>
				<</if>>
			<</if>>
			<br>
		<</for>>
		<br>
	<</if>>
<</widget>>

<<widget "farm_assault_alex">>
	<<if _farm_assault_active isnot true or $farm_destroyed is true>>
	<<elseif $farm_assault.alex is "bound">>
		<<if $farm_assault.bindings_alex gte 1>>
			<<set $farm_assault.bindings_alex -= 1>>
		<<else>>
			<<set $farm_assault.alex to "patrol">>
		<</if>>
	<<elseif $farm_assault.alex is "patrol">>
		你的对讲机接收到了信号。"我正在寻找入侵者，" 艾利克斯说道。"只是汇报一下。"
	<<else>>
		<<set _assault_keys to Object.keys($farm_assault.teams)>>
		<<for _s to 0; _s lt _assault_keys.length; _s++>>
			<<if $bus is $farm_assault.teams[_assault_keys[_s]].location and $farm_assault.alex is _assault_keys[_s]>>
				<span class="teal">艾利克斯蹲在你旁边。</span> "有什么计划吗？"
			<<elseif $farm_assault.alex is _assault_keys[_s]>>
				你的对讲机接收到了信号。"我正在<<farm_assault_location>><<print either("追赶","跟踪","追踪","追捕","袭击")>><<farm_assault_thugs>>，"艾利克斯压低声音说道。
				<<if _alex_success>>
					<<set _rng to random(1, 5)>>
					<<switch _rng>>
					<<case 1>>
						<span class="green">"打晕了一个人。"</span>
					<<case 2>>
						<span class="green">"他们明天早上会感觉到的。"</span>
					<<case 3>>
						<span class="green">"不知道他们什么时候才会发现他们失去了一个同伴。"</span>
					<<case 4>>
						<span class="green">"打倒了一个暴徒。"</span>
					<<default>>
						<span class="green">"干掉了一个。"</span>
					<</switch>>
				<<else>>
					<<set _rng to random(1, 5)>>
					<<switch _rng>>
					<<case 1>>
						<span class="blue">"我无法独自搞定他们。"</span>
					<<case 2>>
						<span class="blue">"他们太警觉了。"</span>
					<<case 3>>
						<span class="blue">"我无法靠近他们。"</span>
					<<case 4>>
						<span class="blue">"还要继续等待机会。"</span>
					<<default>>
						<span class="blue">"我不会冒任何风险。"</span>
					<</switch>>
				<</if>>
			<</if>>
		<</for>>
	<</if>>
	<br><br>
<</widget>>

<<widget "farm_assault_location">><<silently>>
	<<switch $farm_assault.teams[_assault_keys[_s]].location>>
		<<case 0>>
			<<set _text_output to "第一块农田">>
		<<case 1>>
			<<set _text_output to "第二块农田">>
		<<case 2>>
			<<set _text_output to "第三块农田">>
		<<case 3>>
			<<set _text_output to "第四块农田">>
		<<case 4>>
			<<set _text_output to "第五块农田">>
		<<case 5>>
			<<set _text_output to "第六块农田">>
		<<case 6>>
			<<set _text_output to "第七块农田">>
		<<case 7>>
			<<set _text_output to "第八块农田">>
		<<case 8>>
			<<set _text_output to "第九块农田">>
		<<case tower>>
			<<set _text_output to "瞭望塔">>
		<<default>>
			<<set _text_output to "农田">>
	<</switch>>
	<<if _args[0] is "cap">>
		<<capitalise>>
	<</if>>
<</silently>><<print _text_output>><</widget>>

<<widget "farm_assault_thugs">><<silently>>
	<<switch $farm_assault.teams[_assault_keys[_s]].type>>
		<<case "bailey">>
			<<set _text_output to "<span class=\"red\">贝利的打手</span>">>
		<<case "wraith">>
			<<if $wraith.seenFarm>>
				<<set _text_output to "<span class=\"wraith\">白色幽灵</span>">>
			<<else>>
				<<set _text_output to "<span class=\"black\">诡诈的陌生人</span>">>
			<</if>>
		<<default>>
			<<set _text_output to "<span class=\"pink\">雷米的手下</span>">>
	<</switch>>
	<<if _args[0] is "cap">>
		<<capitalise>>
	<</if>>
<</silently>><<print _text_output>><</widget>>

<<widget "farm_assault_options">>
	<<if !_noOptions>>
		<<link [[等待(0:05)|Farm Assault]]>><<pass 5>><<set $farm_assault.movement to "wait">><</link>>
		<br>
		<<if $bus is "tower" and _tower isnot "threatened" and $farm_assault.tower isnot "manned">>
			<<link [[爬上瞭望塔 (0:05)|Farm Assault]]>><<pass 5>><<set $bus to "tower_top">><<set $farm_assault.movement to "climb">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 0>>
			<<link [[第一块田(0:05)|Farm Assault]]>><<pass 5>><<set $bus to 0>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 1>>
			<<link [[第二块田(0:05)|Farm Assault]]>><<pass 5>><<set $bus to 1>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 2>>
			<<link [[第三块田 (0:05)|Farm Assault]]>><<pass 5>><<set $bus to 2>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 3>>
			<<link [[第四块田(0:05)|Farm Assault]]>><<pass 5>><<set $bus to 3>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 4 and $farm_stage gte 8>>
			<<link [[第五块田(0:05)|Farm Assault]]>><<pass 5>><<set $bus to 4>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 5 and $farm_stage gte 9>>
			<<link [[第六块田(0:05)|Farm Assault]]>><<pass 5>><<set $bus to 5>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 6 and $farm_stage gte 10>>
			<<link [[第七块田(0:05)|Farm Assault]]>><<pass 5>><<set $bus to 6>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 7 and $farm_stage gte 11>>
			<<link [[第八块田(0:05)|Farm Assault]]>><<pass 5>><<set $bus to 7>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot 8 and $farm_stage gte 12>>
			<<link [[第九块田(0:05)|Farm Assault]]>><<pass 5>><<set $bus to 8>><<set $farm_assault.movement to "field">><</link>>
			<br>
		<</if>>
		<<if $bus isnot "tower" and $bus isnot "tower_top" and $farm.tower gte 1>>
			<<link [[瞭望塔(0:05)|Farm Assault]]>><<pass 5>><<set $bus to "tower">><<set $farm_assault.movement to "tower">><</link>>
			<br>
		<</if>>
	<</if>>
<</widget>>

<<widget "farm_assault_actions">>
	<<switch $bus>>
		<<case "tower">>
			你隐约看到瞭望塔在你头上。
		<<case 0>>
			你在第一块田附近。
		<<case 1>>
			你在第二块田附近。
		<<case 2>>
			你在第三块田附近。
		<<case 3>>
			你在第四块田附近。
		<<case 4>>
			你在第五块田附近。
		<<case 5>>
			你在第六块田附近。
		<<case 6>>
			你在第七块田附近。
		<<case 7>>
			你在第八块田附近。
		<<case 8>>
			你在第九块田附近。
	<</switch>>
	<br>
	<<if $farm_assault.bindings gte 1>>
		你躺在地上，动躺不得。
		<br><br>

		<<link [[挣扎 (0:05)|Farm Assault]]>><<pass 5>><<set $farm_assault.bindings -= 1>><<set $farm_assault.movement to "struggle">><</link>>
		<br>
	<<else>>
		<<set _assault_keys to Object.keys($farm_assault.teams)>>
		<<for _s to 0; _s lt _assault_keys.length; _s++>>
			<<set $_key to _assault_keys[_s]>>
			<<set $_team to $farm_assault.teams[$_key]>>
			<<set $_isBaileyTeam to $_team.type is "bailey">>
			<<set $_isWraith to $_team.type is "wraith">>
			<<if $bus is $_team.location>>
				<<if $bus is "tower">>
					<<if $_team.state is "approach">>
						<span class="blue"><<farm_assault_thugs>>接近。</span>
						<br><br>
						<<farm_assault_attack_options>>
					<<elseif $_team.state is "climb">>
						<span class="purple">你看见<<farm_assault_thugs>>进入了塔中。</span>
						<br><br>

						<<link [[保卫瞭望塔 (0:05)|Farm Assault Tower Defend]]>><<pass 5>><</link>>
						<br>
					<<elseif $_team.state is "fight">>
						<span class="pink">你听到$farm.tower_guard fighting<<farm_assault_thugs>>在塔顶上！</span>
						<br><br>

						<<link [[保卫瞭望塔 (0:05)|Farm Assault Tower Defend]]>><<pass 5>><</link>>
						<br>
					<</if>>
				<<elseif $_team.state is "wall">>
					<<if $_isWraith>>
						你看到<<farm_assault_thugs>><span class="pink">正在通过<<print $farm.wall gte 3 ? "栅栏" : "墙">></span>。
					<<else>>
						<<if $farm.wall gte 3>>
							你看见<<farm_assault_thugs>>正在锯断栅栏。
						<<else>>
							你看见<<farm_assault_thugs>>正在翻墙。
						<</if>>
						<<if $_team.number is 1>>
							这里只有一个人。
						<<else>>
							他们有<<number $_team.number>>个人。
						<</if>>
					<</if>>
					<<if $_isBaileyTeam>>
						<span class="red">他们目的明确地移动着。</span>
					<</if>>
					<br>
					<<if $farm_assault.alex is $_key>>
						<<link [[跟艾利克斯一起扔石头 (0:05)|Farm Assault Rocks Alex]]>><<pass 5>><</link>>
						<br>
					<<else>>
						<<set $_min to ($_isBaileyTeam ? 6000 : 1)>>
						<<set $_max to ($_isBaileyTeam ? 20000 : 16000)>>
						<<link [[扔石头(0:05)|Farm Assault Rocks]]>><<pass 5>><</link>><<physiquedifficulty $_min $_max>>
						<br>
					<</if>>
					<<set $_min to ($_isBaileyTeam ? 3000 : 200)>>
					<<set $_max to ($_isBaileyTeam ? 3000 : 1000)>>
					<<link [[威胁(0:05)|Farm Assault Threaten]]>><<pass 5>><</link>><<skill_difficulty "$fame.scrap" "战斗知名度" $_min $_max>>
					<br>
				<<elseif $_team.state is "entry">>
					<<if $_isBaileyTeam>>
						<<if $_team.number gte 2>>
							你看见<<number $_team.number>>个<<farm_assault_thugs>>正冲进农场。他们无视了你，直直地冲进田里。
							<br>
							<<farm_assault_attack_options>>
						<<else>>
							你看见其中一个<<farm_assault_thugs>>冲进了农场。
							<br>
							<<farm_assault_attack_options>>
						<</if>>
					<<elseif $_isWraith>>
						<<set _noOptions to true>>
						你看见<<farm_assault_thugs>>接近了你。
						<<if !$wraithIntro>>
							<<set $wraithIntro to true>>
							那是一道美丽的苍白色身影，祂穿着半透明的白色长袍，正在用手抓着自己的脖子。祂用愤怒的赤红色眼睛盯着你。
						<<elseif !$wraith.seenFarm>>
							<span class="red">那张脸是你可怕而又熟悉的苍白。</span>
						<<else>>
							祂露出了可怕而熟悉的微笑。
						<</if>>
						祂走过的每一处地方，都留下了一道奇怪的黏糊糊的物质。
						<<set $wraith.seenFarm to true>>
						<br><br>

						"<span class="wraith">淹没在烟雾中，被火焰吞噬吧。</span>"
						<br><br>

						<<if $farm_assault.alex is $_key>>
							"我要回去看看。"艾利克斯低声说道。<span class="red">似乎完全没注意到苍白色的身影。<<nnpc_He "Alex">>压低身子离开了。</span>
							<<set $farm_assault.alex to "patrol">>
							<br><br>
						<</if>>

						<<generateWraith 1 true>>
						<<initWraith "man" "arms" "abomination">><<startWraith>>
						<br><br>

						<<link [[继续|Farm Assault Wraith Fight]]>><<set $fightstart to 1>><</link>>
					<<else>>
						<<if $_team.number gte 2>>
							你看见<<number $_team.number>>个<<farm_assault_thugs>>正冲进农场。他们无视了你，直直地冲进田里。
							<br><br>

							<<farm_assault_attack_options>>
						<<else>>
							你看见其中一个<<farm_assault_thugs>>冲进了农场。
							<br><br>

							<<farm_assault_attack_options>>
						<</if>>
					<</if>>
				<<elseif $_team.state is "dogs">>
					<span class="green">你的<<farm_text_many dog>>在黑暗中出现，并拖住了<<farm_assault_thugs>>！</span>
					<br><br>
				<<elseif $_team.state is "dogs_recover">>
					<<if $_isBaileyTeam>>
						<<if $_team.number gte 2>>
							<<if $farm_assault.dogs gte 2>>
								<<farm_assault_thugs>>看起来毫不惊慌，跟猎犬正面对抗着。第一只<<farm_text dog>>脸被提了个正着，呜咽着滚走了，但其他狗试图撕咬袭击者们的四肢。打手们甩开了它们，以浑身是血为代价。<span class="green"><<generate1>><<person1>><<person>>因为伤势太重，一瘸一拐地离开了农场。</span>
								<br><br>
							<<else>>
								<<farm_assault_thugs>>看起来毫不惊慌，跟猎犬正面对抗着。 第一只<<farm_text dog>>的<span class="red">脸被踢了个正着，</span>呜咽着滚走了，但其他狗试图撕咬袭击者的四肢。
								<br><br>
								打手们对着猎犬拳打脚踢，<span class="red">把他们吓跑了，</span>但自己也浑身是血。<span class="green"><<generate1>><<person1>><<person>>袭击者因为伤势过重，无法继续袭击农场，一瘸一拐地离开了</span>。
								<br><br>

							<</if>>
						<<else>>
							<<if $farm_assault.dogs gte 2>>
								<<generate1>><<person1>>
								那个打手，一个<<person>>，试图吠回去吓跑猎犬。一只猎犬咆哮着扑了过去，用牙咬住了那<<persons>>的手臂。<<He>>把<<farm_text dog>>甩开了，但没办法继续袭击。<<He>>抓着自己的一只手臂，<span class="green"> 逃离了田地</span>。
								<br><br>
							<<else>>
								<<generate1>><<person1>>
								那个打手，一个<<person>>，试图吠回去吓跑猎犬。一只猎犬咆哮着扑了过去，用牙咬住了<<persons>>的手臂。<span class="red"><<he>>一拳打在了<<farm_text dog>>的鼻子上，</span> 挣脱了撕咬，但无力再继续袭击。<<He>>抓着自己的一只手臂，<span class="green">逃离了田地</span>。
								<br><br>
							<</if>>
						<</if>>
					<<else>>
						<<if $_team.number gte 2>>
							<<if $farm_assault.dogs gte 2>>
								<<farm_assault_thugs>>惊慌失措地<span class="green">逃跑了。</span>猎犬们把他们一路追到<<farm_fence>>，在黑夜中胜利地咆哮着。
							<<else>>
								<<farm_assault_thugs>>惊慌失措地<span class="green">逃跑了。</span>猎犬们沉迷于追逐，<span class="red">追着他们直到被夜色吞没，</span>留下无人看守的农场。等它们回来的时候估计已经累到帮不上忙了。
							<</if>>
							<br><br>
						<<else>>
							<<generate1>><<person1>>
							<<if $farm_assault.dogs gte 2>>
								单独的<<person>>惊慌失措地<span class="green">逃跑了。</span>猎犬们把<<him>>一路追到<<farm_fence>>，在黑夜中胜利地咆哮着。
							<<else>>
								那个单独的<<person>>惊慌失措 <span class="green">逃跑了。</span> 猎犬们沉迷于追逐，<span class="red">追着<<him>>直到被夜色吞没，</span>留下无人看守的农场。等它们回来的时候估计已经累到帮不上忙了。
							<</if>>
							<br><br>
						<</if>>
					<</if>>
					<<endevent>>
					<<farm_assault_attack_options>>
				<<elseif $_team.state is "field">>
					<<if $_isWraith>>
						你看见<<farm_assault_thugs>>在田地里游荡者。
						<<if !$wraith.seenFarm>>
							他们看上去完全没在干什么。
						<<else>>
							<span class="purple">怀疑他们在倾倒着可燃的粘液。</span>
						<</if>>
					<<else>>
						<<if $_team.field_progress gte 4>>
							<span class="pink">你看见<<farm_assault_thugs>>擦着了火柴！</span>
						<<elseif $_team.field_progress gte 3>>
							<span class="purple">你看见<<farm_assault_thugs>>用汽油浇灌着田地。</span>
						<<elseif $_team.field_progress gte 2>>
							<span class="blue">你看见<<farm_assault_thugs>>打开了油罐。</span>
						<<else>>
							<span class="lblue">你看见<<farm_assault_thugs>>在田地里徘徊着。</span>
						<</if>>
					<</if>>
					<br>
					<<farm_assault_attack_options>>
				<</if>>
			<</if>>
		<</for>>

		<br>

		<<farm_assault_options>>
	<</if>>
<</widget>>

<<widget "farm_assault_intruders">>
	<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
		<<set _text_output to "入侵者">>
	<<else>>
		<<set _text_output to "入侵者">>
	<</if>>
	<<print _text_output>>
<</widget>>

<<widget "farm_assault_no">>
	<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
		来势汹汹的
	<<else>>
		<<switch _s>>
		<<case 0>>
			第一批
		<<case 1>>
			第二批
		<<case 2>>
			第三批
		<<case 3>>
			第四批
		<<case 4>>
			第五批
		<</switch>>
	<</if>>
<</widget>>

<<widget "farm_assault_unbind">>
	<<unbind>>
	<<set $farm_assault.bindings to 0>>
	<<if $worn.face.type.includes("gag")>>
		<<set $worn.face.type.push("broken")>>
		<<faceruined>>
	<</if>>
	<<clotheson>>
<</widget>>

<<widget "farm_assault_attack_options">>
	<<if $farm_assault.alex is _assault_keys[_s]>>
		<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
			<<link [[跟艾利克斯一起解决一个 (0:05)|Farm Assault Pick Alex]]>><<pass 5>><</link>>
			<br>
			<<if $pain gte 100>>
				<span class="red">你太痛了，没办法跟他们正面对抗。</span>
			<<else>>
				<<link [[跟艾利克斯一起冲锋 (0:05)|Farm Assault Charge]]>><<pass 5>><</link>>
			<</if>>
		<<elseif $farm_assault.teams[_assault_keys[_s]].number gte 1 and $farm_assault.teams[_assault_keys[_s]].location isnot "done" and $farm_assault.teams[_assault_keys[_s]].state isnot "dogs_recover">>
			入侵者独自一人。
			<br><br>
			<<link [[制服|Farm Assault Overpower]]>><</link>>
		<</if>>
	<<elseif $pain gte 100>>
		<span class="red">你太痛了，没办法跟他们正面对抗。</span>
	<<else>>
		<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
			<<link [[跟他们正面对抗 (0:05)|Farm Assault Intercept Bailey]]>><<pass 5>><</link>>
			<br>
			<<set $skulduggerydifficulty to 1000>>
			<<link [[攻击其中一个 (0:05)|Farm Assault Pick Bailey]]>><<pass 5>><</link>><<skulduggerydifficulty>>
		<<elseif $farm_assault.teams[_assault_keys[_s]].type is "wraith">>
			<<set $_them to $wraith.seenFarm ? "it" : "them">>
			<<link [["迎面和对方战斗"|Farm Assault Intercept Wraith]]>><</link>>
		<<else>>
			<<link [[跟他们正面对抗 (0:05)|Farm Assault Intercept]]>><<pass 5>><</link>>
			<br>
			<<set $skulduggerydifficulty to 600>>
			<<link [[攻击其中一个 (0:05)|Farm Assault Pick]]>><<pass 5>><</link>><<skulduggerydifficulty>>
		<</if>>
	<</if>>
	<br>
<</widget>>

:: Farm Assault Rocks
<<effects>>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		<<if $physiqueSuccess>>
			<<generate1>><<person1>>
			你和艾利克斯在阴影中向<<farm_assault_intruders>>投掷着。大部分都空了，<span class="green">不过有一发命中了，</span>正中了那个<<person>>的头。<<He>>从<<farm_fence>>上滚落下来。
			<br><br>
			<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
		<<else>>
			<<generate1>><<person1>>
			你从阴影中向<<farm_assault_intruders>>投掷着。他们选择了从一个隐蔽的地方入侵，大部分地方都被土坡挡住了，其他地方则被树木遮蔽。<span class="red">你完全没扔中。</span>
			<br><br>
		<</if>>
	<</if>>
<</for>>

<<link [[继续|Farm Assault]]>><<endevent>><</link>>
<br>

:: Farm Assault Rocks Alex
<<effects>>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey" and random(1, 2) is 2>>
			<<generate1>><<person1>>
			你和艾利克斯在阴影中向<<farm_assault_intruders>>投掷着。他们选择了从一个隐蔽的地方入侵，大部分地方都被土坡挡住了，其他地方则被树木遮蔽。<span class="red">你完全没扔中。</span>
			<br><br>
		<<else>>
			<<generate1>><<person1>>
			你和艾利克斯在阴影中向<<farm_assault_intruders>>投掷着。大部分都空了，<span class="green">不过有一发命中了，</span>正中了那个<<person>>的头。<<He>>从<<farm_fence>>上滚落下来。
			<br><br>
			<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
		<</if>>
	<</if>>
<</for>>

<<link [[继续|Farm Assault]]>><<endevent>><</link>>
<br>

:: Farm Assault Threaten
<<effects>>

你向开阔的地带进发。
<<if $speech_attitude is "meek">>
	"我、我不会被欺负的，"你说道，"马上停下，不然你会后悔的。"
<<elseif $speech_attitude is "bratty">>
	"滚出我的地盘，"你说道，"不然我就把你喂猪。"
<<else>>
	"如果你现在就离开，"你说道"我不会追击。"
<</if>>
<br><br>
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
			<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
				<<generate1>><<person1>>
				<span class="red">入侵者们笑了起来。</span>
				<<if $fame.scrap gte 400>>
					"<span class="pink"><<underworld_nickname>></span>," 一个<<person>>说道，"很可怕，但我们身后有更可怕的。"
				<<else>>
					"很可怕，"一个<<person>>说道，"但我们背后又更可怕的。"
				<</if>>
				他们继续强行进入着。
			<<else>>
				<<generate1>><<person1>>
				<span class="red"><<person>>笑了。</span>
				<<if $fame.scrap gte 400>>
					"<span class="pink"><<underworld_nickname>></span>,"<<he>>说道，"很可怕，但我们身后有更可怕的。"
				<<else>>
					"很可怕，"<<he>>说道，"但我们背后有更可怕的。"
				<</if>>
				<<He>>继续强行传入着。
			<</if>>
		<<elseif $fame.scrap gte random(200, 1000)>>
			<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
				<<generate1>><<person1>><<generate2>>
				入侵者们相互看了一眼。
				<br>
				"这是他们叫做<span class="pink"><<underworld_nickname>></span>的那个吗？"一个<<person>>问道。
				<br>
				"对，这就是为什么报酬那么好。"一个<<person2>><<person>>回应道。
				<br>
				"我拿钱可不是为了屁股被踢烂的，我不干了。"<span class="green">他们转过身去，跑了。</span>
				<br><br>

				<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
			<<else>>
				<<generate1>><<person1>>
				入侵者，<<person>>盯着你道："我只是收钱来清理一些田地，我不想惹麻烦。"<span class="green"><<He>>转过身去，跑了。</span>
				<br><br>

				<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
			<</if>>
		<<else>>
			<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
				<<generate1>><<person1>><<generate2>>
				入侵者们相互看了一眼，<span class="red">然后笑了。</span>"这<<girl>>觉得<<pshe>>很强硬啊，"一个<<person>>说道，"就是马上要上一场艰难的课了。"
				<br><br>
				他们继续强行进入着。
				<br><br>
			<<else>>
				<<generate1>><<person1>>
				<span class="red">入侵者们笑了，</span>"你算哪根葱啊？"<<he>>说道，"我只看到一个马上就要被教训一顿的<<girl>>。"<<He>>继续闯入。
				<br><br>
			<</if>>
		<</if>>
	<</if>>
<</for>>
<br><br>

<<link [[继续|Farm Assault]]>><<endevent>><</link>>
<br>


:: Farm Assault Intercept
<<effects>>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
			<<generate1>><<generate2>><<generate3>>
			你向着雷米的打手冲锋，一个<<fullGroup>>。他们站稳脚跟，准备面对你。
			<br><br>
		<<elseif $farm_assault.teams[_assault_keys[_s]].number gte 2>>
			<<generate1>><<generate2>>
			你向着雷米的打手冲锋，一个<<fullGroup>>。他们站稳脚跟，准备面对你。
			<br><br>
		<<else>>
			<<generate1>>
			你向着雷米的打手冲锋，一个<<person1>><<person>>。<<He>>似乎被你的大胆吓了一跳，不过当你接近的时候，<<he>>还是站稳了脚跟。
			<br><br>
		<</if>>
	<</if>>
<</for>>

<<link [[继续|Farm Assault Fight]]>><<set $fightstart to 1>><</link>>
<br>


:: Farm Assault Intercept Bailey
<<effects>>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
			<<generate1>><<generate2>><<generate3>>
			你向着贝利的打手冲锋，一个<<fullGroup>>。他们转过了身来面向你，一个<<person1>><<person>>掰了掰<<his>>关节。
			<br><br>
		<<elseif $farm_assault.teams[_assault_keys[_s]].number gte 2>>
			<<generate1>><<generate2>>
			你向着贝利的打手冲锋，一个<<fullGroup>>。他们转过了身来面向你，一个<<person1>><<person>>掰了掰<<his>>关节。
			<br><br>
		<<else>>
			<<generate1>>
			你向着贝利的打手冲锋，一个<<person1>><<person>>。<<He>>转过了身来面向你，一掰了掰<<his>>关节。
			<br><br>
		<</if>>
	<</if>>
<</for>>

<<link [[继续|Farm Assault Fight Bailey]]>><<set $fightstart to 1>><</link>>
<br>




:: Farm Assault Fight
<<if $fightstart is 1>>
	<<set $fightstart to 0>>
	<<neutral 1>>
	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
<</if>>

<<effects>>
<<effectsman>>
<<man>>
<<stateman>>
<br><br>
<<actionsman>>

<<if _combatend or ($pain gte 100 and $willpowerpain is 0)>>
	<span id="next"><<link [[继续|Farm Assault Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[继续|Farm Assault Fight]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
	<<if $enemynomax gte 2>>
		雷米的打手们太过茫然跟疲惫，无法继续入侵。<span class="green">他们摇摇晃晃地离开了田地。</span>
	<<else>>
		那个<<person1>><<person>>太过茫然跟疲惫，无法继续入侵，<span class="green">摇摇晃晃地离开了田地。</span>
	<</if>>
	<br><br>
	<<tearful>>你准备着下一步行动。
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
<<elseif $enemyhealth lte 0>>
	<<if $enemynomax gte 2>>
		<span class="green">雷米的打手们逃离了田地，</span>他们忧心忡忡地回头看着你，确认你没有在追赶他们。
	<<else>>
		<span class="green">那个<<person1>><<person>>逃离了田地，</span><<he>>忧心忡忡地回头看着你，确认你没有在追赶他们。
	<</if>>
	<br><br>
	<<tearful>>你准备着下一步行动。
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>

<<else>>
	你摔到地上，伤得不能继续战斗。
	<br><br>
	<<person1>><<person>>在你身旁蹲下，<span class="purple">然后抓住了你的<<breasts>>。</span>"真可惜我还有工作要做。"<<he>>说道。
	<br><br>
	我没办法阻止<<him>>把你的手脚都绑在一起，并堵住你的嘴。"之后见<<girl>>"
	<br><br>
	<<tearful>>你在绳索中挣扎着。虽然很困难，不过应该还是可以挣脱的。
	<br><br>
	<<endcombat>>
	<<set $farm_assault.bindings to 3>>
	<<bind>>
	<<facewear 23>>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>

<</if>>

:: Farm Assault Fight Bailey
<<if $fightstart is 1>>
	<<set $fightstart to 0>>
	<<neutral 1>>
	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
	<<set $enemyhealthmax *= 1.3>>
	<<set $enemyhealth *= 1.3>>
	<<set $enemyarousalmax *= 1.3>>
<</if>>

<<effects>>
<<effectsman>>
<<man>>
<<stateman>>
<br><br>
<<actionsman>>

<<if _combatend or ($pain gte 100 and $willpowerpain is 0)>>
	<span id="next"><<link [[继续|Farm Assault Fight Bailey Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[继续|Farm Assault Fight Bailey]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Fight Bailey Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
	"你会继续走下去的，"<<person1>><<person>>喃喃自语道。
	<<if $enemynomax gte 2>>
		贝利的打手们太过茫然跟疲惫，无法继续入侵。<span class="green">他们摇摇晃晃地离开了田地。</span>
	<<else>>
		<<Hes>>太过茫然跟疲惫，无法继续入侵。<span class="green">摇摇晃晃地离开了田地。</span>
	<</if>>
	<br><br>
	<<tearful>>你准备着下一步行动。
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
<<elseif $enemyhealth lte 0>>
	"该死，"那个<<person1>><<person>>说道，"贝利会很不高兴的。"
	<<if $enemynomax gte 2>>
		<span class="green">贝利的打手们逃离了田地，</span> 消失在了夜色中。
	<<else>>
		<span class="green"><<He>>逃离了田地，</span> 消失在了夜色中。
	<</if>>
	<br><br>
	<<tearful>>你准备着下一步行动。
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>

<<else>>
	你摔到地上，伤得不能继续战斗。
	<br><br>
	那个<<person1>><<person>>蹲在你身边说道"抱歉，不过这就是这个世界的运行方式。"
	<br><br>
	我没办法阻止<<him>>把你的手脚都绑在一起，并堵住你的嘴。"之后见<<girl>>"
	<br><br>
	<<tearful>>你在绳索中挣扎着。虽然很困难，不过应该还是可以挣脱的。
	<br><br>
	<<endcombat>>
	<<set $farm_assault.bindings to 3>>
	<<bind>>
	<<facewear 23>>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>

<</if>>


:: Farm Assault Pick Bailey
<<effects>>


<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>

		<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
			你躲在阴影里跟踪着入侵者，等待着机会。
		<<else>>
			你躲在阴影里跟踪着入侵者，等待着机会。
		<</if>>
		<br><br>

		<<skulduggerycheck>>
		<<if $skulduggerysuccess is 1>>

			<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
				<span class="green">你找到了一个。</span><<generate1>><<person1>><<person>>跟<<his>>伙伴们离得太远。你从黑暗中冲出，击中了<<His>>的头。<<He>>瘫倒在地，失去了意识。
				<br><br>
				<<endevent>>
				<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
			<<else>>
				<span class="green">你找到了一个。</span><<generate1>><<person1>><<person>>站得离树篱太近。你从黑暗中冲出，击中了<<His>>的头。<<He>>瘫倒在地，失去了意识。
				<br><br>
				<<endevent>>
				<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
			<</if>>
			<br><br>

			<<skulduggeryuse>>

			<<link [[继续|Farm Assault]]>><<endevent>><</link>>
			<br>

		<<else>>


			<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
				<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
					<<generate1>><<generate2>><<generate3>>
				<<else>>
					<<generate1>><<generate2>>
				<</if>>
				<<person1>><<person>>位置离得其他人太远，你开始行动，偷偷接近。你从黑暗中冲出，<span class="red">然而<<person>>转身抓住了你的手臂。</span>
				<br><br>
				"找到那个<<girl>>了，"<<he>>一边甩开你一边说道，你听见了背后的脚步声。
				<br><br>
			<<else>>
				你躲在阴影里跟踪着入侵者，等待着机会。
			<</if>>

			<<link [[继续|Farm Assault Fight Bailey]]>><<set $fightstart to 1>><</link>>
			<br>

		<</if>>
	<</if>>
<</for>>

:: Farm Assault Pick
<<effects>>



<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>

		<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
			你躲在阴影里跟踪着入侵者，等待着机会。
		<<else>>
			你躲在阴影里跟踪着入侵者，等待着机会。
		<</if>>
		<br><br>

		<<skulduggerycheck>>
		<<if $skulduggerysuccess is 1>>

			<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
				<span class="green">你找到了一个。</span><<generate1>><<person1>><<person>>跟<<his>>伙伴们离得太远。你从黑暗中冲出，击中了<<His>>的头。<<He>>瘫倒在地，失去了意识。
				<br><br>
				<<endevent>>
				<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
			<<else>>
				<span class="green">你找到了一个。</span><<generate1>><<person1>><<person>>站得离树篱太近。你从黑暗中冲出，击中了<<His>>的头。<<He>>瘫倒在地，失去了意识。
				<br><br>
				<<endevent>>
				<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
			<</if>>
			<br><br>

			<<skulduggeryuse>>

			<<link [[继续|Farm Assault]]>><<endevent>><</link>>
			<br>

		<<else>>

			<<if $farm_assault.teams[_assault_keys[_s]].number gte 2>>
				<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
					<<generate1>>
				<<else>>
					<<generate1>>
				<</if>>
				<span class="red">你没找到目标。</span>打手们相互靠得太近，攻击一个就会引起其他人的注意。
				<br><br>

				<<link [[继续|Farm Assault]]>><<endevent>><</link>>
				<br>
			<<else>>
				<<generate1>><<person1>>
				你躲在阴影中跟踪着一个<<person>>入侵者，等待着一个机会。当<<he>>转身的时候，你蹑手蹑脚地接近了，<span class="red">但在黑暗中被绊倒了，</span>摔倒在地，并引起了<<his>>警觉。
				<br><br>

				<<He>>转过身来抬起了<<his>>脚，你不确定<<he>>是否清楚你在哪里。
				<br><br>

				<<link [[战斗|Farm Assault Fight]]>><<set $fightstart to 1>><</link>>
				<br>
				<<link [[逃离|Farm Assault Flight]]>><</link>>
				<br>
			<</if>>
		<</if>>
	<</if>>
<</for>>


:: Farm Assault Flight
<<effects>>

你转身逃进黑暗中。
<br><br>

<<link [[继续|Farm Assault]]>><<endevent>><</link>>
<br>


:: Farm Assault Pick Alex
<<effects>>
你跟艾利克斯跟踪着入侵者，等待着其中一人太靠近黑暗。
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
			<<generate1>><<person1>>
			一个<<person>>，背对着树篱站着，似乎觉得那边不会有人来。
			<br><br>
			你从灌木丛中钻出进行袭击，但那个<<person>>转身抓住了你的手臂。<<He>>注意到艾利克斯的时候为时已晚，被一拳打倒在地。
			<br><br>
			艾利克斯抑制住了欢呼的冲动。
			<br><br>
			<<link [[继续|Farm Assault]]>><<endevent>><</link>>
			<br>
		<<else>>
			你不觉得他们会单独行动，直到艾利克斯在光亮中出现，嘲笑着他们，然后又重新消失在了高草丛中。
			<br><br>
			<<generate1>><<person1>>
			<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
				两个人冲了过去，留下了一个<<person>>在后面。
			<<else>>
				一个人冲了上去，留下了一个<<person>>在后面。
			<</if>>
			你的机会来了。你蹑手蹑脚地跟在<<him>>后面，然后突击。<<He>>安静地倒在了地上。
			<br><br>
			你和艾利克斯汇合，计划着下一部行动。
			<br><br>

			<<link [[继续|Farm Assault]]>><<endevent>><</link>>
			<br>
		<</if>>
		<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
	<</if>>
<</for>>

:: Farm Assault Charge
<<effects>>

你冲向了入侵者，艾利克斯在你身侧。
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
			<<generate1>><<generate2>>
			他们有三个人。其中一个去拦截艾利克斯了，留下<<fullGroup>>给你。
			<br><br>
			<<person1>>
		<<else>>
			<<generate1>><<person1>>
			他们有两个人，其中一个去拦截艾利克斯了，留下一个<<person>>给你。
			<br><br>
		<</if>>
		<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>

			<<link [[继续|Farm Assault Alex Fight Bailey]]>><<set $fightstart to 1>><</link>>
			<br>
		<<else>>
			<<link [[继续|Farm Assault Alex Fight]]>><<set $fightstart to 1>><</link>>
			<br>
		<</if>>
	<</if>>
<</for>>

:: Farm Assault Overpower
<<effects>>

<<generate1>><<person1>>你冲向单独行动的入侵者，一个<<person>>。艾利克斯在周围巡逻着。
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
			<<He>>转过身面对着你。艾利克斯从后面冲向<<him>>。<<person>>转身挥拳，但这让<<his>>对你暴露出了弱点。你一拳打在<<him>>的头上，<<him>>被你打倒在地。<<glove>><<npcincr Alex love 1>>
			<br><br>

			<<link [[继续|Farm Assault]]>><<endevent>><</link>>
			<br>
		<<else>>
			<<He>>转过身来面对你。<<He>>完全没注意到袭来的艾利克斯。<<He>>被打的瘫倒在地。<<glove>><<npcincr Alex love 1>>
			<br><br>
			<<link [[继续|Farm Assault]]>><<endevent>><</link>>
			<br>
		<</if>>
		<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
	<</if>>
<</for>>

:: Farm Assault Alex Fight
<<if $fightstart is 1>>
	<<set $fightstart to 0>>
	<<neutral 1>>
	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
<</if>>

你听见了艾利克斯跟其他入侵者战斗的声音。
<br><br>

<<effects>>
<<effectsman>>
<<man>>
<<stateman>>
<br><br>
<<actionsman>>

<<if _combatend or ($pain gte 100 and $willpowerpain is 0)>>
	<span id="next"><<link [[继续|Farm Assault Alex Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[继续|Farm Assault Alex Fight]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Alex Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
	<<if $enemynomax gte 2>>
		雷米的打手们太过茫然跟疲惫，无法继续入侵。<span class="green">他们摇摇晃晃地离开了田地。</span>
	<<else>>
		那个<<person1>><<person>>太过茫然跟疲惫，无法继续入侵。<span class="green"><<He>>摇摇晃晃地离开了田地。</span>
	<</if>>
	<br><br>

	<<clotheson>>
	<<endcombat>>
	<<npc Alex>><<person1>>
	<<tearful>>你冲过去给艾利克斯帮忙。当你赶到的时候，你见到<<him>>把入侵者赶跑了。<<He>>汗流浃背得意洋洋地转向你道，"我们教训了他们一顿。"你不觉得<<he>>有意识到你是怎么制服你的目标的。
	<br><br>
	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
<<elseif $enemyhealth lte 0>>
	<<if $enemynomax gte 2>>
		<span class="green">雷米的打手们逃离了田地，</span>他们忧心忡忡地回头看着你，确认你没有在追赶他们。
	<<else>>
		<span class="green">那个<<person1>><<person>>逃离了田地，</span><<he>>忧心忡忡地回头看着你，确认你没有在追赶他们。
	<</if>>
	<br><br>
	<<clotheson>>
	<<endcombat>>
	<<npc Alex>><<person1>>
	<<tearful>>你冲过去给艾利克斯帮忙。当你赶到的时候，你见到<<him>>把入侵者赶跑了。<<He>>汗流浃背得意洋洋地转向你道，"我们教训了他们一顿。不过没时间休息了，继续吧。"
	<br><br>
	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>

	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
<<else>>
	你摔到地上，伤得不能继续战斗。
	<br><br>
	那个<<person1>><<person>>在你身旁蹲下，<span class="purple">然后抓住了你<<breasts>>。</span>"真可惜我还有工作要做。"<<he>>说道，拿出了一段绳子。<<gstress>><<stress 6>>
	<br><br>

	"离<<phim>>远点！"艾利克斯喊道，冲了过去把另一个入侵者扔在了泥里。
	<br><br>
	艾利克斯在那个<<person>>站起了前撞倒了<<he>>，把你扶了起来。<<tearful>>你一瘸一拐地走着，艾利克斯在旁边扶着你。
	<<endcombat>>
	<<clotheson>>
	<<npc Alex>><<person1>>
	"这太危险了，"艾利克斯在安全地藏起来后说道，"如果需要的话你可以坐在这。"入侵者们大概因为他们自己的伤势，并没有追上来。<<ggdom>><<npcincr Alex dom 1>>
	<br><br>

	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].number -= 1>>
		<</if>>
	<</for>>
<</if>>

:: Farm Assault Alex Fight Bailey
<<if $fightstart is 1>>
	<<set $fightstart to 0>>
	<<neutral 1>>
	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
	<<set $enemyhealthmax *= 1.3>>
	<<set $enemyhealth *= 1.3>>
	<<set $enemyarousalmax *= 1.3>>
<</if>>

你听见了艾利克斯跟其他入侵者战斗的声音。
<br><br>

<<effects>>
<<effectsman>>
<<man>>
<<stateman>>
<br><br>
<<actionsman>>

<<if _combatend or ($pain gte 100 and $willpowerpain is 0)>>
	<span id="next"><<link [[继续|Farm Assault Alex Fight Bailey Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[继续|Farm Assault Alex Fight Bailey]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Alex Fight Bailey Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
	"你会继续走下去的，"<<person1>><<person>>喃喃自语道。
	<<if $enemynomax gte 2>>
		贝利的打手们太过茫然跟疲惫，无法继续入侵。<span class="green">他们摇摇晃晃地离开了田地。</span>
	<<else>>
		<<Hes>>太过茫然跟疲惫，无法继续入侵。<span class="green">摇摇晃晃地离开了田地。</span>
	<</if>>
	<br><br>

	<<endcombat>>
	<<clotheson>>
	<<npc Alex>><<person1>><<generate2>>
	<<tearful>>你冲到艾利克斯身边。你发现<<him>>正在与剩下的入侵者 - 一个<<person2>><<person>>搏斗。入侵者占了上风，直到你从后面击中<<him>>的头部。<<person1>><<npcincr Alex dom 1>>
	<br><br>
	"你给了他们点颜色看看，"艾利克斯说着，你扶着<<him>>站起来。你觉得<<he>>可能没有意识到你是怎么制服对方的。
	<br><br>
	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
<<elseif $enemyhealth lte 0>>
	"该死，"那个<<person1>><<person>>说道，"贝利会很不高兴的。"
	<<if $enemynomax gte 2>>
		<span class="green">贝利的打手们逃离了田地，</span> 消失在了夜色中。
	<<else>>
		<span class="green"><<He>>逃离了田地，</span> 消失在了夜色中。
	<</if>>
	<br><br>
	<<endcombat>>
	<<clotheson>>
	<<npc Alex>><<person1>><<generate2>>
	<<tearful>>你冲到艾利克斯身边。你发现<<him>>正在与剩下的入侵者 - 一个<<person2>><<person>>搏斗。入侵者占了上风，直到你从后面击中<<him>>的头部。<<person1>><<npcincr Alex dom 1>>
	<br><br>
	"你教训了他们一顿，"你扶起艾利克斯的时候<<him>>说道。
	<br><br>
	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>

	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
<<else>>
	你摔到地上，伤得不能继续战斗。
	<br><br>
	那个<<person1>><<person>>蹲在你身边说道"抱歉，不过这就是这个世界的运行方式。"<<He>>拿出了一段绳子，还有口球。
	<br><br>
	<<endcombat>>
	<<npc Alex>><<person1>><<generate2>>
	"你敢！"艾利克斯大声喊道。<<He>>跑得更近了，但是一个<<person2>><<person>>从后面将<<person1>><<him>>扑倒在地。
	<br><br>
	"你的朋友很精神。不过不是问题，我们总带着很多绳子。"他们不由分说地将你的手脚绑在一起，还将你的嘴堵住。你听到了艾利克斯在附近的闷声。"待会儿见，<<girl>>。"
	<br><br>
	<<tearful>>你在绳索中挣扎着。虽然很困难，不过应该还是可以挣脱的。
	<br><br>
	<<endevent>>
	<<set $farm_assault.bindings to 3>>
	<<set $farm_assault.bindings_alex to 3>>
	<<bind>>
	<<facewear 23>>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>

<</if>>


:: Farm Assault Tower Defend
<<effects>>

你来到了瞭望塔的底部。你已经听到了顶上的打斗声，楼梯在你爬上去的时候吱吱作响。
<br><br>
<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<for _s to 0; _s lt _assault_keys.length; _s++>>
	<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
		你冲过去发现<<farm_assault_thugs>>在围攻着$farm.tower_guard 。
		<<endevent>>
		<<loadNPC 0 "farm_tower_guard">><<person1>>

		<<if $NPCList[0].traits.includes("relaxed")>>
			"来啊，"<<he>>虽然被逼入死角,但仍然挑衅地说道，"有本事就上。"
		<<elseif $NPCList[0].traits.includes("sociable")>>
			"我处理过比你们厉害得多的，"<<he>>说道，"上啊，看看会发生什么。"
		<<elseif $NPCList[0].traits.includes("brooding")>>
			"是时候赚钱了，"<<he>>啐了一口道。
		<<else>>
			"今晚我很受欢迎啊，"<<he>>笑道，"每个人都来找我跳舞。"
		<</if>>
		<<endevent>>
		<br><br>
		<<if $farm_assault.teams[_assault_keys[_s]].type is "bailey">>
			<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
				<<generate1>><<generate2>><<person1>><<set $skulduggerydifficulty to 1200>>
				三个打手小心翼翼地靠近着，没注意到你。
			<<elseif $farm_assault.teams[_assault_keys[_s]].number gte 2>>
				<<generate1>><<person1>><<set $skulduggerydifficulty to 1000>>
				三个打手小心翼翼地靠近着，没注意到你。
			<<else>>
				<<generate1>><<person1>><<set $skulduggerydifficulty to 600>>
				那个打手，一个<<person>>，小心翼翼地靠近着，没注意到你。
			<</if>>
			<br><br>
			<<if $skulduggerydifficulty gte 1>>
				<<link [[冲锋|Farm Assault Charge Bailey]]>><</link>>
				<br>
			<</if>>
			<<link [[偷袭|Farm Assault Sneak Bailey]]>><</link>><<skulduggerydifficulty>>
			<br>
		<<else>>
			<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
				<<generate1>><<generate2>><<person1>><<set $skulduggerydifficulty to 800>>
				三个打手说笑着走进着，毫无戒备，没注意到你。
			<<elseif $farm_assault.teams[_assault_keys[_s]].number gte 2>><<set $skulduggerydifficulty to 600>>
				<<generate1>><<person1>>
				三个打手说笑着走进着，毫无戒备，没注意到你。
			<<else>><<set $skulduggerydifficulty to 0>>
				<<generate1>><<person1>>
				那个打手，一个<<person>>，小心翼翼地靠近着，没注意到你。
			<</if>>
			<br><br>
			<<if $skulduggerydifficulty gte 1>>
				<<link [[冲锋|Farm Assault Tower Charge]]>><</link>>
				<br>
			<</if>>
			<<link [[偷袭|Farm Assault Sneak]]>><</link>><<skulduggerydifficulty>>
			<br>
		<</if>>
	<</if>>
<</for>>

<<link [[爬下去|Farm Assault]]>><<endevent>><</link>>
<br>

:: Farm Assault Tower Charge
<<effects>>

你向着打手冲锋，他们转过了身来面向你，给了$farm.tower_guard 一个机会。
<br><br>

<<link [[继续|Farm Assault Tower Fight]]>><<set $fightstart to 1>><</link>>
<br>


:: Farm Assault Tower Fight
<<effects>>
<<if $fightstart is 1>>
	<<set $fightstart to 0>>
	<<neutral 1>>
	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
<</if>>

$farm.tower_guard 在附近战斗。
<br><br>

<<effects>>
<<effectsman>>
<<man>>
<<stateman>>
<br><br>
<<actionsman>>

<<if _combatend or ($pain gte 100 and $willpowerpain is 0)>>
	<span id="next"><<link [[继续|Farm Assault Tower Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[继续|Farm Assault Tower Fight]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Tower Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
	<<if $enemynomax gte 2>>
		打手们摇摇晃晃地离开了你，他们需要喘口气，不过看起来还能继续战斗。直到$farm.tower_guard 把<<his>>一个同时扔下了塔楼。他们转过身去跑下了楼梯。
	<<else>>
		<<He>>摇摇晃晃地离开了你，<<He>>需要喘口气，不过看起来还能继续战斗。直到$farm.tower_guard 把<<his>>一个同事扔下了塔楼。<<He>>转过身去跑下了楼梯。
	<</if>>
	<br><br>
	<<tearful>>你靠着栏杆休息着。
	<br><br>
	<<clotheson>>
	<<endcombat>>

	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<if $NPCList[0].traits.includes("relaxed")>>
		"真是奇怪的战斗方式，"$farm.tower_guard 说道，"不过管用就行。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"我有些朋友想从事性工作，"$farm.tower_guard 说道，"他们能从你身上学到很多。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"这也是一种方式，"$farm.tower_guard 说道，"我不评判，我们都有自己的生存方式。"
	<<else>>
		"真希望你也能这样教训我，" $farm.tower_guard 笑道。
	<</if>>
	<<gstress>><<stress 6>>
	<<endevent>>
	<br><br>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>

	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
	<<set $farm_assault.tower to "manned">>

<<elseif $enemyhealth lte 0>>
	<<if $enemynomax gte 2>>
		你把<<person1>><<person>>从塔楼上拍了下来。$farm.tower_guard's 对手也跟着下去了。<<person2>><<person>>转身逃跑了，差不多是摔下了楼梯。
	<<else>>
		你把<<person1>><<person>>从塔楼上拍了下来。$farm.tower_guard's 对手也跟着下去了。
	<</if>>
	<br><br>
	<<tearful>>你靠在栏杆上休息着。
	<br><br>
	<<clotheson>>
	<<endcombat>>

	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<if $NPCList[0].traits.includes("relaxed")>>
		"就是要，不，是只能这样打，"$farm.tower_guard 笑道，"我们也会继续把下一批打包带走的。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"这都有点好玩了，"$farm.tower_guard 笑道，"大概下次我们就要满头大汗了。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"工作完成，不过可能会有更多的敌人，"$farm.tower_guard 说道，"感谢帮助。"
	<<else>>
		$farm.tower_guard伸出手来击掌，"我们做到了，"<<he>>说道："或许你之后会奖励我一下？正如一个<<if $pronoun is "m">>男孩<<else>>女孩<</if>>所梦想的那样。"
	<</if>>
	<br><br>
	<<endevent>>

	<<link [[继续|Farm Assault]]>><</link>>
	<br>

	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
	<<set $farm_assault.tower to "manned">>

<<else>>
	你摔倒了栏杆上，伤得太重，没法继续战斗。
	<<if $enemynomax gte 2>>
		打手们把他们的注意力转移到了$farm.tower_guard 身上，冲了过去帮助他们的同事。
	<<else>>
		那个<<person1>><<person>>把<<his>>注意力转移到了$farm.tower_guard 身上，冲了过去帮助<<his>>的同事。
	<</if>>
	<br><br>
	<<endcombat>>

	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			他们一直挣扎，直到
			<<if $farm.tower_guard_skill gte random(1, ($farm_assault.teams[_assault_keys[_s]].number * 500))>>
				$farm.tower_guard <span class="green">把一名袭击者扔下了塔楼。</span>
				<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
					另一个打手转身逃下了楼梯。
				<<else>>
					其他打手转身逃下了楼梯。
				<</if>>
				<br><br>
				$farm.tower_guard帮你站了起来。

				<<if $NPCList[0].traits.includes("relaxed")>>
					"你还好吗？"<<he>>问道，"需要的话就在这休息下吧。我会让艾利克斯了解情况的。"
				<<elseif $NPCList[0].traits.includes("sociable")>>
					"稍微休息下吧，"<<he>>说道，"希望其他人在我分心的时候没整出什么事情来。"
				<<elseif $NPCList[0].traits.includes("brooding")>>
					"别太冒险了，"<<he>>说道，"注意安全。"
				<<else>>
					"你看起来不太妙，"<<he>>说道，"还好附近没其他变态来占你便宜。除了我，不过我是你员工。"
				<</if>>
				<br><br>
				<<tearful>>你爬下了楼梯。
				<br><br>
				<<set $farm_assault.tower to "manned">>
				<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
			<<else>>
				<<farm_assault_thugs>><span class="red">制服了$farm.tower_guard，然后把<<him>>从塔上踢了下来。</span>
				<br><br>

				<<tearful>>你爬了起来，下了塔楼。
				<br><br>
				<<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
				<<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
				<<set $farm_assault.tower to "defeated">>
			<</if>>
		<</if>>
	<</for>>

	<<clotheson>>

	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>

<</if>>


:: Farm Assault Charge Bailey
<<effects>>

你向着打手冲锋，他们转过了身来面向你，给了$farm.tower_guard 一个机会。
<br><br>

<<link [[继续|Farm Assault Tower Bailey Fight]]>><<set $fightstart to 1>><</link>>
<br>

:: Farm Assault Tower Bailey Fight
<<effects>>
<<if $fightstart is 1>>
	<<set $fightstart to 0>>
	<<neutral 1>>
	<<maninit>>
	<<set $enemytrust -= 100>>
	<<set $enemyanger += 200>>
	<<npcidlegenitals>>
	<<set $enemyhealthmax *= 1.3>>
	<<set $enemyhealth *= 1.3>>
	<<set $enemyarousalmax *= 1.3>>
<</if>>

$farm.tower_guard 在附近战斗。
<br><br>

<<effects>>
<<effectsman>>
<<man>>
<<stateman>>
<br><br>
<<actionsman>>

<<if _combatend or ($pain gte 100 and $willpowerpain is 0)>>
	<span id="next"><<link [[继续|Farm Assault Tower Bailey Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[继续|Farm Assault Tower Bailey Fight]]>><</link>></span><<nexttext>>
<</if>>

:: Farm Assault Tower Bailey Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<ejaculation>>
	<<if $enemynomax gte 2>>
		打手们摇摇晃晃地离开了你，他们需要喘口气，不过看起来还能继续战斗。直到$farm.tower_guard 把<<his>>一个同时扔下了塔楼。他们转过身去跑下了楼梯。
	<<else>>
		<<He>>摇摇晃晃地离开了你，<<He>>需要喘口气，不过看起来还能继续战斗。直到$farm.tower_guard 把<<his>>一个同事扔下了塔楼。<<He>>转过身去跑下了楼梯。
	<</if>>
	<br><br>
	<<tearful>>你靠着栏杆休息着。
	<br><br>
	<<clotheson>>
	<<endcombat>>

	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<if $NPCList[0].traits.includes("relaxed")>>
		"真是奇怪的战斗方式，"$farm.tower_guard 说道，"不过管用就行。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"我有些朋友想从事性工作，"$farm.tower_guard 说道，"他们能从你身上学到很多。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"这也是一种方式，"$farm.tower_guard 说道，"我不评判，我们都有自己的生存方式。"
	<<else>>
		"真希望你也能这样教训我，" $farm.tower_guard 笑道。
	<</if>>
	<<gstress>><<stress 6>>
	<<endevent>>
	<br><br>
	<<link [[继续|Farm Assault]]>><</link>>
	<br>

	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
	<<set $farm_assault.tower to "manned">>

<<elseif $enemyhealth lte 0>>
	<<if $enemynomax gte 2>>
		你把<<person1>><<person>>从塔楼上拍了下来。$farm.tower_guard's 对手也跟着下去了。<<person2>><<person>>假笑着，然后转身跑下了楼梯。
	<<else>>
		你把<<person1>><<person>>从塔楼上拍了下来。$farm.tower_guard's 对手也跟着下去了。
	<</if>>
	<br><br>
	<<tearful>>你靠在栏杆上休息着。
	<br><br>
	<<clotheson>>
	<<endcombat>>

	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<if $NPCList[0].traits.includes("relaxed")>>
		"就是要，不，是只能这样打，"$farm.tower_guard 笑道，"我们也会继续把下一批打包带走的。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"这都有点好玩了，"$farm.tower_guard 笑道，"大概下次我们就要满头大汗了。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"工作完成，不过可能会有更多的敌人，"$farm.tower_guard 说道，"感谢帮助。"
	<<else>>
		$farm.tower_guard伸出手来击掌，"我们做到了，"<<he>>说道："或许你之后会奖励我一下？正如一个<<if $pronoun is "m">>男孩<<else>>女孩<</if>>所梦想的那样。"
	<</if>>
	<br><br>
	<<endevent>>

	<<link [[继续|Farm Assault]]>><</link>>
	<br>

	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
	<<set $farm_assault.tower to "manned">>

<<else>>
	你摔倒了栏杆上，伤得太重，没法继续战斗。
	<<if $enemynomax gte 2>>
		打手们把他们的注意力转移到了$farm.tower_guard 身上，冲了过去帮助他们的同事。
	<<else>>
		那个<<person1>><<person>>把<<his>>注意力转移到了$farm.tower_guard 身上，冲了过去帮助<<his>>的同事。
	<</if>>
	<br><br>
	<<endcombat>>

	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			他们一直挣扎，直到
			<<if $farm.tower_guard_skill gte random(1, ($farm_assault.teams[_assault_keys[_s]].number * 1000))>>
				$farm.tower_guard <span class="green">把一名袭击者扔下了塔楼。</span>
				<<if $farm_assault.teams[_assault_keys[_s]].number gte 3>>
					其他打手笑了笑，然后转身逃下了楼梯。
				<<else>>
					另一个打手笑了笑，然后转身逃下了楼梯。
				<</if>>
				<br><br>
				$farm.tower_guard帮你站了起来。

				<<if $NPCList[0].traits.includes("relaxed")>>
					"你还好吗？"<<he>>问道，"需要的话就在这休息下吧。我会让艾利克斯了解情况的。"
				<<elseif $NPCList[0].traits.includes("sociable")>>
					"稍微休息下吧，"<<he>>说道，"希望其他人在我分心的时候没整出什么事情来。"
				<<elseif $NPCList[0].traits.includes("brooding")>>
					"别太冒险了，"<<he>>说道，"注意安全。"
				<<else>>
					"你看起来不太妙，"<<he>>说道，"还好附近没其他变态来占你便宜。除了我，不过我是你员工。"
				<</if>>
				<br><br>
				<<tearful>>你爬下了楼梯。
				<br><br>
				<<set $farm_assault.tower to "manned">>
				<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
			<<else>>
				<<farm_assault_thugs>><span class="red">制服了$farm.tower_guard，然后把<<him>>从塔上踢了下来。</span>
				<br><br>

				<<tearful>>你爬了起来，下了塔楼。
				<br><br>
				<<set $farm_assault.teams[_assault_keys[_s]].location to $farm_assault.no.pluck()>>
				<<set $farm_assault.teams[_assault_keys[_s]].state to "field">>
				<<set $farm_assault.tower to "defeated">>
			<</if>>
		<</if>>
	<</for>>

	<<clotheson>>

	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>

<</if>>

:: Farm Assault Sneak
<<effects>>


你尽可能快地跑着。 $farm.tower_guard 试着吸引打手们的注意力。
<br><br>

<<skulduggerycheck>>
<<if $skulduggerysuccess is 1>>

	<span class="green">你冲到一个<<person>>面前，用力推了一把。</span><<He>>发出惊讶的叫声，翻过了围栏，从塔楼上摔了出去。
	<<if $enemynomax gte 2>>
		<<His>>同事惊讶地转过了身。 $farm.tower_guard 抓住了这个机会，一拳打在了<<person2>><<person>>的脸上。<<He>>摇摇晃晃地后退着，然后摔下了楼梯。
		<br><br>

		剩下的打手跟着<<him>>跑了。
		<br><br>
	<<else>>
		<<His>>同事惊讶地转过了身。 $farm.tower_guard 抓住了这个机会，把剩下的打手都扔下了楼梯。
		<br><br>
	<</if>>

	<<skulduggeryuse>>
	<<endevent>>
	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<if $NPCList[0].traits.includes("relaxed")>>
		"你反应很快，"$farm.tower_guard 说道，"很高兴你来帮忙了。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"这就是你们的报应，"$farm.tower_guard 从塔上大喊道，然后转向了你说道，"谢谢你的支援，我会继续监视的。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"干得不错，"$farm.tower_guard 说道，"我会继续回去工作的。"
	<<else>>
		"我们配合得不错，"$farm.tower_guard 说道，"或许我们以后可以其他方式合作。"<<He>>笑了。
	<</if>>
	<br><br>

	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>

	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
	<<set $farm_assault.tower to "manned">>

<<else>>

	<span class="red">地板吱吱作响，</span>打手们转身看向了你。$farm.tower_guard 抓住这个机会，向最近的一人挥出了拳头。
	<br><br>

	<<skulduggeryuse>>

	<<link [[继续|Farm Assault Tower Fight]]>><<set $fightstart to 1>><</link>>
	<br>

<</if>>

:: Farm Assault Sneak Bailey
<<effects>>

你尽可能快地跑着。 $farm.tower_guard 试着吸引打手们的注意力。
<br><br>

<<skulduggerycheck>>
<<if $skulduggerysuccess is 1>>

	<span class="green">你冲到一个<<person>>面前，用力推了一把。</span><<He>>发出惊讶的叫声，翻过了围栏，从塔楼上摔了出去。
	<<if $enemynomax gte 2>>
		<<His>>同事惊讶地转过了身。 $farm.tower_guard 抓住了这个机会，一拳打在了<<person2>><<person>>的脸上。<<He>>摇摇晃晃地后退着，然后摔下了楼梯。
		<br><br>

		剩下的打手对你笑了一下，然后跟着<<him>>跑了。
		<br><br>
	<<else>>
		<<His>>同事惊讶地转过了身。 $farm.tower_guard 抓住了这个机会，把剩下的打手都扔下了楼梯。
		<br><br>
	<</if>>

	<<skulduggeryuse>>
	<<endevent>>
	<<loadNPC 0 "farm_tower_guard">><<person1>>
	<<if $NPCList[0].traits.includes("relaxed")>>
		"你反应很快，"$farm.tower_guard 说道，"很高兴你来帮忙了。"
	<<elseif $NPCList[0].traits.includes("sociable")>>
		"这就是你们的报应，"$farm.tower_guard 从塔上大喊道，然后转向了你说道，"谢谢你的支援，我会继续监视的。"
	<<elseif $NPCList[0].traits.includes("brooding")>>
		"干得不错，"$farm.tower_guard 说道，"我会继续回去工作的。"
	<<else>>
		"我们配合得不错，"$farm.tower_guard 说道，"或许我们以后可以其他方式合作。"<<He>>笑了。
	<</if>>
	<br><br>

	<<link [[继续|Farm Assault]]>><<endevent>><</link>>
	<br>

	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<for _s to 0; _s lt _assault_keys.length; _s++>>
		<<if $bus is $farm_assault.teams[_assault_keys[_s]].location>>
			<<set $farm_assault.teams[_assault_keys[_s]].location to "done">>
		<</if>>
	<</for>>
	<<set $farm_assault.tower to "manned">>

<<else>>

	<span class="red">地板吱吱作响，</span>打手们转身看向了你。$farm.tower_guard 抓住这个机会，向最近的一人挥出了拳头。
	<br><br>

	<<skulduggeryuse>>

	<<link [[继续|Farm Assault Tower Bailey Fight]]>><<set $fightstart to 1>><</link>>
	<br>

<</if>>

:: Farm Assault Intercept Wraith
<<effects>><<set _assault_keys to Object.keys($farm_assault.teams)>>

<<if !$wraithIntro>>
	<<set $wraithIntro to true>>
	你冲向陌生人，祂美丽而又苍白。祂穿着半透明的白袍，有着一头飘逸的银发。祂用愤怒的红眼睛看着你，手还在抓着自己的脖子。一种奇怪的、黏糊糊的物质在祂的脚边蠕动，祂走过的所有地方都会留下同样的粘液。
<<elseif !$wraith.seenFarm>>
	你冲向陌生人，祂转过身来看着你咯咯地笑。<span class="red">祂的肤色是可怕的、熟悉的苍白。</span>一种奇怪的、黏糊糊的物质在祂脚边，祂经过的所有地方都留下了同样的痕迹。
<<else>>
	你冲向苍白的身影。祂转过身来看着你咯咯地笑。一种奇怪的、黏糊糊的物质在祂脚边，祂经过的所有地方都留下了同样的痕迹。
<</if>>
<br><br>

"<span class="wraith">以牙还牙，以眼还眼，<<pcPetname "Wraith">>。</span>"
<br><br>

<<generateWraith 1 true>>
<<initWraith "man" "arms" "abomination">><<startWraith>><<set $wraith.seenFarm to true>>
余烬在<<his>>的手指上发出噼啪声。<span class="red">黏液开始自行在田间扩散。</span>
<br><br>

<<link [[继续|Farm Assault Wraith Fight]]>><<set $fightstart to 1>><<set $phase to 1>><</link>>


:: Farm Assault Wraith Fight
<<effects>>
<<if $fightstart is 1>>
	<<set $fightstart to 0>>
	<<controlloss>>
	<<violence 1>>
	<<neutral 1>>
	<<molested>>
	<<set $rescue to 0>>
	<<set $enemytype to $wraith.type>>
	<<set $wraith.exit to "farm_assault">>
	<<set _assault_keys to Object.keys($farm_assault.teams)>>
	<<set $timer to 12 - $farm_assault.teams[_assault_keys[$farm_assault.wraith]].field_progress - Math.floor(C.npc["Ivory Wraith"].lust/4)>>
<</if>>
<<set $enemyanger += 10>>

<<if $phase is 1>>
	<<if $timer gte 8>>
		<span class="lblue">黏液稀薄地扩散开来。</span>
	<<elseif $timer gte 6>>
		<span class="blue">黏液扩散开来。</span>
	<<elseif $timer gte 4>>
		<span class="purple">黏液进一步扩散。</span>
	<<elseif $timer gte 2>>
		<span class="pink">黏液几乎覆盖了整个田地。</span>
	<<else>>
		<span class="red">黏液覆盖了每一寸。</span>
	<</if>>
<</if>>

<<effectsWraith>>

<<if _combatend or ($pain gte 100 and $willpowerpain is 0) or ($timer lte 0 and $phase is 1)>>
	<span id="next"><<link [[继续|Farm Assault Wraith Fight Finish]]>><</link>></span><<nexttext>>
<<else>>
	<span id="next"><<link [[继续|Farm Assault Wraith Fight]]>><</link>></span><<nexttext>>
<</if>>


:: Farm Assault Wraith Fight Finish
<<effects>>
<<if $enemyarousal gte $enemyarousalmax>>
	<<set _bind to 1>>
	随着嘶嘶声，<span class="green">火焰熄灭了</span>。
	<<ejaculation>>

	"<span class="wraith">如此壮观的欲望。</span>"
	<<kissWraith>>
	<br><br>

	<<if $wraith.gen is "arms">>
		当你仍然摇摇晃晃的时候，<<his>>身后两只多出来的手臂中出现了一股半透明的、闪闪发光的能量。
	<<else>>
		当你还在摇摇晃晃的时候，<<he>>的身后又出现了两只手臂，两只手臂做出手势，它们之间有一股半透明的、闪闪发光的能量。
	<</if>>
	<<his>>的手像橡皮泥一样变长飞了出来，把你的手臂固定在你的身体两边。<<He>>轻轻抬腿踹上你的胸前，你整个人倒在了地上。
	<br><br>

	"<span class="wraith">煤渣刺耳的声音。扫干净剩下的煤，捂住耳朵。</span>"
	<br><br>

	<<He>>走开了，把你留在了泥土里。你不确定<<him>>是否离开了，但你看不见<<him>>的身影。<<tearful>>你与那股能量作斗争。它很薄，但很结实。
	<br><br>

	<<endcombat>>
	<<exitWraith>>

<<elseif $enemyhealth lte 0>>
	那个身影惊恐地望着你，<<he>>踉踉跄跄地向后退去。随着一声嘶嘶声，<span class="green">余烬熄灭</span>。
	<<if $wraith.gen is "abomination">>
		触手毫无生气地掉进黑暗的水中。
	<<elseif $wraith.gen is "arms">>
		<<His>>额外的触手折回来。
	<</if>>
	<<His>>的头颅猛然向后仰去，随着一串凄厉的尖叫消失在虚无之中，这声音在你脑海中回荡不绝。你耳畔嗡嗡作响，仿佛听见了笑声。"<span class="wraith">你将收获你所播种的。</span>"
	<br><br>

	<<tearful>>你准备着下一步行动。
	<br><br>

	<<set $wraith.defeated++>>
	<<clotheson>>
	<<endcombat>>
	<<exitWraith>>

<<elseif $timer lte 0>>
	<<set _torch to 1>>
	白色幽灵从指尖轻弹出一个火星，落在覆盖着田野的黏液上。它蔓延开来，<span class="red">原野迸发出火焰。</span>你没有被烧伤，但原野在你眼前被点燃。你的心沉了下去。
	<<control -10>><<stress 12>><<trauma 6>><<lcontrol>><<ggstress>><<gtrauma>>
	<br><br>

	"<span class="wraith">在你面前被撕开，会不会很疼？</span>"当你心烦意乱的时候，苍白的身影抓住了你的脸。
	<<set $wraith.gen to "man">><<kissWraith>>
	<br><br>

	白色幽灵走开了，把你留在了泥土里。你不确定<<him>>是否离开了，但你看不见<<him>>的身影。<<tearful>>你计划着下一步行动。
	<br><br>

	<<clotheson>>
	<<endcombat>>
	<<exitWraith>>

<<else>>
	<<set _bind to 1>><<set _torch to 1>>
	你摔到地上，伤得不能继续战斗。
	<br><br>

	<<if $wraith.gen is "arms">>
		苍白的人影将两只<<his>>多余的手紧握在一起，形成了一股半透明的、闪闪发光的能量。
	<<else>>
		白色幽灵长出了两条额外的手臂，形成了一股半透明的、闪闪发光的能量。
	<</if>>
	<<his>>的手像橡皮泥一样变长飞了出来，把你的手臂固定在你的身体两边。<<He>>轻轻抬腿踹上你的胸前，你整个人倒在了地上。
	<br><br>

	"<span class="wraith">煤渣刺耳的声音。扫干净剩下的煤，捂住耳朵。</span>"
	<br><br>

	白色幽灵从指尖轻弹出一个火星，落在覆盖着田野的黏液上。它蔓延开来，<span class="red">田野燃起熊熊火焰。</span>你没有被烧伤，但田野就在你眼前燃烧。你挣扎着，尖叫着。
	<<control -10>><<stress 12>><<trauma 6>><<lcontrol>><<ggstress>><<gtrauma>>
	<br><br>

	白色幽灵走开了，把你留在了泥土里。你不确定<<him>>是否离开了，但你看不见<<him>>的身影。<<tearful>>你与那股能量作斗争。它很薄，但很结实。
	<br><br>

	<<endcombat>>
	<<exitWraith>>
<</if>>
<br>

<<set _assault_keys to Object.keys($farm_assault.teams)>>
<<if _bind is 1>>
	<<set $farm_assault.bindings to 6>>
	<<bind>>
<</if>>
<<if _torch is 1>>
	<<damage_farm "target" $farm_assault.teams[_assault_keys[$farm_assault.wraith]].location>>
<</if>>
<<set $farm_assault.teams[_assault_keys[$farm_assault.wraith]].location to "done">>