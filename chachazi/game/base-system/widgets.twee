:: Widgets [widget]

<<widget "toggledebug">>
	<<if $debug>>
		<<set $debug to 1>>
	<<else>>
		<<set $debug to 0>>
	<</if>>
<</widget>>

<<widget "statbar">>
	<div @class="(_args[2] is true ? 'rightMeter' : 'meter')">
		<<if _args[0] is 0>>
		<<else>>
			<<set _percent=Math.floor((_args[0]/_args[1])*100)>>
			<<switch Math.floor(_percent/10)>>
				<<case 8 9>><<set _statColor to "pinkbar">>
				<<case 6 7>><<set _statColor to "purplebar">>
				<<case 4 5>><<set _statColor to "bluebar">>
				<<case 2 3>><<set _statColor to "lbluebar">>
				<<case 0 1>><<set _statColor to "tealbar">>
				<<default>><<set _statColor to "redbar">>
			<</switch>>
			<div @class="_statColor" @style="'width:' + _percent + '%'"></div>
		<</if>>
	</div>
<</widget>>

<<widget "statbarinverted">>
	<<set _now to _args[0]>><<set _max to _args[1]>>
	<div @class="(_args[2] is true ? 'rightMeter' : 'meter')">
		<<if _args[0] is 0>>
		<<else>>
			<<set _percent=Math.floor((_args[0]/_args[1])*100)>>
			<<switch Math.floor(_percent/10)>>
				<<case 8 9>><<set _statColor to "tealbar">>
				<<case 6 7>><<set _statColor to "lbluebar">>
				<<case 4 5>><<set _statColor to "bluebar">>
				<<case 2 3>><<set _statColor to "purplebar">>
				<<case 0 1>><<set _statColor to "pinkbar">>
				<<default>><<set _statColor to "greenbar">>
			<</switch>>
			<div @class="_statColor" @style="'width:' + _percent + '%'"></div>
		<</if>>
	</div>
<</widget>>

<<widget "wateraction">>
	<<if currentSkillValue('swimmingskill') lt 100>>
		<<pass 18 sec>>
		<<set $oxygen -= 180>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 18>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 200>>
		<<pass 15 sec>>
		<<set $oxygen -= 150>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 15>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 300>>
		<<pass 12 sec>>
		<<set $oxygen -= 120>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 12>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 400>>
		<<pass 10 sec>>
		<<set $oxygen -= 100>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 10>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 500>>
		<<pass 8 sec>>
		<<set $oxygen -= 80>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 8>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 600>>
		<<pass 8 sec>>
		<<set $oxygen -= 80>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 8>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 700>>
		<<pass 7 sec>>
		<<set $oxygen -= 70>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 7>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 800>>
		<<pass 7 sec>>
		<<set $oxygen -= 70>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 7>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 900>>
		<<pass 6 sec>>
		<<set $oxygen -= 60>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 6>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 1000>>
		<<pass 6 sec>>
		<<set $oxygen -= 60>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 6>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 1100>>
		<<pass 5 sec>>
		<<set $oxygen -= 50>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 5>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<elseif currentSkillValue('swimmingskill') lt 1200>>
		<<pass 4 sec>>
		<<set $oxygen -= 40>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 4>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<<else>>
		<<pass 3 sec>>
		<<set $oxygen -= 30>>
		<<if $lake_ice_broken gte 1>>
			<<if random(1, 120) lte 3>>
				<<unset $lake_ice_broken>>
			<</if>>
		<</if>>
	<</if>>
<</widget>>

<<widget "underwater">>
	<<water>><<set $underwater to 1>><<set $underwatercheck to 1>>
	<<if $combat isnot 1>>
		<<if $oxygen lt 0 and $nooxygen is 1>>
			<<set $stress += 1000>>
		<<elseif $oxygen lt 0 and $nooxygen isnot 1>>
			<<set $nooxygen to 1>>
		<<else>>
			<<set $nooxygen to 0>>
		<</if>>
		<span class="lblue">氧气：</span>
		<<if $oxygen lt 0>>
			<span class="red">你窒息了！ 你的压力将会持续增长。在没有新鲜空气的情况下，你很快就会昏倒。</span>
		<</if>>
		<<oxygencaption>>
		<<if $underwaterintro isnot 1 and $combat isnot 1 and !$possessed>>
			<<set $underwaterintro to 1>>
			<i>你不可能永远屏住呼吸，你的游泳技能越高，每次行动经过的时间就越短，消耗的氧气也会更少。</i>
			<br><br>
		<</if>>
	<</if>>
<</widget>>

<<widget "oxygenrefresh">>
	<<set $oxygen to $oxygenmax>>
<</widget>>

<<widget "oxygen">>
	<<if _args[0]>>
		<<set $oxygen += _args[0]>>
	<</if>>
	<<if _args[0] lt 0>>
		<<set _strangle to 1>>
	<</if>>
	<<set $oxygen = Math.clamp($oxygen, 0, $oxygenmax)>>
<</widget>>

<<widget "virginitylosttext">>
	<<if $templePromised is _args[0]>>
		<span class="lblue">但你的纯洁之证依旧完好如初。</span>
	<<else>>
		<span class="red">永久地夺走了你的贞操。</span>
	<</if>>
<</widget>>

<<widget "neutral">> <!-- This widget's names ('neutral') is awful. Maybe 'molest' might better describe its use? -->
	<!-- args[1] now modifies the arousal applied to the PC -->
	<!-- Consult the 'arousal' widget to see how -->
	<<if _args[0] and (typeof _args[0]) is "number">>

		<<if $consensual isnot 1>>
			<<if $drunk gt 0>>
				<<set $_drunk_level to Math.clamp(Math.floor($drunk / 120), 0, 4)>>
				<<set $_stress_multiplier to [9,8,6,4,3][$_drunk_level]>>
			<<else>>
				<<set $_stress_multiplier to 10>>
			<</if>>
			<<stress _args[0] $_stress_multiplier>>
			<<combattrauma _args[0]>>
		<</if>>

		<<set _arousal to 20 * _args[0]>>
		<<if _args[1] and _args[2] and (typeof _args[1]) is "string" and (typeof _args[2]) is "number">>
			<<arousal _arousal _args[1]>>
			<<enemyarousal _args[0] _args[2]>>
		<<elseif _args[1] and (typeof _args[1]) is "string">>
			<<arousal _arousal _args[1]>>
			<<enemyarousal _args[0]>>
		<<elseif _args[1] and (typeof _args[1]) is "number">>
			<<arousal _arousal>>
			<<enemyarousal _args[0] _args[1]>>
		<</if>>
	<</if>>
<</widget>>

<<widget "neutralbreast">>
	<<neutral _args[0] "breasts">>
<</widget>>

<<widget "neutralgenitals">>
	<<neutral _args[0] "genitals">>
<</widget>>

<<widget "enemyarousal">>
	<<set $enemyarousal += _args[0]>>
<</widget>>

<<widget "sex">>
	<!-- args[1] - indicates target: "genitals" if penile or vaginal, "anus" if anal, "mouth" if oral -->

	<!-- Comment Akoz: args[2] was used at some places to show double penetration and at others -->
	<!-- to pass which enemy NPC is doing the fucking. I'd leave it to mean the later, but -->
	<!-- I didn't want to make a decision about a system I'm not working on. -->
	<!-- So I chose to leave args[2] unused -->

	<!-- Comment Purity: args[2] is now used to check which NPC is causing it. -->
	<!-- For double penetration, the widget is now called twice. Once for each NPC. -->
	<<if _args[0] and (typeof _args[0]) is "number">>
		<<if $consensual isnot 1>>
			<<if $drunk gt 0>>
				<<set $_drunk_level to Math.clamp(Math.floor($drunk / 120), 0, 4)>>
				<<set $_stress_multiplier to [9,8,6,4,3][$_drunk_level]>>
			<<else>>
				<<set $_stress_multiplier to 10>>
			<</if>>
			<<stress _args[0] $_stress_multiplier>>
			<<combattrauma _args[0]>>
		<<else>>
			<<stress _args[0] -10>>
		<</if>>
		<<set _arousal to 20 * _args[0]>>
		<<set _enemyarousal to 2 * _args[0]>>
		<<if _args[1] is undefined>>
			<<error {
				message : `Expected a second parameter, but none was provided.`,
				source : "Called from " + Utils.GetStack()
			}>>
		<<elseif _args[2] and (typeof _args[2]) is "number">>
			<<if wearingCondom(_args[2]) and ["genital","genitals","anal"].includes(_args[1])>>
				<<switch $NPCList[_args[2]].condom.type>>
					<<case "plain">>
						<<set _arousal to Math.floor(_arousal * 0.9)>>
						<<set _enemyarousal to Math.floor(_enemyarousal * 0.9)>>
					<<default>>
				<</switch>>
			<</if>>
			<<if wearingCondom("player") and ["genital","genitals"].includes(_args[1])>>
				<<switch $player.condom.type>>
					<<case "plain">>
						<<set _arousal to Math.floor(_arousal * 0.9)>>
						<<set _enemyarousal to Math.floor(_enemyarousal * 0.9)>>
					<<default>>
				<</switch>>
			<</if>>
		<</if>>
		<<arousal _arousal _args[1]>>
		<<enemyarousal _enemyarousal>>
	<</if>>
<</widget>>

<!--_args[0] is the base value, _args[1] is the skill-->
<<widget "sexControl">>
	<<if _args[0] and _args[1] gte 800>>
		<<if _args[1] gte 1000>>
			<<set _loss to 5 * _args[0]>>
		<<elseif between(_args[1], 900, 1000)>>
			<<set _loss to 4 * _args[0]>>
		<<else>>
			<<set _loss to 3 * _args[0]>>
		<</if>>
		<<if $enemyarousal gte $enemyarousalmax * 0.7>>
			<<set _loss *= 2>>
		<</if>>
		<<if $enemyarousal gte $enemyarousalmax * 0.9>>
			<<set _loss *= 2>>
		<</if>>
		<<set _loss *= $enemyArousalLossReduction>>
		<<if $enemyArousalLossReduction gt 0.2>>
			<<set $enemyArousalLossReduction -= 0.04>>
		<</if>>
		<<set $enemyarousal -= Math.round(_loss)>>
	<</if>>
<</widget>>

<<widget "violence">>
	<!-- NG tuning v2.7 $arousal from $masochism/50 to /7. PC now orgasms at least once during spanking encounter at 50% masocism level and twice at 100% masoohism. /10 at max is required to orgasm once at 100% masochism. -->
	<!-- NG added stress reduction for masochists. Trauma left same -->
	<<if _args.length gte 1>>
		<<set _violence = _args[0]>>
		<<set _stressMod = _args[1] || 1>>
		<<set _traumaMod = _args[2] || 1>>
		<<set _painMod = _args[3] || 1>>
		<!-- args[4] - indicates NPC id (but is currently unused) -->

		<<if _violence gt 0 or _violence lt 0>>
			<<if $drunk gt 0>>
				<<set $_drunk_level to Math.clamp(Math.floor($drunk / 120), 0, 4)>>
				<<set _drunkMod to [9,8,6,4,3][$_drunk_level]>>
			<<else>>
				<<set _drunkMod to 10>>
			<</if>>
			<<if $possessed is true and _violence gte 0>>
				<<set $_controlMod to (10 * $enemyno)>>
				<<control `_violence / $_controlMod`>>
				<<set $wraith.will -= _violence>>
				<<set _possessMod to 3>>
			<<else>>
				<<set _possessMod to 1>>
			<</if>>
			<<set $stress += (_violence * _drunkMod * _stressMod) * (1 - ($masochism / 1200))>>
			<<combattrauma _violence * _traumaMod>>
			<<set $pain += (_violence * _painMod * (1 - ($masochism / 1200)) * (1 - ($sciencetrait / 10)) / _possessMod)>>
			<<set _arousal to (_violence * (0 + ($masochism / 18)))>>
			<<arousal _arousal/_possessMod "maso">>
			<<if $orgasmdown gte 1>>
				<<if $masochism gte 800>>
					<<masochism `(_violence / 20)`>>
				<<elseif $masochism gte 500>>
					<<masochism `(_violence / 10)`>>
				<<elseif $masochism gte 300>>
					<<masochism `(_violence / 6)`>>
				<<elseif $masochism gte 100>>
					<<masochism `(_violence / 2)`>>
				<<else>>
					<<masochism _violence>>
				<</if>>
			<</if>>
			<<if _violence gte 6>>
				<<set $enemyanger -= 5>>
			<<else>>
				<<set $enemyanger -= _violence>>
			<</if>>
			<<set $enemyarousal += 1>>
			<<painclamp>>
		<</if>>
	<</if>>
<</widget>>

<<widget "violence_noncombat">>
	<<if _args.length gte 1>>
		<<set _violence = _args[0]>>
		<<set _stressMod = _args[1] || 1>>
		<<set _traumaMod = _args[2] || 1>>
		<<set _painMod = _args[3] || 1>>
		<<set _arousalMod = _args[4] || 1>>

		<<if _violence gt 0 or _violence lt 0>>
			<<if $drunk gt 0>>
				<<set $_drunk_level to Math.clamp(Math.floor($drunk / 120), 0, 4)>>
				<<set _drunkMod to [9,8,6,4,3][$_drunk_level]>>
			<<else>>
				<<set _drunkMod to 10>>
			<</if>>
			<<set $stress += (_violence * _drunkMod * _stressMod) * (1 - ($masochism / 1200))>>
			<<trauma _violence * _traumaMod>>
			<<set $pain += (_violence * _painMod * (1 - ($masochism / 1200)) * (1 - ($sciencetrait / 10)))>>
			<<set _arousal to (_violence * _arousalMod * (0 + ($masochism / 18)))>>
			<<arousal _arousal "maso">>
			<<set $arousalmasochism += (_violence * (0 + ($masochism / 7)))>>
			<<if $orgasmdown gte 1>>
				<<if $masochism gte 800>>
					<<masochism `(_violence / 20)`>>
				<<elseif $masochism gte 500>>
					<<masochism `(_violence / 10)`>>
				<<elseif $masochism gte 300>>
					<<masochism `(_violence / 6)`>>
				<<elseif $masochism gte 100>>
					<<masochism `(_violence / 2)`>>
				<<else>>
					<<masochism _violence>>
				<</if>>
			<</if>>
			<<painclamp>>
		<</if>>
	<</if>>
<</widget>>

<<widget "submission">>
	<!-- Comment Akoz: this won't use sensitivities as I reckon this arousal source is -->
	<!-- entirely psychological. -->
	<!-- args[0] - the submission value -->
	<!-- args[1] - the NPC to whom PC is submitting (currently unused) -->
	<<if _args[0]>>
		<<if $consensual isnot 1>>
			<<if $drunk gt 0>>
				<<set $_drunk_level to Math.clamp(Math.floor($drunk / 120), 0, 4)>>
				<<set $_stress_multiplier to [9,8,6,4,3][$_drunk_level]>>
			<<else>>
				<<set $_stress_multiplier to 10>>
			<</if>>
			<<stress _args[0] $_stress_multiplier>>
			<<sub `_args[0] / 4`>>
		<<else>>
			<<set $stress -= 10 * _args[0]>>
			<<set $assertive += 1>>
		<</if>>
		<<set _arousal to 20 * _args[0]>>
		<<arousal _arousal>>
		<<set $enemyarousal += 3 * _args[0]>>
		<<set $enemytrust += 2>>
	<</if>>
<</widget>>

<<widget "defiance">>
	<<if _args[0]>>
		<<set _defiance to (_args[0] * (1 + ($sadism / 1000)))>>
		<<set $stress -= 10 * _defiance>>
		<<combattrauma `-_defiance`>>
		<<set $enemyanger += 5 * _defiance>>
		<<def `_args[0] / 4`>>
		<<set $enemytrust -= 4>>
		<<set _defiance_arousal to (_defiance * ($sadism / 40))>>
		<<arousal _defiance_arousal>>
		<<if $arousal gte ($arousalmax * 0.8)>>
			<<sadism _args[0]>>
		<</if>>
		<<set _thedamage to (2 * _defiance * ($physique / 4000))>>
		<<if $enemyno gte 2>>
			<<npcdamage _args[1]>>
		<</if>>
		<<set $enemyhealth -= _thedamage>>
	<</if>>
<</widget>>

<<widget "brat">>
	<<if _args[0]>>
		<<if $drunk gt 0>>
			<<set $_drunk_level to Math.clamp(Math.floor($drunk / 120), 0, 4)>>
			<<set $_stress_multiplier to [9,8,6,4,3][$_drunk_level]>>
		<<else>>
			<<set $_stress_multiplier to 10>>
		<</if>>
		<<stress _args[0] $_stress_multiplier>>
		<<combattrauma `-1 * _args[0]`>>
		<<if _args[1] is "demanding">>
			<<set $enemyanger += 20 * _args[0]>>
		<<elseif $NPCList[0].legs isnot "walk">>
			<<set $enemyanger += 5 * _args[0]>>
		<</if>>
		<<def `_args[0] / 4`>>
		<<set $enemytrust -= 2>>
		<<set $NPCList[0].bold to ($NPCList[0].bold gte _args[0] * 10 ? $NPCList[0].bold - _args[0] * 10 : 0)>>
	<</if>>
<</widget>>

<<widget "meek">>
	<!-- Comment Akoz: this won't use sensitivities as I reckon this arousal source is -->
	<!-- entirely psychological. -->
	<!-- args[0] - the meek value -->
	<!-- args[1] - the NPC for whom PC is acting meekly (currently unused) -->
	<<if _args[0]>>
		<<if $consensual isnot 1>>
			<<sub `_args[0] / 4`>>
		<<else>>
			<<set $assertive += 1>>
		<</if>>
		<<set _arousal to 20 * _args[0]>>
		<<arousal _arousal>>
		<<set $enemyarousal += _args[0]>>
		<<set $enemytrust += 1>>
		<<set $enemyanger -= _args[0]>>
	<</if>>
<</widget>>

<<widget "crimeup">><<silently>>
	<<if $statFreeze isnot true>>
		<<if _args[0]>>
			<<set $_crimemod to _args[0]>>
			<<if _args[0] gte 1>>
				<!-- Our crime value is positive, adjust by stealth factor -->
				<<set $_crimefactor to 1>>
				/* The following commented code contains experimental factors for calculating stealth */
				/*
					<<set $_crime1 to Math.clamp($crime, C.crime.min, C.crime.max / 10)>>
					<<set $_crime2 to $crime - $_crime1>>
					<<set $_crime2 to Math.clamp($crime - $_crime1, C.crime.min, C.crime.max / 10)>>
					<!-- crime1 = first 5k of crime, crime2 = next 5k of crime -->
					<<set $_normCrime1 to normalise($_crime1, C.crime.max / 10)>>
					<<set $_normCrime2 to normalise($_crime2, C.crime.max / 10)>>
					<!-- Both normalized to percentage of max/10 (currently 5k) -->
					<<set $_stealthReduce1 to expCurve($_normcrime1, 3.0)>>
					<!-- First 5k of crime at a curve to 5000 -->
				*/
				<<set $_stealthfactor to ( 0.15 * ( 1 - normalise($crime, C.crime.max / 5 ) ) )>>
				<!-- Stealth gives 15%, but reduced by existing crime stat down to 0 at C.crime.max / 5 -->
				<!-- At 10k crime, stealth equipment is effectively useless - too much evidence -->

				<!-- Filter to all items with type "stealthy" and count them... -->
				<<set $_stealthMult to Object.values($worn).filter(item => item.type.includes("stealthy")).length>>
				<<set $_crimefactor -= $_stealthfactor * $_stealthMult>>

				<<set $_crimemod to Math.ceil($_crimemod * $_crimefactor)>>
				<!-- Add to crime history and Avery crimetracker-->
				<<set $crimehistory += $_crimemod>>
				<<if $averyCrimeTracker neq null>>
					<<set $averyCrimeTracker += $_crimemod>>
				<</if>>
			<</if>>
			<<set $crime += $_crimemod>> <!-- This works for negative values as well! -->
			<<set $crime to Math.clamp($crime, C.crime.min, C.crime.max)>> <!-- Auto-clamp crime -->
		<</if>>
		<<if $slimeEvent is "steal something">>
			<<unset $slimeEvent>>
		<</if>>
	<</if>>
<</silently>><</widget>>

<<widget "seductionskilluse">>
	<<set $enemyarousal += ($seductionskill / 100)>><<seductionskill 5>>
<</widget>>

<<widget "seductionskilluptext">>
	<<if $seductionskill lt 1000>>
		<span class="gold">你对自己的诱惑能力更加的自信。</span>
		<br><br>
	<</if>>
<</widget>>

<<widget "seductionskillusecombat">>
	<<set $enemyarousal += ($seductionskill / 100)>><<seductionskill 5>><<set $seductionskillup to 1>>
<</widget>>

<<widget "oralskilluse">>
	<<set $enemyarousal += ($oralskill / 100)>><<oralskill 5>><<set $oralskillup to 1>>
<</widget>>

<<widget "vaginalskilluse">>
	<<set $enemyarousal += ($vaginalskill / 100)>><<vaginalskill 5>><<set $vaginalskillup to 1>>
<</widget>>

<<widget "analskilluse">>
	<<set $enemyarousal += ($analskill / 100)>><<analskill 5>><<set $analskillup to 1>>
<</widget>>

<<widget "handskilluse">>
	<<set $enemyarousal += ($handskill / 100)>><<handskill 5>><<set $handskillup to 1>>
<</widget>>

<<widget "feetskilluse">>
	<<set $enemyarousal += ($feetskill / 100)>><<feetskill 5>><<set $feetskillup to 1>>
<</widget>>

<<widget "bottomskilluse">>
	<<set $enemyarousal += ($bottomskill / 100)>><<bottomskill 5>><<set $bottomskillup to 1>>
<</widget>>

<<widget "thighskilluse">>
	<<set $enemyarousal += ($thighskill / 100)>><<thighskill 5>><<set $thighskillup to 1>>
<</widget>>

<<widget "chestskilluse">>
	<<set $enemyarousal += ($chestskill / 100)>><<chestskill 5>><<set $chestskillup to 1>>
<</widget>>

<<widget "penileskilluse">>
	<<set $enemyarousal += ($penileskill / 100)>><<penileskill 5>><<set $penileskillup to 1>>
<</widget>>

<<widget "skulduggeryskilluse">>
	<<if $statFreeze isnot true>>
		<<set $skulduggery += 3>>
		<<if $skulduggery lt 1000>>
			<span class="gold"> 你学到了一些诡术上的技巧。</span>
		<</if>>
	<</if>>
	<br><br>
<</widget>>

<<widget "combatskulduggeryskilluse">>
	<<if $statFreeze isnot true>>
		<<set $skulduggery += 3>>
		<<set $skulduggery to Math.clamp($skulduggery, 0, 1000)>>
		<<if $skulduggery lt 1000>>
			<span class="gold"> 你学到了一些诡术上的技巧。</span>
		<</if>>
	<</if>>
<</widget>>

<<widget "swimmingskilluse">>
	<<if $statFreeze isnot true>>
		<<set $swimmingskill += 9>>
		<<if $swimmingskill lt 1000>>
			<span class="gold"> 你对自己的泳技更加自信。</span>
		<</if>>
		<<set $swimmingskill to Math.clamp($swimmingskill, 0, 1000)>>
	<</if>>
<</widget>>

<<widget "danceskilluse">>
	<<if $statFreeze isnot true>>
		<<danceskill 1>>
		<<if $danceskill lt 1000>>
			<span class="gold"> 你对自己的舞技更加自信。</span>
		<</if>>
	<</if>>
<</widget>>

<<widget "schoolskillgeneral">>
	<<if $statFreeze isnot true>>
		<<set $_subject to _args[0]>>
		<<set $_gain to _args[1] || 1>>

		<<set _skill_mod to [2.4, 1.2, 0.6, 0.3][Math.clamp(V[$_subject + "trait"], 0, 3)]>>

		<<if _args[2] isnot "no_star">>
			<<if V[$_subject + "_star"] lt 3>>
				<<set V[$_subject + "_star"] += 1>>
			<</if>>
			<<if $worn.face.type.includes("glasses")>>
				<<set _skill_mod *= 1.2>>
			<</if>>
			<<if $exposed gte 1>>
				<<set _skill_mod *= 1.2>>
			<</if>>
		<</if>>

		<<set V[$_subject + "_exam"] to Math.clamp(V[$_subject + "_exam"] + ($_gain * _skill_mod), -107, 200)>>
	<</if>>
<</widget>>

<<widget "scienceskill">>
	<<schoolskillgeneral "science" _args[0] _args[1]>>
<</widget>>

<<widget "mathsskill">>
	<<schoolskillgeneral "maths" _args[0] _args[1]>>
<</widget>>

<<widget "englishskill">>
	<<schoolskillgeneral "english" _args[0] _args[1]>>
<</widget>>

<<widget "historyskill">>
	<<schoolskillgeneral "history" _args[0] _args[1]>>
<</widget>>

<<widget "passiveStudy">>
	<<if $statFreeze isnot true>>
		<<switch $studyBooks.rented>>
			<<case "science">>
				<<scienceskill 6 "no_star">>
			<<case "maths">>
				<<mathsskill 6 "no_star">>
			<<case "English">>
				<<englishskill 6 "no_star">>
			<<case "history">>
				<<historyskill 6 "no_star">>
			<<default>>
		<</switch>>
		<<switch $studyBooks.stolen>>
			<<case "science">>
				<<scienceskill 6 "no_star">>
			<<case "maths">>
				<<mathsskill 6 "no_star">>
			<<case "English">>
				<<englishskill 6 "no_star">>
			<<case "history">>
				<<historyskill 6 "no_star">>
			<<default>>
		<</switch>>
	<</if>>
<</widget>>

<<widget "schoolskill">>
	<<if _args[0]>>
		<<historyskill _args[0]>>
		<<mathsskill _args[0]>>
		<<scienceskill _args[0]>>
		<<englishskill _args[0]>>
	<<else>>
		<<historyskill>>
		<<mathsskill>>
		<<scienceskill>>
		<<englishskill>>
	<</if>>
<</widget>>

<<widget "athletics">>
	<<if _args[0] and $statFreeze isnot true>>
		<<set _temp to _args[0]>>
		<<if $exposed gte 2>>
			<<set $athletics += 2>>
		<<elseif $exposed is 1>>
			<<set $athletics += 1>>
		<</if>>
		<<set $athletics += Math.trunc(_temp * 1.4)>>
		<<set $athletics to Math.clamp($athletics, 0, 1000)>>
		<<set $tending to Math.clamp($tending, 0, 1000)>>
	<</if>>
<</widget>>

<<widget "tending">>
	<<if _args[0] and $statFreeze isnot true>>
		<<set $tending += (_args[0] * 2)>>
		<<set $tending to Math.clamp($tending, 0, 1000)>>
	<</if>>
<</widget>>

<<widget "housekeeping">>
<<if _args[0] and $statFreeze isnot true and $housekeeping lt _args[1]>>
	<<set $housekeeping += (_args[0] * 2)>>
	<<set $housekeeping to Math.clamp($housekeeping, 0, 1000)>>
<</if>>
<</widget>>

<<widget "danceskill">>
	<<if _args[0] and $statFreeze isnot true>>
		<<set $danceskill += _args[0]>>
		<<set $danceskill to Math.clamp($danceskill, 0, 1000)>>
	<</if>>
<</widget>>

<<widget "physique">>
	<<if $statFreeze isnot true>>
		<<if _args[0]>><<set _temp to _args[0]>><<set $workouts += _args[0]>><<else>><<set _temp to 1>><<set $workouts += 1>><</if>>
		<<if $exposed gte 2>>
			<<set _temp *= 1.2>>
		<<elseif $exposed is 1>>
			<<set _temp *= 1.1>>
		<</if>>
		<<set $physique += 10 * _temp>><<set $physiqueuse += _temp>>
		<<if _args[1]>>
			<<if _args[1] isnot "noMessage">>
				<<if ($combat is 1 and _args[1] isnot "workout") or _args[1] is "invig">>
					<span class="gold"> 你感到活力十足。</span>
				<<else>>
					<span class="gold"> 你得到了锻炼。</span>
				<</if>>
			<</if>>
		<<elseif $combat is 1>>
			<span class="gold"> 你感到活力十足。</span>
		<<else>>
			<span class="gold"> 你得到了锻炼。</span>
		<</if>>
		<<set $physique = Math.clamp($physique, 0, $physiquesize)>>
	<</if>>
<</widget>>

<<widget "physique_loss">>
	<<if _args[0] and $statFreeze isnot true>>
		<<set $physique -= 10 * _args[0]>>
	<</if>>
<</widget>>

<<widget "bruise">>
	<<if _args[0] and $statFreeze isnot true>>
		<<switch _args[0]>>
		<<case "face">>
			<<set $facebruise += 1>>
			<<set $facebruise to Math.clamp($facebruise, 0, 100)>>
		<<case "neck">>
			<<set $neckbruise += 1>>
			<<set $neckbruise to Math.clamp($neckbruise, 0, 100)>>
		<<case "chest">>
			<<set $chestbruise += 1>>
			<<set $chestbruise to Math.clamp($chestbruise, 0, 100)>>
		<<case "rightarm">>
			<<set $rightarmbruise += 1>>
			<<set $rightarmbruise to Math.clamp($rightarmbruise, 0, 100)>>
		<<case "leftarm">>
			<<set $leftarmbruise += 1>>
			<<set $leftarmbruise to Math.clamp($leftarmbruise, 0, 100)>>
		<<case "tummy">>
			<<set $tummybruise += 1>>
			<<set $tummybruise to Math.clamp($tummybruise, 0, 100)>>
		<<case "bottom">>
			<<set $bottombruise += 1>>
			<<set $bottombruise to Math.clamp($bottombruise, 0, 100)>>
		<<case "thigh">>
			<<set $thighbruise += 1>>
			<<set $thighbruise to Math.clamp($thighbruise, 0, 100)>>
		<<case "anus">>
			<<set $anusbruise += 1>>
			<<set $anusbruise to Math.clamp($anusbruise, 0, 100)>>
		<<case "vagina">>
			<<set $vaginabruise += 1>>
			<<set $vaginabruise to Math.clamp($vaginabruise, 0, 100)>>
		<<case "penis">>
			<<set $penisbruise += 1>>
			<<set $penisbruise to Math.clamp($penisbruise, 0, 100)>>
		<<case "full">>
			<<set $facebruise += 1>>
			<<set $neckbruise += 1>>
			<<set $chestbruise += 1>>
			<<set $rightarmbruise += 1>>
			<<set $leftarmbruise += 1>>
			<<set $tummybruise += 1>>
			<<set $bottombruise += 1>>
			<<set $thighbruise += 1>>

			<<set $facebruise to Math.clamp($facebruise, 0, 100)>>
			<<set $chestbruise to Math.clamp($chestbruise, 0, 100)>>
			<<set $tummybruise to Math.clamp($tummybruise, 0, 100)>>
			<<set $vaginabruise to Math.clamp($vaginabruise, 0, 100)>>
			<<set $penisbruise to Math.clamp($penisbruise, 0, 100)>>
			<<set $anusbruise to Math.clamp($anusbruise, 0, 100)>>
			<<set $bottombruise to Math.clamp($bottombruise, 0, 100)>>
			<<set $thighbruise to Math.clamp($thighbruise, 0, 100)>>
			<<set $leftarmbruise to Math.clamp($leftarmbruise, 0, 100)>>
			<<set $rightarmbruise to Math.clamp($rightarmbruise, 0, 100)>>
			<<set $neckbruise to Math.clamp($neckbruise, 0, 100)>>
		<</switch>>
	<</if>>
<</widget>>

<<widget "rapestat">><<if $statFreeze isnot true>><<set $rapestat += 1>><</if>><</widget>>

<<widget "moleststat">><<if $statFreeze isnot true>><<set $moleststat += 1>><</if>><</widget>>

<<widget "vaginalstat">><<if $statFreeze isnot true>><<set $vaginalstat += 1>><</if>><</widget>>

<<widget "vaginalejacstat">><<if $statFreeze isnot true>><<set $vaginalejacstat += 1>><<purity -1>><<internalejac>><<fertiliseParasites "vagina">><<creampie "self" "vagina">><</if>><</widget>>

<<widget "analstat">><<if $statFreeze isnot true>><<set $analstat += 1>><</if>><</widget>>

<<widget "analejacstat">><<if $statFreeze isnot true>><<set $analejacstat += 1>><<purity -1>><<internalejac>><<fertiliseParasites>><<creampie "self" "anus">><</if>><</widget>>

<<widget "oralstat">><<if $statFreeze isnot true>><<set $oralstat += 1>><</if>><</widget>>

<<widget "oralejacstat">><<if $statFreeze isnot true>><<set $oralejacstat += 1>><<purity -1>><<internalejac>><<creampie "self" "mouth">><</if>><</widget>>

<<widget "handstat">><<if $statFreeze isnot true>><<set $handstat += 1>><</if>><</widget>>

<<widget "handejacstat">><<if $statFreeze isnot true>><<set $handejacstat += 1>><</if>><</widget>>

<<widget "feetstat">><<if $statFreeze isnot true>><<set $feetstat += 1>><</if>><</widget>>

<<widget "feetejacstat">><<if $statFreeze isnot true>><<set $feetejacstat += 1>><</if>><</widget>>

<<widget "thighstat">><<if $statFreeze isnot true>><<set $thighstat += 1>><</if>><</widget>>

<<widget "thighejacstat">><<if $statFreeze isnot true>><<set $thighejacstat += 1>><</if>><</widget>>

<<widget "cheststat">><<if $statFreeze isnot true>><<set $cheststat += 1>><</if>><</widget>>

<<widget "chestejacstat">><<if $statFreeze isnot true>><<set $chestejacstat += 1>><</if>><</widget>>

<<widget "bottomstat">><<if $statFreeze isnot true>><<set $bottomstat += 1>><</if>><</widget>>

<<widget "bottomejacstat">><<if $statFreeze isnot true>><<set $bottomejacstat += 1>><</if>><</widget>>

<<widget "penilestat">><<if $statFreeze isnot true>><<set $penilestat += 1>><</if>><</widget>>

<<widget "penileejacstat">><<if $statFreeze isnot true>><<set $penileejacstat += 1>><</if>><</widget>>

<<widget "clothesstripstat">><<if $statFreeze isnot true>><<set $clothesstripstat += 1>><</if>><</widget>>

<<widget "clothesruinstat">><<if $statFreeze isnot true>><<set $clothesruinstat += 1>><</if>><</widget>>

<<widget "orgasmstat">><<if $statFreeze isnot true>><<set $orgasmstat += 1>><</if>><</widget>>

<<widget "ejacstat">><<if $statFreeze isnot true>><<set $ejacstat += 1>><</if>><</widget>>

<<widget "hitstat">><<if $statFreeze isnot true>><<set $hitstat += 1>><</if>><</widget>>

<<widget "attackstat">><<if $statFreeze isnot true>><<set $attackstat += 1>><</if>><</widget>>

<<widget "vaginalentranceejacstat">><<if $statFreeze isnot true>><<set $vaginalentranceejacstat += 1>><</if>><</widget>>

<<widget "faceejacstat">><<if $statFreeze isnot true>><<set $faceejacstat += 1>><</if>><</widget>>

<<widget "hairejacstat">><<if $statFreeze isnot true>><<set $hairejacstat += 1>><</if>><</widget>>

<<widget "tummyejacstat">><<if $statFreeze isnot true>><<set $tummyejacstat += 1>><</if>><</widget>>

<<widget "neckejacstat">><<if $statFreeze isnot true>><<set $neckejacstat += 1>><</if>><</widget>>

<<widget "dancestat">><<if $statFreeze isnot true>><<set $dancestat += 1>><</if>><</widget>>

<<widget "analdoublestat">><<if $statFreeze isnot true>><<set $analdoublestat += 1>><</if>><</widget>>

<<widget "vaginaldoublestat">><<if $statFreeze isnot true>><<set $vaginaldoublestat += 1>><</if>><</widget>>

<<widget "sextoystat">><<if $statFreeze isnot true>><<set $sextoystat += 1>><</if>><</widget>>

<<widget "urinestat">><<if $statFreeze isnot true>><<if _args[0]>><<set $urinestat += _args[0]>><<else>><<set $urinestat += 1>><</if>><</if>><</widget>>

<<widget "distinction_stat">>
	<<if $statFreeze isnot true>>
		<<set $distinction_stat += 1>>
		<<if $distinction_stat gte 15>>
			<<earnFeat "Distinguished">>
		<<elseif $distinction_stat gte 5>>
			<<earnFeat "Distinctive">>
		<<else>>
			<<earnFeat "Distinction">>
		<</if>>
	<</if>>
<</widget>>

<<widget "knot_stat">>
	<<if $statFreeze isnot true>>
		<<if $knot_stat is undefined>>
			<<set $knot_stat to 0>>
		<</if>>
		<<set $knot_stat += 1>>
	<</if>>
<</widget>>

<<widget "hunger">>
	<<if _args[0] and $statFreeze isnot true>>
		<<set $hunger += _args[0]>>
		<<set $hunger = Math.clamp($hunger, 0, 2000)>>
	<</if>>
<</widget>>

<<widget "hunger_description">>
	<<if $hunger gte 2000>><span class="red">你正在挨饿！</span>
	<<elseif $hunger gte 1600>><span class="pink">你饥肠辘辘。</span>
	<<elseif $hunger gte 1200>><span class="purple">你非常饥饿。</span>
	<<elseif $hunger gte 800>><span class="blue">你觉得饿了。</span>
	<<elseif $hunger gte 400>><span class="lblue">你不是很饿。</span>
	<<elseif $hunger gte 1>><span class="teal">你完全饱了。</span>
	<<else>><span class="green">你吃的很撑。</span>
	<</if>>
<</widget>>

<<widget "thirst">>
	<<if $thirst gte 2000>><span class="red">你完全脱水了!</span>
	<<elseif $thirst gte 1600>><span class="pink">你口干舌燥。</span>
	<<elseif $thirst gte 1200>><span class="purple">你感觉很渴。</span>
	<<elseif $thirst gte 800>><span class="blue">你喉咙发干。</span>
	<<elseif $thirst gte 400>><span class="lblue">你不是很渴。</span>
	<<elseif $thirst gte 1>><span class="teal">你并不口渴。</span>
	<<elseif $thirst lte 0>><span class="green">你完全不渴。</span>
	<</if>>
<</widget>>

<<widget "tirednesscaption">>
	<<if Number.isFinite($tiredness)>>
		<div id="tirednesscaption" @title="'疲劳: ' + $tiredness.toFixed(2)">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				疲劳：
				<<if $options.showCaptionText is true>>
					<<if $tiredness gte C.tiredness.max>>
						<span class="red">你已经筋疲力竭。</span>
					<<elseif $tiredness gte (C.tiredness.max / 5) * 4>>
						<span class="pink">你非常的疲倦。</span>
					<<elseif $tiredness gte (C.tiredness.max / 5) * 3>>
						<span class="purple">你感到疲惫。</span>
					<<elseif $tiredness gte (C.tiredness.max / 5) * 2>>
						<span class="blue">你有点累了。</span>
					<<elseif $tiredness gte C.tiredness.max / 5>>
						<span class="lblue">你十分清醒。</span>
					<<elseif $tiredness gte 1>>
						<span class="teal">你的精力充沛。</span>
					<<else>>
						<span class="green">你感觉精神饱满。</span>
					<</if>>
				<</if>>
			</div>

			<<if $tiredness gte C.tiredness.max>>
				<<set $stress += (($tiredness - C.tiredness.max) * 16)>><<set $trauma += (($tiredness - C.tiredness.max) / 3)>>
			<</if>>

			<<set $tiredness = Math.clamp($tiredness, 0, C.tiredness.max)>>
			<<set _showCaptionText to !$options.showCaptionText>>
			<<statbar $tiredness `C.tiredness.max` _showCaptionText>>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "hygiene">>
	<<if $hygiene gte 2000>>
		<span class="red">你的身上满是污秽.</span>
	<<elseif $hygiene gte 1600>>
		<span class="pink">你被弄脏了。</span>
	<<elseif $hygiene gte 1200>>
		<span class="purple">你很臭。</span>
	<<elseif $hygiene gte 800>>
		<span class="blue">你很邋遢。</span>
	<<elseif $hygiene gte 400>>
		<span class="lblue">你很整洁。</span>
	<<elseif $hygiene gte 1>>
		<span class="teal">你很干净。</span>
	<<elseif $hygiene lte 0>>
		<span class="green">你干净的无可挑剔.</span>
	<</if>>
<</widget>>

<<widget "stresscaption">>
	<<if Number.isFinite($stress)>>
		<div id="stresscaption" @title="'压力: ' + $stress.toFixed(2)">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				压力：
				<<if $options.showCaptionText is true>>
					<<if $stress gte $stressmax>>
						<span class="red">巨大的压力击垮了你！</span>
					<<elseif $stress gte ($stressmax / 5) * 4>>
						<span class="pink">你的精神接近崩溃。</span>
					<<elseif $stress gte ($stressmax / 5) * 3>>
						<span class="purple">焦虑使你几乎无法呼吸。</span>
					<<elseif $stress gte ($stressmax / 5) * 2>>
						<span class="blue">你的内心紧绷。</span>
					<<elseif $stress gte $stressmax / 5>>
						<span class="lblue">你勉强保持镇定。</span>
					<<elseif $stress gte 1>>
						<span class="teal">你很平静。</span>
					<<else>>
						<span class="green">你心如止水。</span>
					<</if>>
				<</if>>
			</div>
			<<set $stress = Math.clamp($stress, 0, $stressmax)>>
			<<set _showCaptionText to !$options.showCaptionText>>
			<<statbar $stress $stressmax _showCaptionText>>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "traumacaption">>
	<<if Number.isFinite($trauma)>>
		<div id="traumacaption" @title="'创伤: ' + $trauma.toFixed(2)">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				创伤：
				<<if $options.showCaptionText is true>>
					<<if $trauma gte $traumamax>>
						<span class="red">无尽的痛楚使你麻木不仁。</span>
					<<elseif $trauma gte ($traumamax / 5) * 4>>
						<span class="pink">过去的阴影折磨着你。</span>
					<<elseif $trauma gte ($traumamax / 5) * 3>>
						<span class="purple">你十分的焦躁。</span>
					<<elseif $trauma gte ($traumamax / 5) * 2>>
						<span class="blue">你感到焦虑。</span>
					<<elseif $trauma gte ($traumamax / 5) * 1>>
						<span class="lblue">你感到心神不宁。</span>
					<<elseif $trauma gte 1>>
						<span class="teal">你有些紧张。</span>
					<<else>>
						<span class="green">你的精神十分健康。</span>
					<</if>>
				<</if>>
			</div>
			<<set _showCaptionText to !$options.showCaptionText>>
			<<statbar $trauma $traumamax _showCaptionText>>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "innocencecaption">>
	<div id="innocencecaption">
		<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
			纯真：
			<<if $options.showCaptionText is true>>
				<<if $awareness gte 0>>
					<span class="red">你已不再天真。</span>
				<<elseif $awareness gt -40>>
					<span class="pink">你无所适从。</span>
				<<elseif $awareness gt -80>>
					<span class="purple">你困惑不解。</span>
				<<elseif $awareness gt -120>>
					<span class="blue">你开始感到好奇。</span>
				<<elseif $awareness gt -160>>
					<span class="lblue">你轻信别人的话语。</span>
				<<elseif $awareness gt -200>>
					<span class="teal">你天真无邪。</span>
				<<else>>
					<span class="green">你懵懂无知。</span>
				<</if>>
			<</if>>
		</div>
		<<set _showCaptionText to !$options.showCaptionText>>
		<<statbarinverted $awareness -200 _showCaptionText>>
		<div style="clear:both;"></div>
	</div>
<</widget>>

<<widget "controlcaption">>
	<<if Number.isFinite($control)>>
		<div id="controlcaption" @title="'自控: ' + $control.toFixed(2)">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				自控：
				<<if $options.showCaptionText is true>>
					<<if $possessed>>
						<<if $control gte $controlmax>>
							<span class="green">你全盘掌控着自己。</span>
						<<elseif $control gte ($controlmax / 5) * 4>>
							<span class="teal">你几乎完全掌控着自己。</span>
						<<elseif $control gte ($controlmax / 5) * 3>>
							<span class="lblue">你的控制力正在动摇。</span>
						<<elseif $control gte ($controlmax / 5) * 2>>
							<span class="blue">你的身体沉重而空洞。</span>
						<<elseif $control gte ($controlmax / 5) * 1>>
							<span class="purple">你的意识逐渐麻木。</span>
						<<elseif $control gte 1>>
							<span class="pink">你正在被操纵。</span>
						<<else>>
							<span class="red">你已经无力反抗。</span>
						<</if>>
					<<else>>
						<<if $control gte $controlmax>>
							<span class="green">你充满自信。</span>
						<<elseif $control gte ($controlmax / 5) * 4>>
							<span class="teal">你感到不安。</span>
						<<elseif $control gte ($controlmax / 5) * 3>>
							<span class="lblue">你开始忧虑。</span>
						<<elseif $control gte ($controlmax / 5) * 2>>
							<span class="blue">你很焦虑。</span>
						<<elseif $control gte ($controlmax / 5) * 1>>
							<span class="purple">你感到害怕。</span>
						<<elseif $control gte 1>>
							<span class="pink">你有些惊恐。</span>
						<<else>>
							<span class="red">你极度恐慌。</span>
						<</if>>
					<</if>>
				<</if>>
			</div>
			<<set _showCaptionText to !$options.showCaptionText>>
			<<statbarinverted $control $controlmax _showCaptionText>>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "arousalcaption">>
	<<if Number.isFinite($arousal)>>
		<div id="arousalcaption" @title="'性奋: ' + $arousal.toFixed(2)">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				性奋：
				<<if $options.showCaptionText is true>>
					<<if $arousal gte $arousalmax>>
						<span class="red">你颤栗着达到了高潮。</span>
					<<elseif $arousal gte ($arousalmax / 5) * 4>>
						<span class="pink">触电般热浪于小腹聚集。</span>
					<<elseif $arousal gte ($arousalmax / 5) * 3>>
						<span class="purple">你身体轻颤着索求更多。</span>
					<<elseif $arousal gte ($arousalmax / 5) * 2>>
						<span class="blue">你的身体因欲望而抽痛。</span>
					<<elseif $arousal gte $arousalmax / 5>>
						<span class="lblue">情欲在你的体内积累。</span>
					<<elseif $arousal gte 1>>
						<span class="teal">你的身体微微发烫。</span>
					<<else>>
						<span class="green">你很冷静。</span>
					<</if>>
				<</if>>
			</div>
			<<set _showCaptionText to !$options.showCaptionText>>
			<<statbar $arousal $arousalmax _showCaptionText>>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "allurecaption">>
	<<if Number.isFinite($allure)>>
		<div id="allurecaption" @title="'诱惑: ' + $allure.toFixed(2)">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				诱惑：
				<<if $options.showCaptionText is true>>
					<<if $allure gte (6000 * $alluremod)>><span class="red">你看起来需要被蹂躏。</span>
					<<elseif $allure gte (4000 * $alluremod)>><span class="pink">你看起来很有伤风化。</span>
					<<elseif $allure gte (3000 * $alluremod)>><span class="purple">你看起来非常色情。</span>
					<<elseif $allure gte (2000 * $alluremod)>><span class="blue">你在人群中十分显眼。</span>
					<<elseif $allure gte (1500 * $alluremod)>><span class="lblue">你引人注目。</span>
					<<elseif $allure gte (1000 * $alluremod)>><span class="teal">偶尔有人偷偷看你几眼。</span>
					<<else>><span class="green">你看起来平平无奇。</span>
					<</if>>
				<</if>>
			</div>
			<div @class="($options.showCaptionText is true ? 'meter' : 'rightMeter')">
				<<set $percent=Math.floor(($allure/(8000 * $alluremod))*100)>>
				<<if $allure gte (6000 * $alluremod)>>
				<<print '<div class="redbar" style="width:' + $percent + '%"></div>'>>
				<<elseif $allure gte (4000 * $alluremod)>>
				<<print '<div class="pinkbar" style="width:' + $percent + '%"></div>'>>
				<<elseif $allure gte (3000 * $alluremod)>>
				<<print '<div class="purplebar" style="width:' + $percent + '%"></div>'>>
				<<elseif $allure gte (2000 * $alluremod)>>
				<<print '<div class="bluebar" style="width:' + $percent + '%"></div>'>>
				<<elseif $allure gte (1500 * $alluremod)>>
				<<print '<div class="lbluebar" style="width:' + $percent + '%"></div>'>>
				<<elseif $allure gte (1000 * $alluremod)>>
				<<print '<div class="tealbar" style="width:' + $percent + '%"></div>'>>
				<<else>>
				<<print '<div class="greenbar" style="width:' + $percent + '%"></div>'>>
				<</if>>
			</div>

			<<if $allure gte 8000 * $alluremod>><<set $allure to 8000 * $alluremod>><</if>>
			<<if $alluretest is 1>>
				<<set $allure += 100000>>
			<<elseif $alluretest is 2>>
				<<set $allure -= 100000>>
			<</if>>

			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "updateallure">>
	<<run new Wikifier(null, '<<calculateallure>>')>>
	<<run $('#allurecaption').replaceWith(new Wikifier(null, '<<allurecaption>>').output)>>
<</widget>>

<<widget "oxygencaption">>
	<div id="oxygencaption">
		<<if _args[0] is true>>
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				空气：
			</div>
			<<set _showCaptionText to !$options.showCaptionText>>
		<<else>>
			<<unset _showCaptionText>>
		<</if>>
		<<statbarinverted $oxygen $oxygenmax _showCaptionText>>
		<div style="clear:both;"></div>
	</div>
<</widget>>

<<widget "flashbacktown">>
	<span class="red">远方传来了车鸣声。你惊慌失措，幽灵般的触手探入你的身体，束缚了你的四肢……一个无言的声音在嘲笑、贬低着你。尽管只持续了一会儿，但压抑与恐惧依旧让你胆战心惊。</span>
	<<garousal>><<gstress>><<gtrauma>><<arousal 600>><<stress 12>><<trauma 6>>
	<br><br>
<</widget>>

<<widget "flashbackhome">>
	<span class="red">远方传来了车驰声。你惊慌失措，幽灵般的触手探入你的身体，束缚了你的四肢……一个无言的声音在嘲笑、贬低着你。尽管只持续了一会儿，但压抑与恐惧依旧让你胆战心惊。</span>
	<<garousal>><<gstress>><<gtrauma>><<arousal 600>><<stress 6>><<trauma 6>>
	<br><br>
<</widget>>

<<widget "flashbackbeach">>
	<span class="red">远方有海鸥在叫。你惊慌失措，幽灵般的触手探入你的身体，限束缚了你的四肢……一个无言的声音在嘲笑、贬低着你。尽管只持续了一会儿，但压抑与恐惧依旧让你胆战心惊。</span>
	<<garousal>><<gstress>><<gtrauma>><<arousal 600>><<stress 6>><<trauma 6>>
	<br><br>
<</widget>>

<<widget "flashbackunderground">>
	<span class="red">你感到大地在颤抖。你惊慌失措，幽灵般的触手探入你的身体，束缚了你的四肢……一个无言的声音在嘲笑、贬低着你。尽管只持续了一会儿，但压抑与恐惧依旧让你胆战心惊。</span>
	<<garousal>><<gstress>><<gtrauma>><<arousal 600>><<stress 6>><<trauma 6>>
	<br><br>
<</widget>>

<<widget "flashbackschool">>
	<span class="red">你回想起你在学校是怎样被人嘲笑与欺侮的。你开始惊慌，幽灵般的触手探入你的身体，束缚了你的四肢……一个无言的声音在嘲笑、贬低着你。尽管只持续了一会儿，但压抑与恐惧依旧让你胆战心惊。</span>
	<<garousal>><<gstress>><<gtrauma>><<arousal 600>><<stress 6>><<trauma 6>>
	<br><br>
<</widget>>

<<widget "drunkcaption">>
	<<if $drunk gt 0>>
		<<set $_colour to getColourClassFromPercentage($drunk * (100 / 480))>>
		<<set $_barColour to $_colour + "bar">>
		<<set $_percent to Math.floor(($drunk/1000)*100)>>
		<<set $_barWidth to `width:${$_percent}%`>>

		<div id="drunkcaption">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				<<if $options.showCaptionText is true>>
					<<set $_drunk_level to Math.clamp(Math.floor($drunk / 120), 0, 4) * 120>>
					<<switch $_drunk_level>>
						<<case 0>><span @class="$_colour">你有些头晕。</span>
						<<case 120>><span @class="$_colour">你略有醉意。</span>
						<<case 240>><span @class="$_colour">你喝醉了。</span>
						<<case 360>><span @class="$_colour">你烂醉如泥。</span>
						<<case 480>><span @class="$_colour">你醉的不省人事。</span>
					<</switch>>
				<<else>>
					醉意：
				<</if>>
			</div>
			<div @class="($options.showCaptionText is true ? 'meter' : 'rightMeter')">
				<div @class="$_barColour" @style="$_barWidth"></div>
			</div>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "druggedcaption">>
	<<if $drugged gt 0>>
		<<set $_colour to getColourClassFromPercentage($drugged / 5)>>
		<<set $_barColour to $_colour + "bar">>
		<<set $_percent to Math.floor(($drugged/1000)*100)>>
		<<set $_barWidth to `width:${$_percent}%`>>

		<div id="druggedcaption">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				<<if $options.showCaptionText is true>>
					<span class="pink">一股淫荡的暖意在你体内荡漾。</span>
				<<else>>
					药物：
				<</if>>
			</div>
			<div @class="($options.showCaptionText is true ? 'meter' : 'rightMeter')">
				<div @class="$_barColour" @style="$_barWidth"></div>
			</div>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "hallucinogencaption">>
	<<if $hallucinogen gt 0>>
		<<set $_colour to getColourClassFromPercentage($hallucinogen / 5)>>
		<<set $_barColour to $_colour + "bar">>
		<<set $_percent to Math.floor(($hallucinogen/1000)*100)>>
		<<set $_barWidth to `width:${$_percent}%`>>

		<div id="hallucinogencaption">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				<<if $options.showCaptionText is true>>
					<span class="purple">你的感知发生了变化</span>
				<<else>>
					致幻：
				<</if>>
			</div>
			<div @class="($options.showCaptionText is true ? 'meter' : 'rightMeter')">
				<div @class="$_barColour" @style="$_barWidth"></div>
			</div>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "paincaption">>
	<<if Number.isFinite($pain)>>
		<div id="paincaption" @title="'疼痛: ' + $pain.toFixed(2)">
			<div @class="($options.showCaptionText is true ? '' : 'rightMeterText')">
				疼痛：
				<<if $options.showCaptionText is true>>
					<<if $pain gte 100 and $willpowerpain is 0>><span class="red">你无法控制地啜泣起来。</span>
					<<elseif $pain gte 80>><span class="pink">疼痛使你大哭不止。</span>
					<<elseif $pain gte 60>><span class="purple">你抽泣不止。</span>
					<<elseif $pain gte 40>><span class="blue">眼泪从你的脸颊上流下。</span>
					<<elseif $pain gte 20>><span class="lblue">泪花在你眼中打转。</span>
					<<elseif $pain gte 1>><span class="teal">你有些难受。</span>
					<<else>><span class="green">你感觉良好。</span>
					<</if>>
				<</if>>
			</div>
			<div @class="($options.showCaptionText is true ? 'meter' : 'rightMeter')">
				<<set $percent=Math.floor(($pain/100)*100)>>
				<<if $pain gte 100 and $willpowerpain is 0>>
				<<print '<div class="redbar" style="width:' + $percent + '%"></div>'>>
				<<elseif $pain gte 80>>
				<<print '<div class="pinkbar" style="width:' + $percent + '%"></div>'>>
				<<elseif $pain gte 60>>
				<<print '<div class="purplebar" style="width:' + $percent + '%"></div>'>>
				<<elseif $pain gte 40>>
				<<print '<div class="bluebar" style="width:' + $percent + '%"></div>'>>
				<<elseif $pain gte 20>>
				<<print '<div class="lbluebar" style="width:' + $percent + '%"></div>'>>
				<<elseif $pain gte 1>>
				<<print '<div class="tealbar" style="width:' + $percent + '%"></div>'>>
				<<else>>
				<<print '<div class="greenbar" style="width:' + $percent + '%"></div>'>>
				<</if>>
			</div>
			<div style="clear:both;"></div>
		</div>
	<</if>>
<</widget>>

<<widget "raped">>
	<<if $rapeavoid is 1 and $consensual is 0 and $gamemode isnot "soft">>
		<<set $rapeavoid to 0>><<rapestat>>
		<<if $enemytype is "man" and !($npc.length is 1 and $npc[0] is "Eden")>>
			<<famerape $enemynomax>>
		<</if>>
		<<if $awareness lte 200>>
			<<awareness 5>>
		<<elseif $awareness lte 400>>
			<<awareness 1>>
		<</if>>
		<<if $enemytype is "beast" or $enemytype is "struggle">>
			<<set $beastrapestat += 1>>
			<<if $awareness lte 300>>
				<<awareness 1>>
			<</if>>
		<</if>>
		<<if $enemytype is "tentacles">>
			<<set $tentaclerapestat += 1>>
		<</if>>
		<<if $enemytype is "tentacles" or $enemytype is "struggle">>
			<<if $awareness lte 400>>
				<<awareness 1>>
			<</if>>
		<</if>>
		<<controlloss>>
	<<elseif $sexavoid is 1 and $consensual is 1>>
		<<set $sexavoid to 0>>
		<<if $enemytype is "man" and !($npc.length is 1 and $npc[0] is "Eden")>>
			<<famesex $enemynomax>>
		<</if>>
		<<controlloss>>
	<</if>>
<</widget>>

<<widget "molested">>
	<<if $gamemode is "soft">>
		<<set $consensual to 1>>
	<<elseif $molestavoid is 1 and $consensual is 0>>
		<<set $molestavoid to 0>>
		<<moleststat>>

		<<if $flashbacks gte 1>>
			<<switch $location>>
				<<case "town">><<if $flashbacktown is 0>><<set $flashbacktown to 14>><</if>>
				<<case "home">><<if $flashbackhome is 0>><<set $flashbackhome to 14>><</if>>
				<<case "beach">><<if $flashbackbeach is 0>><<set $flashbackbeach to 14>><</if>>
				<<case "school">><<if $flashbackschool is 0>><<set $flashbackschool to 14>><</if>>
				<<case "underground">><<if $flashbackunderground is 0>><<set $flashbackunderground to 14>><</if>>
			<</switch>>
		<</if>>
		<<if $awareness lte 200>>
			<<awareness 5>>
		<<elseif $awareness lte 400>>
			<<awareness 1>>
		<</if>>
		<<if $enemytype is "beast" or $enemytype is "struggle">>
			<<if $awareness lte 300>>
				<<awareness 1>>
			<</if>>
		<</if>>
		<<if $enemytype is "tentacles" or $enemytype is "struggle">>
			<<if $awareness lte 400>>
				<<awareness 1>>
			<</if>>
		<</if>>
	<</if>>
<</widget>>

<<widget "consensual">>
	<<if $awareness lte 200>>
		<<awareness 5>>
	<<elseif $awareness lte 400>>
		<<awareness 1>>
	<</if>>
	<<if $enemytype is "beast" or $enemytype is "struggle">>
		<<if $awareness lte 300>>
			<<awareness 1>>
		<</if>>
	<</if>>
	<<if $enemytype is "tentacles">>
		<<if $awareness lte 400>>
			<<awareness 1>>
		<</if>>
	<</if>>
	<<set $trueconsensual to 1>>
	<<if $npc.length is 1 and ($npc[0] is "Robin" and $NPCName[$NPCNameList.indexOf("Robin")].dom lte 10 and $debug is 1) or ($npc[0] is "Sydney" and $NPCName[$NPCNameList.indexOf("Sydney")].purity gte 50)>>
		<<npc_submissive>>
	<</if>>
<</widget>>

<<widget "controlloss">>
	<<if $gamemode is "soft">>
	<<elseif $consensual is 0>>
		<<set $pullaway to 0>>
		<<set $novaginal to 0>>
		<<set $noanal to 0>>
		<<set $nopenile to 0>>
		<<if $control gt 1>>
			<<if $molesttrait gte 1 and $rapeavoid is 1>>
			<<else>>
				<<set $controlstart to $control>><<control -25>>
				<<if $control gte ($controlmax * 0.74)>>
					<span class="purple">你的控制感动摇了。</span>
				<<elseif $control gte ($controlmax * 0.49)>>
					<span class="purple">你的控制感下降了。</span>
				<<elseif $control gte ($controlmax * 0.24)>>
					<span class="pink">你的控制感破碎了。</span>
				<<elseif $control gte 1>>
					<span class="pink">你的控制感崩溃了。</span>
				<<else>>
					<span class="red">你完全失去了对自己的控制。</span>
				<</if>>
			<</if>>
		<</if>>
	<</if>>
<</widget>>

<<widget "beastescape">>
	<<trauma 12>><<pain 6>><<stress 12>>
	<<set $worn.over_lower.integrity -= 20>>
	<<set $worn.over_upper.integrity -= 20>>
	<<set $worn.lower.integrity -= 20>>
	<<set $worn.upper.integrity -= 20>>
	<<set $worn.under_lower.integrity -= 20>>
	<<set $worn.under_upper.integrity -= 20>>
	<<bruise full>>
	<<gtrauma>><<gpain>><<gstress>>
<</widget>>

<<widget "weatherdisplay">>
	<<if Time.season is "winter">>
		<<set _weather_display to "winter">>
	<<else>>
		<<set _weather_display to "normal">>
	<</if>>

	<<if $options.images is 1>>
		<<if Time.dayState is "day">>
			<<if $location is "tentworld">>
				<img id="daystate" src="img/misc/tentskyday.png">
			<<else>>
				<img id="daystate" src="img/misc/day.png">
			<</if>>

			<<if $location is "tentworld">>
				<img id="weather" src="img/misc/tentskyday.png">
			<<else>>
				<<switch $weather>>
					<<case "clear">>	<img id="weather" src="img/misc/clearday.png">
					<<case "overcast">> <img id="weather" @src="'img/misc/' + _weather_display + '/overcastday.png'">
					<<case "rain">>		<img id="weather" src="img/misc/rainday.gif">
					<<case "snow">>		<img id="weather" src="img/misc/winter/snowday.gif">
				<</switch>>
			<</if>>

			<<switch $location>>
				<<case "beach">>
					<img id="location" @src="'img/misc/' + _weather_display + '/beachday.gif'">
				<<case "chalets">>
					<img id="location" @src="'img/misc/' + _weather_display + '/beachday.gif'">
				<<case "sea">>
					<img id="location" @src="'img/misc/' + _weather_display + '/ocean_day.gif'">
				<<case "home">>
					<img id="location" @src="'img/misc/' + _weather_display + '/home_day.gif'">
				<<case "town">>
					<img id="location" @src="'img/misc/' + _weather_display + '/town_day.gif'">
				<<case "docks">>
					<img id="location" @src="'img/misc/' + _weather_display + '/docks_day.png'">
				<<case "pub">>
					<img id="location" @src="'img/misc/' + _weather_display + '/pubday.png'">
				<<case "forest">>
					<img id="location" @src="'img/misc/' + _weather_display + '/forestday.gif'">
				<<case "lake">>
					<img id="location" @src="'img/misc/' + _weather_display + '/lakeday.gif'">
				<<case "asylum">>
					<<if $hallucinations gte 1>>
						<img id="location" @src="'img/misc/' + _weather_display + '/asylumdayvfast.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/asylumdayslow.gif'">
					<</if>>
				<<case "tentworld">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tentacles_day.gif'">
				<<case "underground">>
					<img id="location" @src="'img/misc/' + _weather_display + '/undergroundday.png'">
				<<case "sewers">>
					<img id="location" @src="'img/misc/' + _weather_display + '/sewersday.gif'">
				<<case "school">>
					<img id="location" @src="'img/misc/' + _weather_display + '/schoolday.png'">
				<<case "cabin">>
					<<if Time.season is "winter">>
						<img id="location" @src="'img/misc/' + _weather_display + '/cabinday.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cabinday.gif'">
					<</if>>
				<<case "pool">>
					<img id="location" @src="'img/misc/' + _weather_display + '/poolday.gif'">
				<<case "landfill">>
					<img id="location" @src="'img/misc/' + _weather_display + '/landfillday.png'">
				<<case "adult_shop">>
					<<getadultshopstate>>
					<<if $adultshopstate is "closed">>
						<img id="location" @src="'img/misc/' + _weather_display + '/sex_shop_day.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/sex_shop_day_open.gif'">
					<</if>>
				<<case "temple">>
					<<if Time.year is 361>>
						<img id="location" @src="'img/misc/' + _weather_display + '/templeday_old.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/templeday.png'">
					<</if>>
				<<case "strip_club">>
					<img id="location" @src="'img/misc/' + _weather_display + '/strip_club_day.png'">
				<<case "shopping_centre">>
					<img id="location" @src="'img/misc/' + _weather_display + '/shopping_centre_day.png'">
				<<case "police_station">>
					<img id="location" @src="'img/misc/' + _weather_display + '/police_station_day.png'">
				<<case "park">>
					<<if Time.season is "winter">>
						<img id="location" src="img/misc/winter/park_day.png">
					<<else>>
						<img id="location" src="img/misc/normal/park_day.gif">
					<</if>>
				<<case "museum">>
					<img id="location" @src="'img/misc/' + _weather_display + '/museum_day.png'">
				<<case "hospital">>
					<img id="location" @src="'img/misc/' + _weather_display + '/hospital_day.png'">
				<<case "dance_studio">>
					<img id="location" @src="'img/misc/' + _weather_display + '/dance_studio_day.png'">
				<<case "compound">>
					<img id="location" @src="'img/misc/' + _weather_display + '/compound_day.gif'">
				<<case "brothel">>
					<img id="location" @src="'img/misc/' + _weather_display + '/brothel_day.png'">
				<<case "cafe">>
					<<if $chef_state gte 9>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_renovated_day.png'">
					<<elseif $chef_state gte 7>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_construction_day.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_day.png'">
					<</if>>
				<<case "arcade">>
					<img id="location" @src="'img/misc/' + _weather_display + '/arcade_day.png'">
				<<case "farm">>
					<img id="location" @src="'img/misc/' + _weather_display + '/farm_day.png'">
				<<case "alex_farm">>
					<<if $bus is "woodland">>
						<img id="location" @src="'img/misc/' + _weather_display + '/forestday.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/alex_farm_day.png'">
					<</if>>
				<<case "alex_cottage">>
					<img id="location" @src="'img/misc/' + _weather_display + '/alex_cottage_day.png'">
				<<case "riding_school">>
					<img id="location" @src="'img/misc/' + _weather_display + '/riding_school_day.gif'">
				<<case "estate">>
					<img id="location" @src="'img/misc/' + _weather_display + '/remy_farm_day.png'">
				<<case "wolf_cave">>
					<img id="location" @src="'img/misc/' + _weather_display + '/wolf_cave_day.png'">
				<<case "forest_shop">>
					<img id="location" @src="'img/misc/' + _weather_display + '/forest_shop_day.png'">
				<<case "lake_ruin">>
					<img id="location" @src="'img/misc/' + _weather_display + '/ruins_day.gif'">
				<<case "moor">>
					<img id="location" @src="'img/misc/' + _weather_display + '/moor_day.gif'">
				<<case "tower">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tower_day.gif'">
				<<case "castle">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tower_day.gif'">
				<<case "night_monster_lair">>
					<img id="location" @src="'img/misc/' + _weather_display + '/night_monster_lair_day.gif'">
				<<case "alley">>
					<<if $bus is "industrial">>
						<img id="location" @src="'img/misc/' + _weather_display + '/indust_alley_day.gif'">
					<<elseif $bus is "residential">>
						<img id="location" @src="'img/misc/' + _weather_display + '/resi_alley_day.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/alley_day.gif'">
					<</if>>
				<<case "drain">>
					<img id="location" @src="'img/misc/' + _weather_display + '/drain.gif'">
				<<case "spa">>
					<img id="location" @src="'img/misc/' + _weather_display + '/spa_day.gif'">
				<<case "prison">>
					<img id="location" @src="'img/misc/' + _weather_display + '/prison_day.gif'">
				<<case "promenade">>
					<img id="location" @src="'img/misc/' + _weather_display + '/promenade_beach_day.gif'">
				<<case "factory">>
					<img id="location" @src="'img/misc/' + _weather_display + '/factory_day.gif'">
				<<case "pound">>
					<img id="location" @src="'img/misc/' + _weather_display + '/dog_pound_day.gif'">
				<<case "office_building">>
					<img id="location" @src="'img/misc/' + _weather_display + '/office_day.png'">
				<<case "kylar_manor">>
					<img id="location" @src="'img/misc/' + _weather_display + '/kylar_manor_day.png'">
				<<case "flats">>
					<img id="location" @src="'img/misc/' + _weather_display + '/flats_day.png'">
				<<case "canal">>
					<img id="location" @src="'img/misc/' + _weather_display + '/canal_day.gif'">
				<<case "mines">>
					<img id="location" @src="'img/misc/' + _weather_display + '/undergroundday.png'">
			<</switch>>
		<<elseif Time.dayState is "night">>
			<!-- if bloodmoon -->
			<<set _bloodmoon to (isBloodmoon() or $forcedBloodmoon)>>

			<<if $location is "tentworld">>
				<img id="daystate" src="img/misc/tentskynight.png">
			<<else>>
				<img id="daystate" @src="'img/misc' + (_bloodmoon ? '/fullnight.png' : '/night.png')">
			<</if>>

			<<if $location is "tentworld">>
				<img id="weather" src="img/misc/tentskynight.png">
			<<else>>
				<<switch $weather>>
					<<case "clear">>	<img id="weather" src="img/misc/clearnight.png">
					<<case "overcast">> <img id="weather" @src="'img/misc/' + _weather_display + '/overcastnight.png'">
					<<case "rain">>		<img id="weather" src="img/misc/rainnight.gif">
					<<case "snow">>		<img id="weather" src="img/misc/winter/snownight.gif">
				<</switch>>
			<</if>>

			<<switch $location>>
				<<case "beach">>
					<img id="location" @src="'img/misc/' + _weather_display + '/beachnight.gif'">
				<<case "chalets">>
					<img id="location" @src="'img/misc/' + _weather_display + '/beachnight.gif'">
				<<case "sea">>
					<img id="location" @src="'img/misc/' + _weather_display + '/ocean_night.gif'">
				<<case "home">>
					<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/home_night_blood.gif' : '/home_night.gif')">
				<<case "town">>
					<img id="location" @src="'img/misc/' + _weather_display + '/town_night.gif'">
				<<case "docks">>
					<img id="location" @src="'img/misc/' + _weather_display + '/docks_night.png'">
				<<case "pub">>
					<img id="location" @src="'img/misc/' + _weather_display + '/pubnight.png'">
				<<case "forest">>
					<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/forestbloodmoon.gif' : '/forestnight.png')">
				<<case "lake">>
					<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/lakebloodmoon.gif' : '/lakenight.gif')">
				<<case "asylum">>
					<<if $hallucinations gte 1>>
						<img id="location" @src="'img/misc/' + _weather_display + '/asylumnightvfast.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/asylumnightslow.gif'">
					<</if>>
				<<case "tentworld">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tentacles_night.gif'">
				<<case "underground">>
					<img id="location" @src="'img/misc/' + _weather_display + '/undergroundnight.png'">
				<<case "sewers">>
					<img id="location" @src="'img/misc/' + _weather_display + '/sewersnight.gif'">
				<<case "school">>
					<img id="location" @src="'img/misc/' + _weather_display + '/schoolnight.png'">
				<<case "cabin">>
					<<if Time.season is "winter">>
						<img id="location" @src="'img/misc/' + _weather_display + '/cabinnight.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cabinnight.gif'">
					<</if>>
				<<case "pool">>
					<img id="location" @src="'img/misc/' + _weather_display + '/poolnight.gif'">
				<<case adult_shop>>
				<img id="location" @src="'img/misc/' + _weather_display + '/sex_shop_night.gif'">
				<<case "landfill">>
					<img id="location" @src="'img/misc/' + _weather_display + '/landfillnight.png'">
				<<case "temple">>
					<<if Time.year is 361>>
						<img id="location" @src="'img/misc/' + _weather_display + '/templenight_old.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/templenight.png'">
					<</if>>
				<<case "strip_club">>
					<img id="location" @src="'img/misc/' + _weather_display + '/strip_club_night.png'">
				<<case "shopping_centre">>
					<img id="location" @src="'img/misc/' + _weather_display + '/shopping_centre_night.png'">
				<<case "police_station">>
					<img id="location" @src="'img/misc/' + _weather_display + '/police_station_night.png'">
				<<case "park">>
					<<if Time.season is "winter">>
						<img id="location" src="img/misc/winter/park_night.png">
					<<else>>
						<img id="location" src="img/misc/normal/park_night.gif">
					<</if>>
				<<case "museum">>
					<img id="location" @src="'img/misc/' + _weather_display + '/museum_night.png'">
				<<case "hospital">>
					<img id="location" @src="'img/misc/' + _weather_display + '/hospital_night.png'">
				<<case "dance_studio">>
					<img id="location" @src="'img/misc/' + _weather_display + '/dance_studio_night.png'">
				<<case "compound">>
					<img id="location" @src="'img/misc/' + _weather_display + '/compound_night.gif'">
				<<case "brothel">>
					<img id="location" @src="'img/misc/' + _weather_display + '/brothel_night.png'">
				<<case "cafe">>
					<<if $chef_state gte 9>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_renovated_night.png'">
					<<elseif $chef_state gte 7>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_construction_night.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_night.png'">
					<</if>>
				<<case "arcade">>
					<img id="location" @src="'img/misc/' + _weather_display + '/arcade_night.png'">
				<<case "farm">>
					<img id="location" @src="'img/misc/' + _weather_display + '/farm_night.png'">
				<<case "alex_farm">>
					<<if $bus is "woodland">>
						<img id="location" @src="'img/misc/' + _weather_display + '/forestnight.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/alex_farm_night.png'">
					<</if>>
				<<case "alex_cottage">>
					<img id="location" @src="'img/misc/' + _weather_display + '/alex_cottage_night.png'">
				<<case "riding_school">>
					<img id="location" @src="'img/misc/' + _weather_display + '/riding_school_night.gif'">
				<<case "estate">>
					<img id="location" @src="'img/misc/' + _weather_display + '/remy_farm_night.png'">
				<<case "wolf_cave">>
					<img id="location" @src="'img/misc/' + _weather_display + '/wolf_cave_night.png'">
				<<case "forest_shop">>
					<img id="location" @src="'img/misc/' + _weather_display + '/forest_shop_night.png'">
				<<case "lake_ruin">>
					<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/ruins_blood_moon.gif' : '/ruins_night.gif')">
				<<case "moor">>
					<img id="location" @src="'img/misc/' + _weather_display + '/moor_night.gif'">
				<<case "tower">>
					<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/tower_blood.gif' : '/tower_night.gif')">
				<<case "castle">>
					<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/tower_blood.gif' : '/tower_night.gif')">
				<<case "night_monster_lair">>
					<img id="location" @src="'img/misc/' + _weather_display + '/night_monster_lair_night.gif'">
				<<case "alley">>
					<<if $bus is "industrial">>
						<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/indust_alley_blood.gif' : '/indust_alley_night.gif')">
					<<elseif $bus is "residential">>
						<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/resi_alley_blood.gif' : '/resi_alley_night.gif')">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/alley_blood.gif' : '/alley_night.gif')">
					<</if>>
				<<case "drain">>
					<img id="location" @src="'img/misc/' + _weather_display + '/drain.gif'">
				<<case "spa">>
					<img id="location" @src="'img/misc/' + _weather_display + '/spa_night.gif'">
				<<case "prison">>
					<img id="location" @src="'img/misc/' + _weather_display + (_bloodmoon ? '/prison_blood_moon.gif' : '/prison_night.gif')">
				<<case "promenade">>
					<img id="location" @src="'img/misc/' + _weather_display + '/promenade_beach_night.gif'">
				<<case "factory">>
					<img id="location" @src="'img/misc/' + _weather_display + '/factory_night.png'">
				<<case "pound">>
					<img id="location" @src="'img/misc/' + _weather_display + '/dog_pound_night.png'">
				<<case "office_building">>
					<img id="location" @src="'img/misc/' + _weather_display + '/office_night.png'">
				<<case "kylar_manor">>
					<img id="location" @src="'img/misc/' + _weather_display + '/kylar_manor_night.png'">
				<<case "flats">>
					<img id="location" @src="'img/misc/' + _weather_display + '/flats_night.png'">
				<<case "canal">>
					<img id="location" @src="'img/misc/' + _weather_display + '/canal_night.gif'">
				<<case "mines">>
					<img id="location" @src="'img/misc/' + _weather_display + '/undergroundnight.png'">
			<</switch>>
		<<elseif Time.dayState is "dawn">>
			<<if $location is "tentworld">>
				<img id="daystate" src="img/misc/tentskydawn.png">
			<<else>>
				<img id="daystate" src="img/misc/dawn.png">
			<</if>>

			<<if $location is "tentworld">>
				<img id="weather" src="img/misc/tentskydawn.png">
			<<else>>
				<<switch $weather>>
					<<case "clear">>	<img id="weather" src="img/misc/cleardawn.png">
					<<case "overcast">> <img id="weather" @src="'img/misc/' + _weather_display + '/overcastdawn.png'">
					<<case "rain">>		<img id="weather" src="img/misc/raindawn.gif">
					<<case "snow">>		<img id="weather" src="img/misc/winter/snowdawn.gif">
				<</switch>>
			<</if>>

			<<switch $location>>
				<<case "beach">>
					<img id="location" @src="'img/misc/' + _weather_display + '/beachdawn.gif'">
				<<case "chalets">>
					<img id="location" @src="'img/misc/' + _weather_display + '/beachdawn.gif'">
				<<case "sea">>
					<img id="location" @src="'img/misc/' + _weather_display + '/ocean_dawn.gif'">
				<<case "home">>
					<img id="location" @src="'img/misc/' + _weather_display + '/home_dawn.gif'">
				<<case "town">>
					<img id="location" @src="'img/misc/' + _weather_display + '/town_dawn.gif'">
				<<case "docks">>
					<img id="location" @src="'img/misc/' + _weather_display + '/docks_dawn.png'">
				<<case "pub">>
					<img id="location" @src="'img/misc/' + _weather_display + '/pubdawn.png'">
				<<case "forest">>
					<img id="location" @src="'img/misc/' + _weather_display + '/forestdawn.png'">
				<<case "lake">>
					<img id="location" @src="'img/misc/' + _weather_display + '/lakedawn.gif'">
				<<case "asylum">>
					<<if $hallucinations gte 1>>
						<img id="location" @src="'img/misc/' + _weather_display + '/asylumdawnvfast.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/asylumdawnslow.gif'">
					<</if>>
				<<case "tentworld">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tentacles_dawn.gif'">
				<<case "underground">>
					<img id="location" @src="'img/misc/' + _weather_display + '/undergrounddawn.png'">
				<<case "sewers">>
					<img id="location" @src="'img/misc/' + _weather_display + '/sewersdawn.gif'">
				<<case "school">>
					<img id="location" @src="'img/misc/' + _weather_display + '/schooldawn.png'">
				<<case "cabin">>
					<<if Time.season is "winter">>
						<img id="location" @src="'img/misc/' + _weather_display + '/cabindawn.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cabindawn.gif'">
					<</if>>
				<<case "pool">>
					<img id="location" @src="'img/misc/' + _weather_display + '/pooldawn.gif'">
				<<case "landfill">>
					<img id="location" @src="'img/misc/' + _weather_display + '/landfilldawn.png'">
				<<case adult_shop>>
				<img id="location" @src="'img/misc/' + _weather_display + '/sex_shop_dawn.png'">
				<<case "temple">>
					<<if Time.year is 361>>
						<img id="location" @src="'img/misc/' + _weather_display + '/templedawn_old.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/templedawn.png'">
					<</if>>
				<<case "strip_club">>
					<img id="location" @src="'img/misc/' + _weather_display + '/strip_club_dawn.png'">
				<<case "shopping_centre">>
					<img id="location" @src="'img/misc/' + _weather_display + '/shopping_centre_dawn.png'">
				<<case "police_station">>
					<img id="location" @src="'img/misc/' + _weather_display + '/police_station_dawn.png'">
				<<case "park">>
					<img id="location" @src="'img/misc/' + _weather_display + '/park_dawn.gif'">
				<<case "museum">>
					<img id="location" @src="'img/misc/' + _weather_display + '/museum_dawn.png'">
				<<case "hospital">>
					<img id="location" @src="'img/misc/' + _weather_display + '/hospital_dawn.png'">
				<<case "dance_studio">>
					<img id="location" @src="'img/misc/' + _weather_display + '/dance_studio_dawn.png'">
				<<case "compound">>
					<img id="location" @src="'img/misc/' + _weather_display + '/compound_dawn.gif'">
				<<case "brothel">>
					<img id="location" @src="'img/misc/' + _weather_display + '/brothel_dawn.png'">
				<<case "cafe">>
					<<if $chef_state gte 9>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_renovated_dawn.png'">
					<<elseif $chef_state gte 7>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_construction_dawn.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_dawn.png'">
					<</if>>
				<<case "arcade">>
					<img id="location" @src="'img/misc/' + _weather_display + '/arcade_dawn.png'">
				<<case "farm">>
					<img id="location" @src="'img/misc/' + _weather_display + '/farm_dawn.png'">
				<<case "alex_farm">>
					<<if $bus is "woodland">>
						<img id="location" @src="'img/misc/' + _weather_display + '/forestdawn.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/alex_farm_dawn.png'">
					<</if>>
				<<case "alex_cottage">>
					<img id="location" @src="'img/misc/' + _weather_display + '/alex_cottage_dawn.png'">
				<<case "riding_school">>
					<img id="location" @src="'img/misc/' + _weather_display + '/riding_school_dawn.gif'">
				<<case "estate">>
					<img id="location" @src="'img/misc/' + _weather_display + '/remy_farm_dawn.png'">
				<<case "wolf_cave">>
					<img id="location" @src="'img/misc/' + _weather_display + '/wolf_cave_dawn.png'">
				<<case "forest_shop">>
					<img id="location" @src="'img/misc/' + _weather_display + '/forest_shop_dawn.png'">
				<<case "lake_ruin">>
					<img id="location" @src="'img/misc/' + _weather_display + '/ruins_dawn.gif'">
				<<case "moor">>
					<img id="location" @src="'img/misc/' + _weather_display + '/moor_dawn.gif'">
				<<case "tower">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tower_dawn.gif'">
				<<case "castle">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tower_dawn.gif'">
				<<case "night_monster_lair">>
					<img id="location" @src="'img/misc/' + _weather_display + '/night_monster_lair_dawn.gif'">
				<<case "alley">>
					<<if $bus is "industrial">>
						<img id="location" @src="'img/misc/' + _weather_display + '/indust_alley_dawn.gif'">
					<<elseif $bus is "residential">>
						<img id="location" @src="'img/misc/' + _weather_display + '/resi_alley_dawn.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/alley_dawn.gif'">
					<</if>>
				<<case "drain">>
					<img id="location" @src="'img/misc/' + _weather_display + '/drain.gif'">
				<<case "spa">>
					<img id="location" @src="'img/misc/' + _weather_display + '/spa_dawn.gif'">
				<<case "prison">>
					<img id="location" @src="'img/misc/' + _weather_display + '/prison_dawn.gif'">
				<<case "promenade">>
					<img id="location" @src="'img/misc/' + _weather_display + '/promenade_beach_dawn.gif'">
				<<case "factory">>
					<img id="location" @src="'img/misc/' + _weather_display + '/factory_dawn.gif'">
				<<case "pound">>
					<img id="location" @src="'img/misc/' + _weather_display + '/dog_pound_dawn.gif'">
				<<case "office_building">>
					<img id="location" @src="'img/misc/' + _weather_display + '/office_dawn.png'">
				<<case "kylar_manor">>
					<img id="location" @src="'img/misc/' + _weather_display + '/kylar_manor_dawn.png'">
				<<case "flats">>
					<img id="location" @src="'img/misc/' + _weather_display + '/flats_dawn.png'">
				<<case "canal">>
					<img id="location" @src="'img/misc/' + _weather_display + '/canal_dawn.gif'">
				<<case "mines">>
					<img id="location" @src="'img/misc/' + _weather_display + '/undergrounddawn.png'">
			<</switch>>
		<<elseif Time.dayState is "dusk">>
			<<if $location is "tentworld">>
				<img id="daystate" src="img/misc/tentskydusk.png">
			<<else>>
				<img id="daystate" src="img/misc/dusk.png">
			<</if>>

			<<if $location is "tentworld">>
				<img id="weather" src="img/misc/tentskydusk.png">
			<<else>>
				<<switch $weather>>
					<<case "clear">>	<img id="weather" src="img/misc/cleardusk.png">
					<<case "overcast">> <img id="weather" @src="'img/misc/' + _weather_display + '/overcastdusk.png'">
					<<case "rain">>		<img id="weather" src="img/misc/raindusk.gif">
					<<case "snow">>		<img id="weather" src="img/misc/winter/snowdusk.gif">
				<</switch>>
			<</if>>

			<<switch $location>>
				<<case "beach">>
					<img id="location" @src="'img/misc/' + _weather_display + '/beachdusk.gif'">
				<<case "chalets">>
					<img id="location" @src="'img/misc/' + _weather_display + '/beachdusk.gif'">
				<<case "sea">>
					<img id="location" @src="'img/misc/' + _weather_display + '/ocean_dusk.gif'">
				<<case "home">>
					<img id="location" @src="'img/misc/' + _weather_display + '/home_dusk.gif'">
				<<case "town">>
					<img id="location" @src="'img/misc/' + _weather_display + '/town_dusk.png'">
				<<case "docks">>
					<img id="location" @src="'img/misc/' + _weather_display + '/docks_dusk.png'">
				<<case "pub">>
					<img id="location" @src="'img/misc/' + _weather_display + '/pubdusk.png'">
				<<case "forest">>
					<img id="location" @src="'img/misc/' + _weather_display + '/forestdusk.gif'">
				<<case "lake">>
					<img id="location" @src="'img/misc/' + _weather_display + '/lakedusk.gif'">
				<<case "asylum">>
					<<if $hallucinations gte 1>>
						<img id="location" @src="'img/misc/' + _weather_display + '/asylumduskvfast.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/asylumduskslow.gif'">
					<</if>>
				<<case "tentworld">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tentacles_dusk.gif'">
				<<case "underground">>
					<img id="location" @src="'img/misc/' + _weather_display + '/undergrounddusk.png'">
				<<case "sewers">>
					<img id="location" @src="'img/misc/' + _weather_display + '/sewersdusk.gif'">
				<<case "school">>
					<img id="location" @src="'img/misc/' + _weather_display + '/schooldusk.png'">
				<<case "cabin">>
					<<if Time.season is "winter">>
						<img id="location" @src="'img/misc/' + _weather_display + '/cabindusk.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cabindusk.gif'">
					<</if>>
				<<case "pool">>
					<img id="location" @src="'img/misc/' + _weather_display + '/pooldusk.gif'">
				<<case "landfill">>
					<img id="location" @src="'img/misc/' + _weather_display + '/landfilldusk.png'">
				<<case adult_shop>>
				<img id="location" @src="'img/misc/' + _weather_display + '/sex_shop_dusk.gif'">
				<<case "temple">>
					<<if Time.year is 361>>
						<img id="location" @src="'img/misc/' + _weather_display + '/templedusk_old.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/templedusk.png'">
					<</if>>
				<<case "strip_club">>
					<img id="location" @src="'img/misc/' + _weather_display + '/strip_club_dusk.png'">
				<<case "shopping_centre">>
					<img id="location" @src="'img/misc/' + _weather_display + '/shopping_centre_dusk.png'">
				<<case "police_station">>
					<img id="location" @src="'img/misc/' + _weather_display + '/police_station_dusk.png'">
				<<case "park">>
					<<if Time.season is "winter">>
						<img id="location" src="img/misc/winter/park_dusk.png">
					<<else>>
						<img id="location" src="img/misc/normal/park_dusk.gif">
					<</if>>
				<<case "museum">>
					<img id="location" @src="'img/misc/' + _weather_display + '/museum_dusk.png'">
				<<case "hospital">>
					<img id="location" @src="'img/misc/' + _weather_display + '/hospital_dusk.png'">
				<<case "dance_studio">>
					<img id="location" @src="'img/misc/' + _weather_display + '/dance_studio_dusk.png'">
				<<case "compound">>
					<img id="location" @src="'img/misc/' + _weather_display + '/compound_dusk.gif'">
				<<case "brothel">>
					<img id="location" @src="'img/misc/' + _weather_display + '/brothel_dusk.png'">
				<<case "cafe">>
					<<if $chef_state gte 9>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_renovated_dusk.png'">
					<<elseif $chef_state gte 7>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_construction_dusk.png'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/cafe_dusk.png'">
					<</if>>
				<<case "arcade">>
					<img id="location" @src="'img/misc/' + _weather_display + '/arcade_dusk.png'">
				<<case "farm">>
					<img id="location" @src="'img/misc/' + _weather_display + '/farm_dusk.png'">
				<<case "alex_farm">>
					<<if $bus is "woodland">>
						<img id="location" @src="'img/misc/' + _weather_display + '/forestdusk.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/alex_farm_dusk.png'">
					<</if>>
				<<case "alex_cottage">>
					<img id="location" @src="'img/misc/' + _weather_display + '/alex_cottage_dusk.png'">
				<<case "riding_school">>
					<img id="location" @src="'img/misc/' + _weather_display + '/riding_school_dusk.gif'">
				<<case "estate">>
					<img id="location" @src="'img/misc/' + _weather_display + '/remy_farm_dusk.png'">
				<<case "wolf_cave">>
					<img id="location" @src="'img/misc/' + _weather_display + '/wolf_cave_dusk.png'">
				<<case "forest_shop">>
					<img id="location" @src="'img/misc/' + _weather_display + '/forest_shop_dusk.png'">
				<<case "lake_ruin">>
					<img id="location" @src="'img/misc/' + _weather_display + '/ruins_dusk.gif'">
				<<case "moor">>
					<img id="location" @src="'img/misc/' + _weather_display + '/moor_dusk.gif'">
				<<case "tower">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tower_dusk.gif'">
				<<case "castle">>
					<img id="location" @src="'img/misc/' + _weather_display + '/tower_dusk.gif'">
				<<case "night_monster_lair">>
					<img id="location" @src="'img/misc/' + _weather_display + '/night_monster_lair_dusk.gif'">
				<<case "alley">>
					<<if $bus is "industrial">>
						<img id="location" @src="'img/misc/' + _weather_display + '/indust_alley_dusk.gif'">
					<<elseif $bus is "residential">>
						<img id="location" @src="'img/misc/' + _weather_display + '/resi_alley_dusk.gif'">
					<<else>>
						<img id="location" @src="'img/misc/' + _weather_display + '/alley_dusk.gif'">
					<</if>>
				<<case "drain">>
					<img id="location" @src="'img/misc/' + _weather_display + '/drain.gif'">
				<<case "spa">>
					<img id="location" @src="'img/misc/' + _weather_display + '/spa_dusk.gif'">
				<<case "prison">>
					<img id="location" @src="'img/misc/' + _weather_display + '/prison_dusk.gif'">
				<<case "promenade">>
					<img id="location" @src="'img/misc/' + _weather_display + '/promenade_beach_dusk.gif'">
				<<case "factory">>
					<img id="location" @src="'img/misc/' + _weather_display + '/factory_dusk.gif'">
				<<case "pound">>
					<img id="location" @src="'img/misc/' + _weather_display + '/dog_pound_dusk.gif'">
				<<case "office_building">>
					<img id="location" @src="'img/misc/' + _weather_display + '/office_dusk.png'">
				<<case "kylar_manor">>
					<img id="location" @src="'img/misc/' + _weather_display + '/kylar_manor_dusk.png'">
				<<case "flats">>
					<img id="location" @src="'img/misc/' + _weather_display + '/flats_dusk.png'">
				<<case "canal">>
					<img id="location" @src="'img/misc/' + _weather_display + '/canal_dusk.gif'">
				<<case "mines">>
					<img id="location" @src="'img/misc/' + _weather_display + '/undergrounddusk.png'">
			<</switch>>
		<</if>>
	<<else>>
		<<switch Time.dayState>>
			<<case "day">>
				<<switch $weather>>
					<<case "clear">>外面阳光明媚。
					<<case "rain">>外面正在下雨。
					<<case "overcast">>乌云遮住了日光。
					<<case "snow">>雪花从空中飘落。
				<</switch>>
			<<case "night">>
				<<switch $weather>>
					<<case "clear">>星星在夜光下闪烁。
					<<case "rain">>外面正在下雨。
					<<case "overcast">>漫天的乌云遮蔽了星光。
					<<case "snow">>雪花安静地从空中飘落。
				<</switch>>
			<<case "dawn">>
				<<switch $weather>>
					<<case "clear">>太阳正从地平线上缓缓升起。
					<<case "rain">>外面正在下雨。
					<<case "overcast">>外面乌云密布。
					<<case "snow">>雪花从空中飘落。
				<</switch>>
			<<case "dusk">>
				<<switch $weather>>
					<<case "clear">>落日的余晖在地平线上闪烁。
					<<case "rain">>外面正在下雨。
					<<case "overcast">>外面乌云密布。
					<<case "snow">>雪花在夕阳下飘落。
				<</switch>>
		<</switch>>
		<br>
	<</if>>
<</widget>>

<<widget "wearandtear">>
	<<if _args[0] is "dance">>
		<<if !$worn.over_upper.type.includes("dance")>>
			<<set $worn.over_upper.integrity -= 1>>
		<</if>>
		<<if !$worn.over_lower.type.includes("dance")>>
			<<set $worn.over_lower.integrity -= 1>>
		<</if>>
		<<if !$worn.upper.type.includes("dance")>>
			<<set $worn.upper.integrity -= 1>>
		<</if>>
		<<if !$worn.lower.type.includes("dance")>>
			<<set $worn.lower.integrity -= 1>>
		<</if>>
		<<if !$worn.under_lower.type.includes("dance")>>
			<<set $worn.under_lower.integrity -= 1>>
		<</if>>
		<<if !$worn.under_upper.type.includes("dance")>>
			<<set $worn.under_upper.integrity -= 1>>
		<</if>>
	<<else>>
		<<set $worn.over_upper.integrity -= 1>><<set $worn.over_lower.integrity -= 1>><<set $worn.upper.integrity -= 1>><<set $worn.lower.integrity -= 1>><<set $worn.under_lower.integrity -= 1>><<set $worn.under_upper.integrity -= 1>>
	<</if>>
<</widget>>

<<widget "dry_towel">>
	<<dry_full>>
	<<exposure>>
	<<if $exposed gte 1>>
		<<towelup>>
	<</if>>
<</widget>>

<<widget "towelup">>
	<<if $exposed gte 1>>
		<<if $upperwetstage gte 3>>
			<<upperwear 3>>
		<</if>>
		<<if $lowerwetstage gte 3>>
			<<lowerwear 3>>
		<</if>>
		<<if $worn.upper.exposed gte 1>>
			<<upperwear 14>>
		<<elseif $worn.lower.exposed gte 1>>
			<<lowerwear 3>>
		<</if>>
	<</if>>
<</widget>>

<<widget "towelupm">>
	<<if $exposed gte 1>>
		<<if $lowerwetstage gte 3>>
			<<lowerwear 3>>
		<</if>>
		<<if $worn.lower.exposed gte 1>>
			<<lowerwear 3>>
		<</if>>
	<</if>>
<</widget>>

<<widget "ragup">>
<<if $worn.upper.exposed gte 2>>
	<<upperwear 79>>
<</if>>

<<if $worn.lower.exposed gte 2>>
	<<lowerwear 71>>
<</if>>
<</widget>>

<<widget "plantupper">>
	<<if $worn.upper.exposed gte 2 and $worn.under_upper.exposed gte 1
	or $worn.upper.exposed gte 2 and $underupperwetstage gte 3
	or $upperwetstage gte 3 and $worn.under_upper.exposed gte 1
	or $upperwetstage gte 3 and $underupperwetstage gte 3
	or _args[0] is "force">>
		<<upperwear 6>>
	<</if>>
<</widget>>

<<widget "plantlower">>
	<<if $worn.lower.exposed gte 2 and $worn.under_lower.exposed gte 1
	or $worn.lower.exposed gte 2 and $underlowerwetstage gte 3
	or $lowerwetstage gte 3 and $worn.under_lower.exposed gte 1
	or $lowerwetstage gte 3 and $underlowerwetstage gte 3
	or _args[0] is "force">>
		<<lowerwear 8>>
	<</if>>
<</widget>>

<<widget "plantup">>
	<<if $worn.upper.exposed gte 2 and $worn.under_upper.exposed gte 1 or $upperwetstage gte 3 and $underupperwetstage gte 3>>
		<<upperwear 6>>
	<</if>>
	<<if $worn.lower.exposed gte 2 and $worn.under_lower.exposed gte 1 or $lowerwetstage gte 3 and $underlowerwetstage gte 3 or $lowerwetstage gte 3 and $worn.under_lower.exposed gte 1>>
		<<lowerwear 8>>
	<</if>>
<</widget>>

<<widget "schoolspareclothes">>
	<<if !$worn.upper.type.includes("school") or !$worn.lower.type.includes("school") and $worn.upper.set is $worn.lower.set>>
		<<upperwear 5>><<set $worn.upper.colour to either("black", "blue", "brown", "green", "pink", "purple", "red", "tangerine", "teal", "white", "yellow")>><<set $worn.upper.integrity /= 2>>
	<</if>>
	<<if !$worn.lower.type.includes("school")>>
		<<if $clothingselector is "m">>
			<<lowerwear 6>><<set $worn.lower.colour to either("black", "blue", "brown", "green", "pink", "purple", "red", "tangerine", "teal", "white", "yellow")>><<set $worn.lower.integrity /= 2>>
		<<else>>
			<<lowerwear 7>><<set $worn.lower.colour to either("black", "blue", "brown", "green", "pink", "purple", "red", "tangerine", "teal", "white", "yellow")>><<set $worn.lower.integrity /= 2>>
		<</if>>
	<</if>>
<</widget>>

<<widget "spareschoolswimsuit">>
	<<underupperwear 2>><<set $worn.under_upper.colour to either("black", "blue", "brown", "green", "pink", "purple", "red", "tangerine", "teal", "white", "yellow")>><<set $worn.under_upper.integrity /= 2>>
	<<set $worn.under_lower.colour to clone($worn.under_upper.colour)>><<set $worn.under_lower.integrity /= 2>>
<</widget>>

<<widget "spareschoolswimshorts">>
	<<underlowerwear 7>><<set $worn.under_lower.colour to either("black", "blue", "brown", "green", "pink", "purple", "red", "tangerine", "teal", "white", "yellow")>><<set $worn.under_lower.integrity /= 2>>
<</widget>>

<<widget "exposure">>
	<<if !["beach","pool","sea","lake","lake_ruin"].includes($location)>>
		<<set $libertine to 0>>
	<<else>>
		<<set $libertine to 1>>
	<</if>>
	<<if $location is "dance_studio" and $worn.under_lower.type.includes("dance") and $worn.under_upper.type.includes("dance")>>
		<<set $libertine to 1>>
	<</if>>

	<<set $worn.over_upper.exposedcarry to $worn.over_upper.exposed>>
	<<set $worn.over_lower.exposedcarry to $worn.over_lower.exposed>>
	<<set $worn.upper.exposedcarry to $worn.upper.exposed>>
	<<set $worn.lower.exposedcarry to $worn.lower.exposed>>
	<<set $worn.under_lower.exposedcarry to $worn.under_lower.exposed>>
	<<set $worn.under_upper.exposedcarry to $worn.under_upper.exposed>>

	<<if $upperwetstage gte 3>>
		<<set $worn.upper.exposed to 2>>
	<</if>>
	<<if $lowerwetstage gte 3>>
		<<set $worn.lower.exposed to 2>>
	<</if>>
	<<if $underlowerwetstage gte 3>>
		<<set $worn.under_lower.exposed to 1>>
	<</if>>
	<<if $underupperwetstage gte 3>>
		<<set $worn.under_upper.exposed to 1>>
	<</if>>

	<<exposedcheck>>

	<<set $exposed to 0>>
	<<if $worn.upper.exposed gte 1 and $worn.over_upper.exposed gte 1>>
		<<if $player.gender_appearance is "m">>
		<<elseif $libertine gte 1 or $possessed>>
		<<else>>
			<<set $exposed to 1>>
		<</if>>
	<</if>>
	<<if $worn.upper.exposed gte 2 and $worn.over_upper.exposed gte 2 and $player.gender_appearance isnot "m">>
		<<if $possessed>>
		<<elseif $libertine is 1>>
			<<set $topless to 1>>
		<<else>>
			<<set $exposed to 1>>
		<</if>>
	<<else>>
		<<set $topless to 0>>
	<</if>>
	<<if $worn.lower.exposed gte 1 and $worn.over_lower.exposed gte 1>>
		<<if $libertine gte 1 or $possessed>>
		<<else>>
			<<set $exposed to 1>>
		<</if>>
	<</if>>

	<<if $worn.lower.exposed gte 2 and $worn.over_lower.exposed gte 2>>
		<<if $possessed>>
		<<elseif $worn.under_lower.exposed gte 1>>
			<<set $exposed to 2>>
		<<elseif $libertine gte 1>>
		<<else>>
			<<set $exposed to 1>>
		<</if>>
	<</if>>

	<<set $worn.over_upper.exposed to $worn.over_upper.exposedcarry>>
	<<set $worn.over_lower.exposed to $worn.over_lower.exposedcarry>>
	<<set $worn.upper.exposed to $worn.upper.exposedcarry>>
	<<set $worn.lower.exposed to $worn.lower.exposedcarry>>
	<<set $worn.under_lower.exposed to $worn.under_lower.exposedcarry>>
	<<set $worn.under_upper.exposed to $worn.under_upper.exposedcarry>>
<</widget>>

<<widget "integritycheck">>
	<<if $worn.over_upper.name isnot "naked">>
		<<if $worn.over_upper.integrity lte 0>>
			<<set $worn.over_upper.type.push("broken")>>
			<<if _args[0] isnot "no_text">>
				<span class="lewd">你的$worn.over_upper.cn_name_cap<<upperplural>>被撕成了碎片<<if $worn.upper.exposed gte 2>>，使你<<breasts>>暴露在了空气之中<</if>>。</span>
				<br>
			<</if>>
		<<overupperruined>><<clothesruinstat>><<if $worn.upper.exposed gte 2>><<set $upperoff to 0>><</if>>
		<</if>>
	<</if>>
	<<if $worn.over_lower.name isnot "naked">>
		<<if $worn.over_lower.integrity lte 0>>
			<<set $worn.over_lower.type.push("broken")>>
			<<if _args[0] isnot "no_text">>
				<span class="lewd">你的$worn.over_lower.cn_name_cap<<upperplural>>被撕成了碎片<<if $worn.lower.exposed gte 2>>，使你<<undies>>暴露在了空气之中<</if>>。</span>
				<br>
			<</if>>
		<<overlowerruined>><<clothesruinstat>><<if $worn.lower.exposed gte 2>><<set $upperoff to 0>><</if>>
		<</if>>
	<</if>>
	<<if $worn.upper.name isnot "naked">>
		<<if $worn.upper.integrity lte 0>>
			<<set $worn.upper.type.push("broken")>>
			<<if _args[0] isnot "no_text">>
				<span class="lewd">你的$worn.upper.cn_name_cap<<upperplural>>被撕成了碎片，使你<<breasts>>暴露在了空气之中。</span>
				<br>
			<</if>>
		<<upperruined>><<clothesruinstat>><<set $upperoff to 0>>
		<</if>>
	<</if>>
	<<if $worn.lower.name isnot "naked">>
		<<if $worn.lower.integrity lte 0>>
			<<set $worn.lower.type.push("broken")>>
			<<if _args[0] isnot "no_text">>
				<span class="lewd">你的$worn.lower.cn_name_cap<<lowerplural>>被撕成了碎片，使你<<undies>>暴露在了空气之中。</span>
				<br>
			<</if>>
		<<lowerruined>><<clothesruinstat>><<set $loweroff to 0>>
		<</if>>
	<</if>>
	<<if $worn.under_upper.name isnot "naked">>
		<<if $worn.under_upper.integrity lte 0>>
			<<set $worn.under_upper.type.push("broken")>>
			<<if _args[0] isnot "no_text">>
				<span class="lewd">你的$worn.under_upper.cn_name_cap<<underupperplural>>被撕成了碎片，使你<<breasts>>暴露在了空气之中。</span>
				<br>
			<</if>>
		<<underupperruined>><<clothesruinstat>><<set $underupperoff to 0>>
		<</if>>
	<</if>>
	<<if $worn.under_lower.name isnot "naked">>
		<<if $worn.under_lower.integrity lte 0>>
			<<set $worn.under_lower.type.push("broken")>>
			<<if _args[0] isnot "no_text">>
				<span class="lewd">你的$worn.under_lower.cn_name_cap<<underlowerplural>>被撕成了碎片，使你<<if $worn.genitals.name isnot "naked">>$worn.genitals.cn_name_cap暴露在了空气之中。<<else>><<genitals>>暴露在了空气之中。<</if>></span>
				<br>
			<</if>>
		<<underlowerruined>><<clothesruinstat>><<set $underloweroff to 0>>
		<</if>>
	<</if>>
	<<if $worn.genitals.name isnot "naked">>
		<<if $worn.genitals.integrity lte 0>>
			<<set _chastityBreak to 1>>
			<<if _args[0] isnot "no_text">>
				<span class="lewd">你的$worn.genitals.cn_name_cap破裂了，使你<<genitals>>暴露在了空气之中。</span>
				<br>
			<</if>>
			<<if playerChastity()>>
				<<set $worn.genitals.type.push("broken")>>
				<<if $vaginalchastityparasite isnot 0>>
					<span class="pink">随着<<print $worn.genitals.cn_name_cap>>的耐久耗尽,那个$vaginalchastityparasite也从你的阴道里掉了出来.</span>
					<br>
					<<set $vaginalchastityparasite to 0>>
				<</if>>
				<<if $penilechastityparasite isnot 0>>
					<span class="pink">随着<<print $worn.genitals.cn_name_cap>>的耐久耗尽,那个$penilechastityparasite也从你的肉棒上掉了下来.</span>
					<br>
					<<set $penilechastityparasite to 0>>
				<</if>>
				<<if $analchastityparasite isnot 0>>
					<span class="pink">随着<<print $worn.genitals.cn_name_cap>>的耐久耗尽,那个$analchastityparasite也从你的菊穴掉落下来.</span>
					<br>
					<<set $analchastityparasite to 0>>
				<</if>>
				<<if playerChastity("anus")>>
					<<set $worn.genitals.anal_shield to 0>>
				<</if>>
			<</if>>
			<<genitalsruined>><<clothesruinstat>>
		<</if>>
	<</if>>
<</widget>>

<<widget "arm_unbind">>
	<<set $rightboundcarry to 0>>
	<<set $leftboundcarry to 0>>
	<<set $leftarm to 0>>
	<<set $rightarm to 0>>
	<<if $worn.upper.type.includes("binding")>>
		<<set _unbind_check to 1>>
		<<if $worn.upper.set is $worn.lower.set>>
			<<set $worn.lower.type.push("broken")>>
			<<lowerruined>>
		<</if>>
		<<set $worn.upper.type.push("broken")>>
		<<upperruined>>
	<</if>>
<</widget>>

<<widget "unbind">>
	<<set $rightboundcarry to 0>>
	<<set $leftboundcarry to 0>>
	<<set $leftarm to 0>>
	<<set $rightarm to 0>>
	<<remove_shackle>>
	<<leg_unbind>>
	<<if $head is "bound">>
		<<set $head to 0>>
	<</if>>
	<<if $worn.upper.type.includes("binding")>>
		<<set _unbind_check to 1>>
		<<if $worn.upper.set is $worn.lower.set>>
			<<set $worn.lower.type.push("broken")>>
			<<lowerruined>>
		<</if>>
		<<set $worn.upper.type.push("broken")>>
		<<upperruined>>
	<</if>>
<</widget>>

<<widget "bind">>
	<<set $leftarm to "bound">>
	<<set $rightarm to "bound">>
<</widget>>

<<widget "legbind">>
	<<set $leftleg to "bound">>
	<<set $rightleg to "bound">>
	<<set $feetuse to "bound">>
<</widget>>

<<widget "leg_unbind">>
	<<set $leftleg to 0>>
	<<set $rightleg to 0>>
	<<set $feetuse to 0>>
<</widget>>

<<widget "remove_shackle">>
	<<if $worn.feet.type.includes("shackle")>>
		<<set $worn.feet.type.push("broken")>>
		<<feetruined>>
		<<leg_unbind>>
	<</if>>
<</widget>>

<<widget "shackle_feet">>
	<<feetwear 3>>
	<<legbind>>
<</widget>>

<<widget "headbind">>
	<<set $head to "bound">>
<</widget>>

<<widget "bindings">>
	<<if $leftarm is "bound" and $position isnot "wall">><<set $leftboundcarry to 1>><</if>>
	<<if $rightarm is "bound" and $position isnot "wall">><<set $rightboundcarry to 1>><</if>>
	<<if $rightboundcarry is 1 and $rightarm isnot "bound">>
		<<set $rightarm to "bound">>
	<</if>>
	<<if $leftboundcarry is 1 and $leftarm isnot "bound">>
		<<set $leftarm to "bound">>
	<</if>>
<</widget>>

<<widget "water">>
	<<if !waterproofCheck($worn.upper) and !$worn.upper.type.includes("naked") and _args[0] isnot "waist">>
		<<set $upperwet to 200>>
	<</if>>
	<<if !waterproofCheck($worn.lower) and !$worn.lower.type.includes("naked")>>
		<<set $lowerwet to 200>>
	<</if>>
	<<if !waterproofCheck($worn.upper) and !waterproofCheck($worn.under_upper) and !$worn.under_upper.type.includes("naked") and _args[0] isnot "waist">>
		<<set $underupperwet to 200>>
	<</if>>
	<<if !waterproofCheck($worn.lower) and !waterproofCheck($worn.under_lower) and !$worn.under_lower.type.includes("naked")>>
		<<set $underlowerwet to 200>>
	<</if>>

	<<waterwash>>
	<<set $inwater to 1>>
	<<set _water_warmth to 0>>
	<<if $location isnot "sea" and $outside is 1 and Time.season is "winter">>
		<<if $worn.upper.type.includes("diving") or $worn.under_upper.type.includes("diving")>>
			<<set _water_warmth += 1>>
		<</if>>
		<<if $worn.lower.type.includes("diving") or $worn.under_lower.type.includes("diving")>>
			<<set _water_warmth += 1>>
		<</if>>
	<<else>>
		<<set _water_warmth to 2>>
	<</if>>
<</widget>>

<<widget "wet_all">>
	<<wet_upper>>
	<<wet_lower>>
<</widget>>

<<widget "wet_upper">>
	<<for _slot range ["over_upper", "upper", "under_upper"]>>
		<<if waterproofCheck($worn[_slot])>>
			/* if the clothing is waterproof, protect it and layers below from getting wet */
			<<break>>
		<<elseif !$worn[_slot].type.includes("naked")>>
			/* skin wetness system is not implemented... yet? */
			<<set V[_slot + "wet"] to 200>>
			<<set V[_slot + "wetstage"] to 3>>
		<</if>>
	<</for>>
<</widget>>

<<widget "wet_lower">>
	<<for _slot range ["over_lower", "lower", "under_lower"]>>
		<<if waterproofCheck($worn[_slot])>>
			<<break>>
		<<elseif !$worn[_slot].type.includes("naked")>>
			<<set V[_slot + "wet"] to 200>>
			<<set V[_slot + "wetstage"] to 3>>
		<</if>>
	<</for>>
<</widget>>

<<widget "storecleanup">>
	<<unset $action_unclad_over_outfit>>
	<<unset $action_unclad_over_upper>>
	<<unset $action_unclad_over_lower>>
	<<unset $action_unclad_outfit>>
	<<unset $action_unclad_upper>>
	<<unset $action_unclad_lower>>
	<<unset $action_unclad_under_outfit>>
	<<unset $action_unclad_under_lower>>
	<<unset $action_unclad_under_upper>>
	<<unset $action_unclad_legs>>
	<<unset $action_unclad_feet>>
	<<unset $action_unclad_neck>>
	<<unset $action_unclad_head>>
	<<unset $action_unclad_face>>
	<<unset $action_unclad_hands>>
<</widget>>

<<widget "undiestrauma">>
	<<if !$worn.under_lower.type.includes("naked")>>
		<<gtrauma>><<gstress>><<trauma 1>><<stress 1>>
	<<else>>
		<<gtrauma>><<gstress>><<trauma 3>><<stress 3>>
	<</if>>
<</widget>>

<<widget "goo">>
	<<goocount>>

	<<if $liquidoutsidecount gte 1>>
		<!-- Variables constructed: $semenoutsidecount, $goooutsidecount, $nectaroutsidecount -->
		<<set _liquid to formatList(
			["semen", "goo", "nectar"].filter(stuff => V[stuff + "outsidecount"] gte 1)
			).replace("semen", "精液").replace("goo", "粘液").replace("nectar", "花蜜").replace(" and ", "和").replace(",", "、")
		>>
		<<if $liquidoutsidecount gte 100>>
			<span class="red">你全身上下都浸润在淫秽的液体之中。</span>
			<br>
		<<elseif $liquidoutsidecount gte 25>>
			<span class="pink">大量的<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>浸透了你。</span>
			<br>
		<<elseif $liquidoutsidecount gte 20>>
			<span class="purple">你身上沾满了<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>></span>
			<br>
		<<elseif $liquidoutsidecount gte 15>>
			<span class="purple">你的皮肤被<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>湿润了。</span>
			<br>
		<<elseif $liquidoutsidecount gte 10>>
			<span class="purple">你被<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>弄湿了。</span>
			<br>
		<<elseif $liquidoutsidecount gte 5>>
			<span class="purple">你的皮肤被<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>湿润了。</span>
			<br>
		<<elseif $liquidoutsidecount gte 1>>
			<span class="blue">一些<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>粘在你的皮肤上。</span>
			<br>
		<</if>>
	<</if>>

	<<if $player.bodyliquid.vagina.goo gte 1 or $player.bodyliquid.vagina.semen gte 1 or $player.bodyliquid.vagina.nectar>>
		<!-- Variables constructed: $player.bodyliquid.vagina.semen, $player.bodyliquid.vagina.goo, $player.bodyliquid.vagina.nectar -->
		<<set _liquid to formatList(
			["semen", "goo", "nectar"].filter(stuff => V.player.bodyliquid.vagina[stuff] gte 1)
			).replace("semen", "精液").replace("goo", "粘液").replace("nectar", "花蜜").replace(" and ", "和").replace(",", "、")
		>>
		<<set _liquidUpper to _liquid.toUpperFirst()>>
		<<if _liquid.includes(" ")>>
			<<set _s to "">>
		<<else>>
			<<set _s to "s">>
		<</if>>
		<<switch Math.clamp(setup.bodyliquid.combined("vagina"), 1, 5)>>
			<<case 5>>
				<span class="red">无法容下的<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>一股股从你胀满的子宫中溢出。</span>
				<br>
			<<case 4>>
				<span class="pink"><<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>从你<<pussy>>满溢而出。</span>
				<br>
			<<case 3>>
				<span class="pink"><<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>从你<<pussy>>中顺着大腿缓缓淌下。</span>
				<br>
			<<case 2>>
				<span class="pink"><<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>在地面与你<<pussy>>间拉出一条细丝。</span>
				<br>
			<<case 1>>
				<span class="pink"><<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>从你<<pussy>>中滴落。</span>
				<br>
		<</switch>>
	<</if>>

	<<if $player.bodyliquid.anus.goo gte 1 or $player.bodyliquid.anus.semen gte 1 or $player.bodyliquid.anus.nectar>>
		<!-- Variables constructed: $player.bodyliquid.anus.semen, $player.bodyliquid.anus.goo, $player.bodyliquid.anus.nectar -->
		<<set _liquid to formatList(
			["semen", "goo", "nectar"].filter(stuff => V.player.bodyliquid.anus[stuff] gte 1)
			).replace("semen", "精液").replace("goo", "粘液").replace("nectar", "花蜜").replace(" and ", "和").replace(",", "、")
		>>
		<<set _liquidUpper to _liquid.toUpperFirst()>>
		<<if _liquid.includes(" ")>>
			<<set _s to "">>
		<<else>>
			<<set _s to "s">>
		<</if>>
		<<switch Math.clamp(setup.bodyliquid.combined("anus"), 1, 5)>>
			<<case 5>>
				<span class="red">无法容下的<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>一股股从你胀满的肠道中溢出。</span>
				<br>
			<<case 4>>
				<span class="pink"><<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>从你<<bottom>>中满溢而出。</span>
				<br>
			<<case 3>>
				<span class="pink"><<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>顺着你<<bottom>>缓缓淌下。</span>
				<br>
			<<case 2>>
				<span class="pink"><<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>在地面与你<<bottom>>间拉出一条细丝。</span>
				<br>
			<<case 1>>
				<span class="pink"><<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>从你的股间滴落。</span>
				<br>
		<</switch>>
	<</if>>

	<<if $player.bodyliquid.mouth.goo gte 1 or $player.bodyliquid.mouth.semen gte 1 or $player.bodyliquid.mouth.nectar>>
		<!-- Variables constructed: $player.bodyliquid.mouth.semen, $player.bodyliquid.mouth.goo, $player.bodyliquid.mouth.nectar -->
		<<set _liquid to formatList(
			["semen", "goo", "nectar"].filter(stuff => V.player.bodyliquid.mouth[stuff] gte 1)
			).replace("semen", "精液").replace("goo", "粘液").replace("nectar", "花蜜").replace(" and ", "和").replace(",", "、")
		>>
		<<set _liquidUpper to _liquid.toUpperFirst()>>
		<<if _liquid.includes(" ")>>
			<<set _s to "">>
		<<else>>
			<<set _s to "s">>
		<</if>>
		<<set _liquidUpper to _liquid.toUpperFirst()>>
		<<switch Math.clamp(setup.bodyliquid.combined("mouth"), 1, 5)>>
			<<case 5>>
				<span class="red">你不断地咳出<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>。</span>
				<br>
			<<case 4>>
				<span class="pink">满溢的<<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>正汇成丝线从你的唇缝中淌下。</span>
				<br>
			<<case 3>>
				<span class="pink"><<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>从你的唇缝间滴落。</span>
				<br>
			<<case 2>>
				<span class="pink"><<switch _liquidUpper>><<case "Semen">>精液<<case "Goo">>粘液<<case "Nectar">>花蜜<<default>>_liquidUpper<</switch>>在你的唇间拉出一道细线。</span>
				<br>
			<<case 1>>
				<span class="pink">残存<<switch _liquid>><<case "semen">>精液<<case "goo">>粘液<<case "nectar">>花蜜<<default>>_liquid<</switch>>味在你嘴中扩散。</span>
				<br>
		<</switch>>
	<</if>>
<</widget>>

<<widget "clampgoo">>
	<<for _bodypart range setup.bodyliquid.bodyparts>>
		<<set $player.bodyliquid[_bodypart]["goo"] to Math.clamp($player.bodyliquid[_bodypart]["goo"], 0, 5)>>
		<<set $player.bodyliquid[_bodypart]["semen"] to Math.clamp($player.bodyliquid[_bodypart]["semen"], 0, 5)>>
		<<set $player.bodyliquid[_bodypart]["nectar"] to Math.clamp($player.bodyliquid[_bodypart]["nectar"], 0, 5)>>
	<</for>>
<</widget>>

<<widget "goocount">>
	<<clampgoo>>
	<<set $goocount to $player.bodyliquid.neck.goo + $player.bodyliquid.rightarm.goo + $player.bodyliquid.leftarm.goo + $player.bodyliquid.thigh.goo + $player.bodyliquid.bottom.goo + $player.bodyliquid.tummy.goo + $player.bodyliquid.chest.goo + $player.bodyliquid.face.goo + $player.bodyliquid.hair.goo + $player.bodyliquid.feet.goo + $player.bodyliquid.vaginaoutside.goo + ($player.bodyliquid.vagina.goo * 3) + ($player.bodyliquid.penis.goo * 3) + ($player.bodyliquid.anus.goo * 3) + ($player.bodyliquid.mouth.goo * 3)>>
	<<set $semencount to $player.bodyliquid.neck.semen + $player.bodyliquid.rightarm.semen + $player.bodyliquid.leftarm.semen + $player.bodyliquid.thigh.semen + $player.bodyliquid.bottom.semen + $player.bodyliquid.tummy.semen + $player.bodyliquid.chest.semen + $player.bodyliquid.face.semen + $player.bodyliquid.hair.semen + $player.bodyliquid.feet.semen + $player.bodyliquid.vaginaoutside.semen + ($player.bodyliquid.vagina.semen * 3) + ($player.bodyliquid.penis.semen * 3) + ($player.bodyliquid.anus.semen * 3) + ($player.bodyliquid.mouth.semen * 3)>>
	<<set $nectarcount to $player.bodyliquid.neck.nectar + $player.bodyliquid.rightarm.nectar + $player.bodyliquid.leftarm.nectar + $player.bodyliquid.thigh.nectar + $player.bodyliquid.bottom.nectar + $player.bodyliquid.tummy.nectar + $player.bodyliquid.chest.nectar + $player.bodyliquid.face.nectar + $player.bodyliquid.hair.nectar + $player.bodyliquid.feet.nectar + $player.bodyliquid.vaginaoutside.nectar + ($player.bodyliquid.vagina.nectar * 3) + ($player.bodyliquid.penis.nectar * 3) + ($player.bodyliquid.anus.nectar * 3) + ($player.bodyliquid.mouth.nectar * 3)>>
	<<set $liquidcount to $goocount + $semencount + $nectarcount>>

	<<set $goooutsidecount to $player.bodyliquid.neck.goo + $player.bodyliquid.rightarm.goo + $player.bodyliquid.leftarm.goo + $player.bodyliquid.thigh.goo + $player.bodyliquid.bottom.goo + $player.bodyliquid.tummy.goo + $player.bodyliquid.chest.goo + $player.bodyliquid.face.goo + $player.bodyliquid.hair.goo + $player.bodyliquid.feet.goo + $player.bodyliquid.vaginaoutside.goo + ($player.bodyliquid.penis.goo * 3)>>
	<<set $semenoutsidecount to $player.bodyliquid.neck.semen + $player.bodyliquid.rightarm.semen + $player.bodyliquid.leftarm.semen + $player.bodyliquid.thigh.semen + $player.bodyliquid.bottom.semen + $player.bodyliquid.tummy.semen + $player.bodyliquid.chest.semen + $player.bodyliquid.face.semen + $player.bodyliquid.hair.semen + $player.bodyliquid.feet.semen + $player.bodyliquid.vaginaoutside.semen + ($player.bodyliquid.penis.semen * 3)>>
	<<set $nectaroutsidecount to $player.bodyliquid.neck.nectar + $player.bodyliquid.rightarm.nectar + $player.bodyliquid.leftarm.nectar + $player.bodyliquid.thigh.nectar + $player.bodyliquid.bottom.nectar + $player.bodyliquid.tummy.nectar + $player.bodyliquid.chest.nectar + $player.bodyliquid.face.nectar + $player.bodyliquid.hair.nectar + $player.bodyliquid.feet.nectar + $player.bodyliquid.vaginaoutside.nectar + ($player.bodyliquid.penis.nectar * 3)>>
	<<set $liquidoutsidecount to $goooutsidecount + $semenoutsidecount + $nectaroutsidecount>>

	<<set $goobodycount to $player.bodyliquid.thigh.goo + $player.bodyliquid.bottom.goo + $player.bodyliquid.tummy.goo + $player.bodyliquid.chest.goo + $player.bodyliquid.vaginaoutside.goo + ($player.bodyliquid.vagina.goo * 3) + ($player.bodyliquid.penis.goo * 3) + ($player.bodyliquid.anus.goo * 3)>>
	<<set $semenbodycount to $player.bodyliquid.thigh.semen + $player.bodyliquid.bottom.semen + $player.bodyliquid.tummy.semen + $player.bodyliquid.chest.semen + $player.bodyliquid.vaginaoutside.semen + ($player.bodyliquid.vagina.semen * 3) + ($player.bodyliquid.penis.semen * 3) + ($player.bodyliquid.anus.semen * 3)>>
	<<set $nectarbodycount to $player.bodyliquid.thigh.nectar + $player.bodyliquid.bottom.nectar + $player.bodyliquid.tummy.nectar + $player.bodyliquid.chest.nectar + $player.bodyliquid.vaginaoutside.nectar + ($player.bodyliquid.vagina.nectar * 3) + ($player.bodyliquid.penis.nectar * 3) + ($player.bodyliquid.anus.nectar * 3)>>
	<<set $liquidbodycount to $goobodycount + $semenbodycount + $nectarbodycount>>
<</widget>>

<<widget "outergoo">>
	<<bodyliquid "neck" "goo">>
	<<bodyliquid "rightarm" "goo">>
	<<bodyliquid "leftarm" "goo">>
	<<bodyliquid "thigh" "goo">>
	<<bodyliquid "bottom" "goo">>
	<<bodyliquid "tummy" "goo">>
	<<bodyliquid "chest" "goo">>
	<<bodyliquid "face" "goo">>
	<<bodyliquid "hair" "goo">>
	<<bodyliquid "feet" "goo">>
<</widget>>

<<widget "waist_goo">>
	<<bodyliquid "feet" "goo" 5>>
	<<bodyliquid "bottom" "goo" 5>>
	<<bodyliquid "thigh" "goo" 5>>
	<<if $player.penisExist>>
		<<bodyliquid "penis" "goo" 5>>
	<</if>>
	<<if $player.vaginaExist>>
		<<bodyliquid "vaginaoutside" "goo" 5>>
	<</if>>
<</widget>>

<<widget "random_goo">>
	<<set $_rng to random (0, 9)>> <!-- 1-10 but 0 indexed -->
	<<set $_part_text to [
		"neck", "right arm", "left arm", "thigh", "bottom",
		"tummy", "chest", "face", "hair", "feet"
		].select($_rng)>>
	<<set $_part to $_part_text.replace(" ","")>>
	<<set $player.bodyliquid[$_part].goo += 1>>

	<<print either("飞溅到你的", "涂抹到你的", "落在了你的", "溅到了你的")>><<set $_part_text to $_part_text.replace("neck","脖子上").replace("right arm","右臂上").replace("left arm","左臂上").replace("thigh","大腿上").replace("bottom","屁股上").replace("tummy","小腹上").replace("chest","胸部上").replace("face","脸上").replace("hair","头发上").replace("feet","脚上")>>
	<span class="purple">$_part_text。</span>
<</widget>>

<<widget "random_semen">>
	<<set $_rng to random (0, 9)>> <!-- 1-10 but 0 indexed -->
	<<set $_part_text to [
		"neck", "right arm", "left arm", "thigh", "bottom",
		"tummy", "chest", "face", "hair", "feet"
		].select($_rng)>>
	<<set $_part to $_part_text.replace(" ","")>>
	<<set $player.bodyliquid[$_part].semen += 1>>

	<<print either("飞溅到你的", "涂抹到你的", "落在了你的", "溅到了你的")>><<set $_part_text to $_part_text.replace("neck","脖子上").replace("right arm","右臂上").replace("left arm","左臂上").replace("thigh","大腿上").replace("bottom","屁股上").replace("tummy","小腹上").replace("chest","胸部上").replace("face","脸上").replace("hair","头发上").replace("feet","脚上")>>
	<span class="purple">$_part_text。</span>
<</widget>>

<<widget "random_goo_head">>
	<<set $_rng to random (0, 3)>> <!-- 1-10 but 0 indexed -->
	<<set $_part_text to [
		"neck", "chest", "face", "hair"
		].select($_rng)>>
	<<set $_part to $_part_text.replace(" ","")>>
	<<set $player.bodyliquid[$_part].goo += 1>>

	<<print either("飞溅到你的", "涂抹到你的", "落在了你的", "溅到了你的")>><<set $_part_text to $_part_text.replace("neck","脖子上").replace("right arm","右臂上").replace("left arm","左臂上").replace("thigh","大腿上").replace("bottom","屁股上").replace("tummy","小腹上").replace("chest","胸部上").replace("face","脸上").replace("hair","头发上").replace("feet","脚上")>>
	<span class="purple">$_part_text。</span>
<</widget>>

<<widget "random_semen_head">>
	<<set $_rng to random (0, 3)>> <!-- 1-10 but 0 indexed -->
	<<set $_part_text to [
		"neck", "chest", "face", "hair"
		].select($_rng)>>
	<<set $_part to $_part_text.replace(" ","")>>
	<<set $player.bodyliquid[$_part].semen += 1>>

	<<print either("飞溅到你的", "涂抹到你的", "落在了你的", "溅到了你的")>><<set $_part_text to $_part_text.replace("neck","脖子上").replace("right arm","右臂上").replace("left arm","左臂上").replace("thigh","大腿上").replace("bottom","屁股上").replace("tummy","小腹上").replace("chest","胸部上").replace("face","脸上").replace("hair","头发上").replace("feet","脚上")>>
	<span class="purple">$_part_text。</span>
<</widget>>

<<widget "washmakeup">>
	<<if $makeup.lipstick != 0 or $makeup.eyeshadow != 0 or ($makeup.mascara != 0 and !$makeup.mascara.includes('waterproof')) or $makeup.concealer != 0>>
		<<set $makeupWashed = 1>>
		<<set $makeup.lipstick = 0>>
		<<set $makeup.eyeshadow = 0>>
		<<if $makeup.mascara and !$makeup.mascara.includes('waterproof')>>
			<<set $makeup.mascara = 0>>
			<<set $makeup.mascara_running = 0>>
		<</if>>
		<<set $makeup.concealer = 0>>
	<</if>>
<</widget>>

<<widget "waterwash">>
	<<if $combat isnot 1>>
		<<for _bodypart range setup.bodyliquid.bodyparts>>
			<<if $player.bodyliquid[_bodypart]["goo"] gte 1>><<set $waterwash += 1>><<set $allure += 500>><<bodyliquid _bodypart "goo" -1>><</if>>
			<<if $player.bodyliquid[_bodypart]["semen"] gte 1>><<set $waterwash += 1>><<set $allure += 500>><<bodyliquid _bodypart "semen" -1>><</if>>
			<<if $player.bodyliquid[_bodypart]["nectar"] gte 1>><<set $waterwash += 1>><<set $allure += 500>><<bodyliquid _bodypart "nectar" -1>><</if>>
		<</for>>
		<<washRecordedSperm "vagina" "pc">>
		<<washRecordedSperm "anus" "pc">>
	<</if>>

	<<if $waterwash gte 10>>
		<span class="lewd">大量淫液被冲入水中。你希望这不会引起注意。</span><br>
	<<elseif $waterwash gte 5>>
		<span class="lewd">很多淫液被冲入水中。你希望这不会引起注意。</span><br>
	<<elseif $waterwash gte 2>>
		<span class="lewd">淫液被冲入水中。你希望这不会引起注意。</span><br>
	<<elseif $waterwash is 1>>
		<span class="lewd">一些淫液被冲入水中。你希望这不会引起注意。</span><br>
	<</if>>
	<<set $waterwash to 0>>

	<<washmakeup>>
<</widget>>

<<widget "wash">>
	<<washRecordedSperm "vagina" "pc">>
	<<washRecordedSperm "anus" "pc">>
	<<bodyliquid "clear">>
	<<if $parasite.right_thigh.name is "maggot">>
		<<removeparasite right_thigh>>
	<</if>>
	<<if $parasite.left_thigh.name is "maggot">>
		<<removeparasite left_thigh>>
	<</if>>
	<<if $parasite.right_arm.name is "maggot">>
		<<removeparasite right_arm>>
	<</if>>
	<<if $parasite.left_arm.name is "maggot">>
		<<removeparasite left_arm>>
	<</if>>
	<<if $parasite.tummy.name is "maggot">>
		<<removeparasite tummy>>
	<</if>>
	<<if $parasite.bottom.name is "maggot">>
		<<removeparasite bottom>>
	<</if>>

<<for _active_bodypart range setup.bodyparts>>
	<<if $skin[_active_bodypart].pen is "pen" or $skin[_active_bodypart].pen is "lipstick" or $skin[_active_bodypart].pen is "mud">>
		<<bodywriting_clear _active_bodypart>>
	<</if>>
<</for>>
<<washmakeup>>
<</widget>>

<<widget "wash_face">>
	<<bodyliquid "face" "semen" -5>>
	<<bodyliquid "face" "goo" -5>>
	<<bodyliquid "face" "nectar" -5>>
	<<if $skin.left_cheek.pen is "pen" or $skin.left_cheek.pen is "lipstick" or $skin.left_cheek.pen is "mud">>
		<<bodywriting_clear left_cheek>>
	<</if>>
	<<if $skin.right_cheek.pen is "pen" or $skin.right_cheek.pen is "lipstick" or $skin.right_cheek.pen is "mud">>
		<<bodywriting_clear right_cheek>>
	<</if>>
	<<if $skin.forehead.pen is "pen" or $skin.forehead.pen is "lipstick" or $skin.forehead.pen is "mud">>
		<<bodywriting_clear forehead>>
	<</if>>
	<<washmakeup>>
<</widget>>

<<widget "wash_mouth">>
	<<bodyliquid "mouth" "semen" -5>>
	<<bodyliquid "mouth" "goo" -5>>
	<<bodyliquid "mouth" "nectar" -5>>
<</widget>>

<<widget "tipset">>
	<<set $tip to random(1000, 3000)>>
	<<if $tip lte 2000>>
		<<set $tipreaction to "low">>
	<<else>>
		<<set $tipreaction to "mid">>
	<</if>>

	<<if _args[0] is "serving">>
		<!-- +20% for every visible clothing item with 'serving' tag -->
		<<set $_servingClothesCount to getVisibleClothesList().countWith(item => item.type.includes("serving"))>>
		<<set $tip += $tip * 0.2 * $_servingClothesCount>>
	<</if>>

	<<set $tip to $tipmod * $tip>>
	<<set $tip *= (1 + ($attractiveness / 10000))>>
	<<if $mathstrait gte 1>>
		<<set $tip *= (1 + ($mathstrait / 4))>>
	<</if>>

	<<set $tip to Math.trunc($tip)>>
	<<if $tip lt $tip_add>>
		<<set $tip to $tip_add>>
	<</if>>

	<<if $tip gte 10000 and _args[0] isnot "body">>
		<<set $tip to 2000 * Math.round( $tip / 2000.0 )>>
	<<elseif $tip gte 1000>>
		<<set $tip to 500 * Math.round( $tip / 500.0 )>>
	<<else>>
		<<set $tip to 50 * Math.round( $tip / 50.0 )>>
	<</if>>
	<<set $tip to Math.max( $tip, 50 )>>
<</widget>>

<<widget "tipreceive">>
	<span class="gold"><<if random(1, 10000) is 10000>>你得到了一笔小费<<else>>你赚到了<</if>><<printmoney $tip>>。</span>
	<<set $money += $tip>>
	<<if $tip gte 50000>>
		<<earnFeat "Negotiator">>
	<</if>>
	<<set $tip to 0>>
<</widget>>

<<widget "tip_neg">>
	经过协商，报酬被定为<<printmoney $tip>>，
	<<if $tipreaction is "low">>
		这低于你的期望。
	<<else>>
		听起来十分公道。
	<</if>>
<</widget>>

<<widget "tip_up">>
	<<He>>加价至<<printmoney $tip>>。
<</widget>>

<<widget "passout">>
	<<set $stress -= 5000>>
	<<set $passoutstat += 1>>
	<<ruffleHair>>
<</widget>>

<<widget "vaginaraped">>
	<<if $NPCList[$vaginatarget] isnot undefined>>
		<<if $templePromised isnot $NPCList[$vaginatarget].fullDescription>>
			<<fallenTransform>> /*transformations.twee*/
		<</if>>
	<<else>>
		<<fallenTransform>>
	<</if>>
	<<set $vaginafucked to 1>>
<</widget>>

<<widget "penisraped">>
	<<if $NPCList[$penistarget] isnot undefined>>
		<<if $templePromised isnot $NPCList[$penistarget].fullDescription>>
			<<fallenTransform>> /*transformations.twee*/
		<</if>>
	<<else>>
		<<fallenTransform>>
	<</if>>
	<<set $penisfucked to 1>>
<</widget>>

<<widget "anusraped">>
	<<set $anusfucked to 1>>
<</widget>>

<<widget "internalejac">>
	<<if $demon gte 6>>
		<<set $demonabsorb += 1>>
	<</if>>
<</widget>>

<<widget "sexcheck">>/*Sets variable to 1 if the PC is penetrated, penetrating, or similar.*/
	<<if $vaginastate is "penetrated" or
	$anusstate is "penetrated" or
	$mouthstate is "penetrated" or
	$penisstate is "otheranus" or
	$penisstate is "penetrated" or
	$anusstate is "othermouth" or
	$vaginastate is "othermouth" or
	$penisstate is "othermouth" or
	$penisstate is "tentacle" or
	$penisstate is "tentacledeep" or
	$vaginastate is "tentacle" or
	$vaginastate is "tentacledeep" or
	$anusstate is "tentacle" or
	$anusstate is "tentacledeep" or
	$mouthstate is "tentacle" or
	$mouthstate is "tentacledeep">>
		<<set $current_sex to 1>>
	<<else>>
		<<set $current_sex to 0>>
	<</if>>
<</widget>>

<<widget "textmap">>
	<<if $options.mapMovement is true and !$possessed>>
	__Map__<br>
		|.....<a class="no-numberify mapmove" onclick="mapMove('Barb Street')" title="Barb Street">倒</a> &#9866; <a class="no&#9866;numberify mapmove" onclick="mapMove('Cliff Street')" title="Cliff Street">峭</a> &#9866; <a class="no&#9866;numberify mapmove" onclick="mapMove('Starfish Street')" title="Starfish Street">海</a> &#9866; <a class="no&#9866;numberify mapmove" onclick="mapMove('Mer Street')" title="Mer Street">梅</a><br>
		|..╱ ╲ ╱ ╲ ╱ ╲ ╱ ╲<br>
		|<a class="no&#9866;numberify mapmove" onclick="mapMove('Domus Street')" title="Domus Street">宅</a> <a class="no&#9866;numberify mapmove" onclick="mapMove('Residential alleyways')" title="ResidentialAlley">&#9866;</a> <a class="no&#9866;numberify mapmove" onclick="mapMove('Connudatus Street')" title="Connudatus Street">康</a> <a class="no&#9866;numberify mapmove" onclick="mapMove('Commercial alleyways')" title="CommercialAlley">&#9866; </a><a class="no&#9866;numberify mapmove" onclick="mapMove('High Street')" title="High Street">商</a> <a class="no&#9866;numberify mapmove" onclick="mapMove('Park')" title="Park">&#9866;</a> <a class="no&#9866;numberify mapmove" onclick="mapMove('Oxford Street')" title="Oxford Street">牛</a> <a class="no&#9866;numberify mapmove" onclick="mapMove('Industrial alleyways')" title="IndustrialAlley">&#9866;</a> <a class="no&#9866;numberify mapmove" onclick="mapMove('Harvest Street')" title="Harvest Street">丰</a><br>
		|..╲ ╱ ╲ ╱ ╲ ╱ ╲ ╱<br>
		|.....<a class="no&#9866;numberify mapmove" onclick="mapMove('Danube Street')" title="Danube Street">多</a> &#9866; <a class="no&#9866;numberify mapmove" onclick="mapMove('Wolf Street')" title="Wolf Street">狼</a> &#9866; <a class="no&#9866;numberify mapmove" onclick="mapMove('Nightingale Street')" title="Nightingale Street">南</a> &#9866; <a class="no&#9866;numberify mapmove" onclick="mapMove('Elk Street')" title="Elk Street">麋</a><br>
	<<else>>
		__Map__<br>
		|.....倒 &#9866; 峭 &#9866; 海 &#9866; 梅<br>
		|..╱ ╲ ╱ ╲ ╱ ╲ ╱ ╲<br>
		|宅 &#9866; 康 &#9866; 商 &#9866; 牛 &#9866; 丰<br>
		|..╲ ╱ ╲ ╱ ╲ ╱ ╲ ╱<br>
		|.....多 &#9866; 狼 &#9866; 南 &#9866; 麋<br>
	<</if>>
	<br>
<</widget>>

<<widget "map">>
	<<set $map.location to _args[0]>>
	<<if $options.images is 1 and $options.mapMovement is true and $options.mapLegacy isnot true and !$possessed>>
		<<set _boxLocations to [
			{ x: 1,		y: 46}, /*Domus				*/
			{ x: 38,	y: 9},	/*Barb				*/
			{ x: 38,	y: 83},	/*Danube			*/
			{ x: 63,	y: 46},	/*Connudatus		*/
			{ x: 88,	y: 9},	/*Cliff				*/
			{ x: 88,	y: 83},	/*Wolf				*/
			{ x: 114,	y: 46},	/*High				*/
			{ x: 146,	y: 9},	/*Starfish			*/
			{ x: 146,	y: 83},	/*Nightingale		*/
			{ x: 176,	y: 46},	/*Oxford			*/
			{ x: 204,	y: 9},	/*Mer				*/
			{ x: 204,	y: 83},	/*Elk				*/
			{ x: 230,	y: 46},	/*Harvest			*/
			{ x: 38,	y: 46},	/*Residential Alley	*/
			{ x: 88,	y: 46},	/*Commercial Alley	*/
			{ x: 146,	y: 46},	/*Park				*/
			{ x: 204,	y: 46}	/*Industrial Alley	*/
		]>>

		/*This version of sugarcube doesn't perform any processing inside of SVG elements, so we need to perform those actions ourselves inside a custom macro */
		<<svg 260 130>>
			<image x="2" xlink:href="img/misc/map.png"> </image>
			<image x="2" @xlink:href="'img/misc/maparrow' + $map.location + '.png'"> </image>

			<<for _i to 0; _i lt $map.arrayList.length; _i++>>
				<<set _canMoveTo = $debug || $map.available[$passage].includes($map.arrayList[_i])>>
				<<set _showMarker = $debug || ($options.mapMarkers && (_canMoveTo || $passage is $map.arrayList[_i]))>>

				<a class="mapmove"
						@onclick="'mapMove(V.map.arrayList[' + _i + ']);'"
						@alt="$map.arrayList[_i] + (_canMoveTo ? ' (0:05)' : '')"
						@title="$map.arrayList[_i] + (_canMoveTo ? ' (0:05)' : '')">

					<rect @x="_boxLocations[_i].x"
							@y="_boxLocations[_i].y"
							height="34"
							width="30"
							@style="'stroke:cyan;fill-opacity:0;stroke-opacity:' + (_showMarker ? '0.6' : '0') + ';'">
					</rect>
				</a>
			<</for>>
		<</svg>>

	<<elseif $options.images is 1 and $options.mapLegacy isnot true>>
		<svg width="260" height="130">
			<image x="2" xlink:href="img/misc/map.png"/>
			<image x="2" @xlink:href="'img/misc/maparrow'+$map.location+'.png'"/>
		</svg>
	<<elseif $options.images is 1>>
		<<if $options.mapMovement is true and !$possessed>>
			<!-- Image Map Generated by http://www.image-map.net/ -->
			<map id="town-image-map" name="town-image-map">
				<area class="no-numberify" alt="倒钩街" title="倒钩街" coords="62,20,39,42" shape="rect" onclick="mapMove('Barb Street')">
				<area class="no-numberify" alt="宅邸街" title="宅邸街" coords="2,75,26,49" shape="rect" onclick="mapMove('Domus Street')">
				<area class="no-numberify" alt="多瑙河街" title="多瑙河街" coords="33,110,70,84" shape="rect" onclick="mapMove('Danube Street')">
				<area class="no-numberify" alt="狼街" title="狼街" coords="86,117,114,86" shape="rect" onclick="mapMove('Wolf Street')">
				<area class="no-numberify" alt="商业街" title="商业街" coords="116,77,139,46" shape="rect" onclick="mapMove('High Street')">
				<area class="no-numberify" alt="康努达塔斯街" title="康努达塔斯街" coords="64,77,88,49" shape="rect" onclick="mapMove('Connudatus Street')">
				<area class="no-numberify" alt="峭壁街" title="峭壁街" coords="88,40,117,-1" shape="rect" onclick="mapMove('Cliff Street')">
				<area class="no-numberify" alt="海星街" title="海星街" coords="147,41,172,12" shape="rect" onclick="mapMove('Starfish Street')">
				<area class="no-numberify" alt="南丁格尔街" title="南丁格尔街" coords="143,115,170,82" shape="rect" onclick="mapMove('Nightingale Street')">
				<area class="no-numberify" alt="牛津街" title="牛津街" coords="170,73,203,45" shape="rect" onclick="mapMove('Oxford Street')">
				<area class="no-numberify" alt="梅尔街" title="梅尔街" coords="202,42,229,14" shape="rect" onclick="mapMove('Mer Street')">
				<area class="no-numberify" alt="麋鹿街" title="麋鹿街 coords="197,111,238,77" shape="rect" onclick="mapMove('Elk Street')">
				<area class="no-numberify" alt="丰收街" title="丰收街" coords="252,46,228,76" shape="rect" onclick="mapMove('Harvest Street')">
				<area class="no-numberify" alt="工业小巷" title="工业小巷" coords="225,73,209,53" shape="rect" onclick="mapMove('Industrial alleyways')">
				<area class="no-numberify" alt="公园" title="公园" coords="154,65,170,52" shape="rect" onclick="mapMove('Park')">
				<area class="no-numberify" alt="商业街小巷" title="商业街小巷" coords="94,69,110,56" shape="rect" onclick="mapMove('Commercial alleyways')">
				<area class="no-numberify" alt="住宅小巷" title="住宅小巷" coords="38,70,57,56" shape="rect" onclick="mapMove('Residential alleyways')">
			</map>
		<</if>>
		<div id="divmap"><img id="map" src="img/misc/map.png"><img id="maparrow" usemap="#town-image-map" @src="'img/misc/maparrow' + _args[0] + '.png'"></div>
	<<else>>
		<<textmap>>
	<</if>>
<</widget>>

<<widget "rentday">>
	<<set $_text_output to ["周日","周一","周二","周三","周四","周五","周六"][$rentday-1]>>
	<<print $_text_output>>
<</widget>>

<<widget "tearup">>
	<<if $pain lte 20>>
		<<set $pain to 20>>
	<</if>>
<</widget>>

<<widget "roomoptions">>
	<<if $sexStats.pills.boughtOnce is true or $sexStats.pills["pills"]["Dr Harper\'s prescription"].owned gte 1 or $sexStats.pills["pills"]["asylum\'s prescription"].owned gte 1>>
		<<icon "pill collection.png">><<link [[检查你的药物|PillCollection]]>><<set $pillsExitPassage to $passage>><<endevent>><</link>>
		<br>
	<</if>>
<</widget>>

<<widget "christmas_options">>
	<<if $christmas_wrap is 1>>
		<<switch $christmas_gift_robin>>
			<<case "shirt_unwrapped">>
				<<link [[把罗宾的衬衫和短裤包好 (0:10)|Bedroom Robin Wrap]]>><<pass 10>><<set $christmas_gift_robin to "shirt">><<set $christmas_gift_robin_wrapped to 1>><</link>>
				<br>
			<<case "sundress_unwrapped">>
				<<link [[把罗宾的连衣裙包好 (0:10)|Bedroom Robin Wrap]]>><<pass 10>><<set $christmas_gift_robin to "sundress">><<set $christmas_gift_robin_wrapped to 1>><</link>>
				<br>
			<<case "kimono_unwrapped">>
				<<link [[把罗宾的和服包好 (0:10)|Bedroom Robin Wrap]]>><<pass 10>><<set $christmas_gift_robin to "kimono">><<set $christmas_gift_robin_wrapped to 1>><</link>>
				<br>
			<<case "tuxedo_set_unwrapped">>
				<<link [[把罗宾的燕尾服包好 (0:10)|Bedroom Robin Wrap]]>><<pass 10>><<set $christmas_gift_robin to "tuxedo">><<set $christmas_gift_robin_wrapped to 1>><</link>>
				<br>
			<<case "gothic_gown_unwrapped">>
				<<link [[把罗宾的哥特长裙包好 (0:10)|Bedroom Robin Wrap]]>><<pass 10>><<set $christmas_gift_robin to "gothic gown">><<set $christmas_gift_robin_wrapped to 1>><</link>>
				<br>
			<<case "christmas_unwrapped">>
				<<link [[把罗宾的圣诞套装包好 (0:10)|Bedroom Robin Wrap]]>><<pass 10>><<set $christmas_gift_robin to "christmas">><<set $christmas_gift_robin_wrapped to 1>><</link>>
				<br>
		<</switch>>
		<<if $christmas_gift is "clothes_unwrapped">>
			<<link [[为孤儿们包装礼物(3:00)|Bedroom Orphans Clothes Wrap]]>><<pass 180>><<set $christmas_gift to "clothes">><</link>>
			<br>
		<</if>>
	<</if>>
	<<if $christmas is 1 and !$christmas_wraith>>
		<<rngWraith 1>>
	<</if>>
<</widget>>


<<widget "encountersteal">>
	<<rng>>
	<<if isPubfameTaskAccepted("morgan") and $npc.includes("Morgan")>>
		<<pubfameComplete "morgan" "steal">>
		<<combatskulduggeryskilluse>><<combatcontrol 10>><<gcombatcontrol>>
	<<elseif isPubfameTaskAccepted("hospital") and $pubfame.hospital.active is 1>>
		<<pubfameComplete "hospital" "steal">>
		<<crimeup 20>><<combatskulduggeryskilluse>><<combatcontrol 10>><<gcombatcontrol>>
	<<elseif $location is "prison">>
		<<set _teeth to random(3,10)>>
		你抓走了一把白色半透明的宝石。
		<<prison_teeth _teeth>> <<prison_teeth_text _teeth>>
	<<elseif $rng gte 96 and $spray lt $spraymax>>
		<<spray 1>>
		<span class="green">你补充了一份防狼喷雾。</span>
		<<crimeup 50>><<combatskulduggeryskilluse>><<combatcontrol 10>><<gcombatcontrol>>
	<<elseif $rng gte 90 and !$compoundcard>>
		<<set $compoundcard to 1>>
		你偷到了一张奇怪的卡片。上面有一行小字，讲的是<span class="gold">麋鹿街</span>上的一处位置。
	<<else>>
		<<rng 5 100>>
		你偷到了<<moneyGain $rng>>。
		<<crimeup $rng>><<combatskulduggeryskilluse>><<combatcontrol 10>><<gcombatcontrol>>
	<</if>>
<</widget>>

<<widget "statbaricons">>
	<<if $options.images is 1 and _args[0]>>
		<<if _args[1] gte 1>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 1>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 2>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 2>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 3>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 3>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 4>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 4>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 5>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 5>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 6>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 6>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 7>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 7>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 8>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 8>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 9>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 9>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
		<<if _args[1] gte 10>>
			<img id="statbar" @src="'img/ui/' + _args[0] + '.png'">
		<<elseif _args[2] gte 10>>
			<img id="statbar" src="img/ui/point.png">
		<</if>>
	<</if>>
<</widget>>

<<widget "characteristic-text">>
	<<set _config = _args[0]>>

	<<if _config.states and _config.states.length gt 0>>

		<<set _config.currentLevel = 0>>
		/* Loop through the provided states to find the one we are currently at*/
		<<for _i to 0; _i lt _config.states.length; _i++>>
			<<if _config.currentValue gte _config.states[_i].requiredValue>>
				<<set _config.currentLevel = _i>>
			<</if>>
		<</for>>

		/* Set the details to show from the current state */
		<<set _config.preText = _config.states[_config.currentLevel].preText || _config.preText>>
		<<set _config.description = _config.states[_config.currentLevel].description>>
		<<set _config.postText = _config.states[_config.currentLevel].postText || _config.postText>>
		<<set _config.color = _config.states[_config.currentLevel].color>>
	<</if>>

	<<if _config.preText>>
		_config.preText
	<</if>>
	<span @class="_config.color">_config.description</span>
	<<if _config.postText>>
		_config.postText
	<</if>>
<</widget>>

<<widget "characteristic-box">>
	<<set _config = _args[0]>>
	<<if _config.states and _config.states.length gt 0>>

		<<set _config.currentLevel = 0>>
		/* Loop through the provided states to find the one we are currently at*/
		<<for _i to 0; _i lt _config.states.length; _i++>>
			<<if _config.currentValue gte _config.states[_i].requiredValue>>
				<<set _config.currentLevel = _i>>
			<</if>>
		<</for>>

		/* Set the details to show from the current state */
		<<set _config.level =		_config.states[_config.currentLevel].level>>
		<<set _config.description = _config.states[_config.currentLevel].description>>
		<<set _config.color =		_config.states[_config.currentLevel].color>>

		/* Determine the colour of the bottom bar based on a few types, default is to match the level colour */
		<<if _config.meterColorType eq 'next'>>
			<<if _config.currentLevel lt _config.states.length - 1>>
				<<set _config.meterColor = _config.states[_config.currentLevel + 1].color>>
			<<else>>
				<<set _config.meterColor = _config.states[_config.currentLevel].color>>
			<</if>>
		<<elseif _config.meterColorType eq 'prev'>>
			<<if _config.currentLevel gt 0>>
				<<set _config.meterColor = _config.states[_config.currentLevel - 1].color>>
			<<else>>
				<<set _config.meterColor = _config.states[_config.currentLevel].color>>
			<</if>>
		<<elseif _config.meterColorType eq 'max'>>
			<<if _config.currentLevel eq _config.states.length - 1>>
				<<set _config.meterColor = _config.states[_config.currentLevel].color>>
			<</if>>
		<<else>>
			<<if _config.meterColor eq undefined>>
				<<set _config.meterColor = _config.states[_config.currentLevel].color>>
			<</if>>
		<</if>>

		/* Calculate the percent to the next level based on the gap between the nearest two states */
		<<if _config.percent isnot undefined>>
			<<set _config.percent = Math.floor(_config.percent)>>
		<<else>>
			<<if _config.currentLevel eq (_config.states.length - 1)>>
				/* Calculate percentage above highest state if max value is specified */
				<<if _config.maxValue>>
					<<set _config.percent = Math.floor(100*(_config.currentValue - _config.states[_config.currentLevel].requiredValue) / (_config.maxValue - _config.states[_config.currentLevel].requiredValue))>>
				<<else>>
					<<set _config.percent = 100>>
				<</if>>
			<<else>>
				<<set _config.percent = Math.floor(100*(_config.currentValue - _config.states[_config.currentLevel].requiredValue) / (_config.states[_config.currentLevel + 1].requiredValue - _config.states[_config.currentLevel].requiredValue))>>
			<</if>>
		<</if>>

	<<else>>
		<<set _config.percent= Math.floor(_config.currentValue)>>
	<</if>>

	<<set _config.barWidth = Math.clamp(_config.percent, 0, 100)>>

	<div class="characteristic-box">
		<div class="characteristic-top-line">
			<<if $options.images is 1 and _config.icon>>
				<img class="characteristic-icon" @src="'img/' + _config.icon + '.png'" />
			<</if>>
			<span class="characteristic-title">_config.name<<characteristic-box-modifier `clone(_config.modifier)` `clone(_config.modTypes)` `clone(_config.name)`>></span>
			<<if _config.states>>
				<<if _config.displayType eq "level">>
					<span @class="'characteristic-level ' + _config.color">
						<big>_config.level</big><small>/<<print (_config.states.length - 1)>></small>
					</span>
				<<elseif _config.displayType eq "grade">>
					<span class="characteristic-level">
						<span @class="_config.color">_config.level</span> <<if _config.level neq 'None'>><small class="grade-percent black">_config.percent%</small><</if>>
					</span>
				<</if>>
			<</if>>
		</div>
		<<if _config.description>>
			<span @class="'characteristic-description ' + _config.color">_config.description</span>
		<</if>>
		<<if _config.showStars>>
			<span class="characteristic-description grade-progress">每日进度</span>
			<div class="progress-stars">
				<img class="icon" @src="'img/ui/' + (_config.starLevel > 0 ? 'bronze_star'	: 'empty_star') + '.png'" />
				<img class="icon" @src="'img/ui/' + (_config.starLevel > 1 ? 'silver_star'	: 'empty_star') + '.png'" />
				<img class="icon" @src="'img/ui/' + (_config.starLevel > 2 ? 'gold_star'	: 'empty_star') + '.png'" />
			</div>
		<</if>>
		<div class="meter">
			<div @class="(_config.meterColor ? _config.meterColor + 'bar' : 'goldbar')" @style="'width:' + _config.barWidth + '%'"></div>
		</div>
	</div>
<</widget>>

<<widget "characteristic-box-modifier">><<silently>>
	<<if _args[0] isnot undefined or _args[0] isnot 100>>
		<<set $_modifier to _args[0] - 100>>
		<<if $_modifier gt 0>>
			<<set $_result to " <small class='green characteristic-modifier'>(+"+$_modifier+"%)</small>">>
		<<elseif $_modifier lt 0>>
			<<set $_result to " <small class='red characteristic-modifier'>("+$_modifier+"%)</small>">>
		<</if>>
	<</if>>
	<</silently>>
	<<if $_result>>
		<<set $_good to _args[1].good>>
		<<set $_bad to _args[1].bad>>
		<<set $_stat to _args[2].toLowerCase()>>
		<span @class="$_modifier gt 0 ? 'green' : 'red'"><mouse class = "tooltip-small">
			$_result
			<<if $_good.length gt 0 and $_bad.length gt 0>>
				<span class="green">有助你$_stat技术的物品: <<print $_good>> <span class="red">有碍你$_stat技术的物品: <<print $_bad>></span></span>
			<<elseif $_good.length gt 0>>
				<span class="green">有助你$_stat技术的物品: <<print $_good>></span>
			<<elseif $_bad.length gt 0>>
				<span class="red">有碍你$_stat技术的物品: <<print $_bad>></span>
			<</if>>
		</mouse></span>
	<</if>>
<</widget>>

<<widget "relation-text">>
	<<set _config = _args[0]>>

	<<if _config.states and _config.states.length gt 0>>

		<<set _config.currentLevel = _config.states[0]>>
		<<if _config.currentLevel.secondaryStates>>
			<<set _config.currentLevel = _config.currentLevel.secondaryStates[0]>>
		<</if>>

		/* Loop through the provided states to find the one we are currently at*/
		<<script>>
			for(let i = 0; i < T.config.states.length; i++) {

				if(T.config.currentValue >= T.config.states[i].requiredValue) {

					if(T.config.states[i].secondaryStates) {

						for(let j = 0; j < T.config.states[i].secondaryStates.length; j++) {
							if(T.config.secondaryValue >= T.config.states[i].secondaryStates[j].requiredValue) {
								T.config.currentLevel = T.config.states[i].secondaryStates[j];
							}
						}

					} else {
						T.config.currentLevel = T.config.states[i];
					}
				}
			}

		<</script>>

		/* Set the details to show from the current state */
		<<set _config.preText =		_config.currentLevel.preText || _config.preText>>
		<<set _config.description = _config.currentLevel.description>>
		<<set _config.postText =	_config.currentLevel.postText || _config.postText>>
		<<set _config.color =		_config.currentLevel.color>>
	<</if>>


	<<if _config.preText>>
		_config.preText
	<</if>>
	<span @class="_config.color">_config.description</span>
	<<if _config.postText>>
		_config.postText
	<</if>>
<</widget>>

<<widget "relation-box-simple">>
	<<set _boxConfig = _args[0]>>
	<div class="relation-box" @style="(_boxConfig.style || '')">
		<<if _boxConfig.name>>
			<div class="relation-top-line">
				<<if $options.images and _boxConfig.icon>>
						<img class="relation-icon" @src="_boxConfig.icon" />
				<</if>>
				<span class="relation-name">_boxConfig.name</span>
			</div>
		<</if>>
		<div class="relation-description">
			_boxConfig.description
		</div>
	</div>
<</widget>>

<<widget "relation-box-wolves">>
	<<if $wolfpackfear gte 1 || $wolfpacktrust gte 1 || $syndromewolves gte 1 || $wolfpackleader gte 1>>
	<div class="relation-box" @style="(_boxConfig.style || '')">
		<div class="relation-top-line">
			<<if $options.images>>
					<img class="relation-icon" src="img/misc/icon/wolfpup.png" />
			<</if>>
			<span class="relation-name">狼群</span>
		</div>
		<div class="relation-description">
			狼群
			<<if $wolfpackleader gte 1>>将你视为<span class="green">狼群中的首领.</span>
				<<elseif $syndromewolves gte 1>>将你视为<span class="green">它们的<<ppackbrother>>.</span>
				<<elseif $wolfpacktrust gte 12>><span class="green">信任你.</span>
				<<elseif $wolfpacktrust gte 6>><span class="teal">开始接受你.</span>
				<<elseif $wolfpackfear gte 12>><span class="red">畏惧你.</span>
				<<elseif $wolfpackfear gte 6>><span class="purple">开始对你感到恐惧.</span>
				<<else>><span class="pink">视你为猎物.</span>
			<</if>>
		</div>
	</div>
	<</if>>
<</widget>>

<<widget "relation-box">>
	<<silently>>
		<<set _npcData = _args[0]>>
		<<set _npcOverrides = _args[1] || {}>>

		<<script>>

			/* Returns true/false based on whether the requirements to display a stat are met, automatically true if no requirement specified */
			T.checkRequirements = function (stat) {
				let statOverrides = T.npcOverrides[stat];

				if(statOverrides)
					return !statOverrides.hasOwnProperty("requirements") || statOverrides.requirements;
				else
					return true;
			};

			T.importantNpcStats = ["love", "lust", "dom", "trauma", "rage", "purity", "corruption", "harmony", "ferocity"];
			T.otherNpcStats = ["love", "lust"];

			let statDefaults = {
				"love" : {
					name : "爱意",
					value : T.npcData.love,
					activeIcon : 'img/ui/heart.png',
					inactiveIcon: 'img/ui/emptyheart.png',
					color: 'red'
				},
				"lust" : {
					name : "性欲",
					value : T.npcData.lust,
					iconOrientation : 'vertical',
					activeIcon : 'img/ui/vial.png',
					inactiveIcon : 'img/ui/emptyvial.png',
					color: 'pink'
				},
				"dom" : {
					name : "支配度",
					value : T.npcData.dom,
					activeIcon : "img/ui/collar.png",
					color: 'purple'
				},
				"trauma" : {
					name : "创伤",
					value : T.npcData.trauma,
					activeIcon : "img/ui/redbolt.png",
					color: 'teal'
				},
				"rage" : {
					name : "愤怒",
					value : T.npcData.rage,
					activeIcon : "img/ui/rage.png",
					color: 'gold'
				},
				"purity" : {
					name: "纯洁",
					value: T.npcData.purity,
					activeIcon: (T.npcData.virginity.vaginal == false || T.npcData.virginity.penile == false ? "img/ui/sym_fallen_purity.png" : "img/ui/sym_purity.png"),
					color: 'white'
				},
				"corruption" : {
					name: "堕落",
					value: T.npcData.corruption,
					iconOrientation : 'horizontal-inverted',
					activeIcon: "img/ui/sym_demon_purity.png",
					color: 'purple'
				},
				"harmony" : {
					name: "和谐",
					value: V.wolfpackharmony,
					iconOrientation : 'vertical',
					activeIcon: "img/ui/wolfharmony.png",
					color: 'purple'
				},
				"ferocity" : {
					name: "残暴",
					value: V.wolfpackferocity,
					iconOrientation : 'vertical',
					activeIcon: "img/ui/wolfferocity.png",
					color: 'purple'
				}
			};

			T.getStatConfig = function(stat) {
				let baseConfig = statDefaults[stat] || {};

				return Object.assign({}, baseConfig, T.npcOverrides[stat]);
			};
			if(V.loveInterest){
				/* Check if this is a main love interest */
				if (V.loveInterest.primary == T.npcData.nam) {
					T.loveInterest = true;
				} else if (V.loveInterest.secondary == T.npcData.nam) {
					T.loveInterest = true;
				} else if (V.loveInterest.tertiary == T.npcData.nam) {
					T.loveInterest = true;
				} else {
					T.loveInterest = false;
				}
			}
		<</script>>
	<</silently>>
	<<if _npcData and _npcData.init is 1>>
		<<if (_npcData.nam is ("Ivory Wraith") or ($wraith.mimic is _npcData.nam and $wraith.revealed))>>
			<<rngWraithSocial>>
			<<if _npcData.nam is ("Ivory Wraith") and ($wraith.mimic is "" and (_wraithEventSocial or $wraith.type)) and $wraithIntro>>
				<div class="relation-box">
					<div class="relation-top-line">
						<span class="relation-name">
							<<print _npcData.nam.replace("Avery","艾弗里").replace("Bailey","贝利").replace("Briar","布莱尔").replace("Charlie","查里").replace("Darryl","达里尔").replace("Doren","多伦").replace("Eden","伊甸").replace("Gwylan","格威岚").replace("Harper","哈珀").replace("Jordan","约旦").replace("Kylar","凯拉尔").replace("Landry","兰德里").replace("Leighton","礼顿").replace("Mason","梅森").replace("Morgan","摩根").replace("River","瑞沃").replace("Robin","罗宾").replace("Sam","萨姆").replace("Sirris","西里斯").replace("Whitney","惠特尼").replace("Winter","温特").replace("Niki","尼奇").replace("Quinn","奎因").replace("Remy","雷米").replace("Alex","艾利克斯").replace("Wren","伦恩").replace("Sydney","悉尼").replace("Taylor","泰勒").replace("Casey","凯西").replace("Ivory Wraith","象牙幽灵").replace("Black Wolf","黑狼").replace("Great Hawk","巨鹰")>>
							<small class="relation-title black"><i>那个_wraithTitle</i></small>
						</span>
						<div class="quick-stats">
							<<for _j = 0; _j lt _otherNpcStats.length; _j++>>
								<<if _npcData[_otherNpcStats[_j]] gt 0 and _checkRequirements(_otherNpcStats[_j])>>
									<<relation-box-stat _getStatConfig(_otherNpcStats[_j])>>
								<</if>>
							<</for>>
						</div>
					</div>
					<div class="relation-description">
						<<if $options.images is 1 and (_rngWraithFace is 1 or $possessed)>>
							<img id="wraith" @src="'img/misc/icon/wraith' + V.wraith.state + '.png'">
						<<else>>
							<<npcrelationship _npcData.nam>>
						<</if>>
					</div>
				</div>
			<<elseif $wraithIntro and $wraith.mimic is _npcData.nam and $wraith.revealed and _npcOverrides and _npcOverrides.important>>
				<div class="relation-box">
					<div class="relation-top-line">
						<span class="relation-name">
							<<print _npcData.nam.replace("Avery","艾弗里").replace("Bailey","贝利").replace("Briar","布莱尔").replace("Charlie","查里").replace("Darryl","达里尔").replace("Doren","多伦").replace("Eden","伊甸").replace("Gwylan","格威岚").replace("Harper","哈珀").replace("Jordan","约旦").replace("Kylar","凯拉尔").replace("Landry","兰德里").replace("Leighton","礼顿").replace("Mason","梅森").replace("Morgan","摩根").replace("River","瑞沃").replace("Robin","罗宾").replace("Sam","萨姆").replace("Sirris","西里斯").replace("Whitney","惠特尼").replace("Winter","温特").replace("Niki","尼奇").replace("Quinn","奎因").replace("Remy","雷米").replace("Alex","艾利克斯").replace("Wren","伦恩").replace("Sydney","悉尼").replace("Taylor","泰勒").replace("Casey","凯西").replace("Ivory Wraith","象牙幽灵").replace("Black Wolf","黑狼").replace("Great Hawk","巨鹰")>>?
							<small class="relation-title black"><i>那个_wraithTitle</i></small>
						</span>
						<<if _loveInterest>>
							<img class="love-interest-icon" src="img/ui/love_interest.png" alt="Love Interest" title="Love Interest"/>
						<</if>>
					</div>
					<div class="relation-description">
						<<set _rngWraithLineChance to 1>>
						<<npcrelationship "Ivory Wraith">>
					</div>
					<div @class="'relation-stat-list' + ($options.images ? '' : ' no-images')">
						<<for _j = 0; _j lt _importantNpcStats.length-2; _j++>>
							<<if _npcData[_importantNpcStats[_j]] gt 0 and _checkRequirements(_importantNpcStats[_j])>>
								<<relation-box-stat _getStatConfig(_importantNpcStats[_j]) true>>
							<</if>>
						<</for>>
					</div>
				</div>
			<<else>>
			/* Do not display anything */
			<</if>>
		<<elseif _npcOverrides and _npcOverrides.important>>
			<div class="relation-box">
				<div class="relation-top-line">
					<span class="relation-name">
						<<print _npcData.nam.replace("Avery","艾弗里").replace("Bailey","贝利").replace("Briar","布莱尔").replace("Charlie","查里").replace("Darryl","达里尔").replace("Doren","多伦").replace("Eden","伊甸").replace("Gwylan","格威岚").replace("Harper","哈珀").replace("Jordan","约旦").replace("Kylar","凯拉尔").replace("Landry","兰德里").replace("Leighton","礼顿").replace("Mason","梅森").replace("Morgan","摩根").replace("River","瑞沃").replace("Robin","罗宾").replace("Sam","萨姆").replace("Sirris","西里斯").replace("Whitney","惠特尼").replace("Winter","温特").replace("Niki","尼奇").replace("Quinn","奎因").replace("Remy","雷米").replace("Alex","艾利克斯").replace("Wren","伦恩").replace("Sydney","悉尼").replace("Taylor","泰勒").replace("Casey","凯西").replace("Ivory Wraith","象牙幽灵").replace("Black Wolf","黑狼").replace("Great Hawk","巨鹰")>>
						<small class="relation-title black"><i><<print _npcData.title.replace("businessperson", "商人").replace("businessman", "商人").replace("businesswoman", "商人").replace("caretaker", "监护人").replace("brothel owner", "妓院老板").replace("dance coach", "舞蹈教练").replace("club owner", "俱乐部老板").replace("English teacher", "英语老师").replace("huntress", "猎人").replace("hunter", "猎人").replace("shopkeeper", "商店店主").replace("doctor", "医生").replace("pious", "虔信者").replace("nun", "修女").replace("monk", "修士").replace("loner", "不合群者").replace("criminal", "罪犯").replace("headteacher", "校长").replace("headmaster", "校长").replace("headmistress", "校长").replace("swimming teacher", "游泳老师").replace("sewer dweller", "下水道居民").replace("maths teacher", "数学老师").replace("orphan", "孤儿").replace("cafe owner", "咖啡店主").replace("science teacher", "科学老师").replace("bully", "霸凌者").replace("history teacher", "历史老师").replace("alpha", "头狼").replace("photographer", "摄影师").replace("mayor", "市长").replace("farmer", "农场主").replace("farmhand", "农工").replace("terror", "恐怖者").replace("smuggler", "走私者").replace("faithful", "信徒").replace("fallen", "堕落者").replace("reflection", "映像").replace("explorer", "探险家").replace("delinquent", "违法者")>></i></small>
					</span>
					<<if _loveInterest>>
						<img class="love-interest-icon" src="img/ui/love_interest.png" alt="Love Interest" title="Love Interest"/>
					<</if>>
				</div>
				<div class="relation-description">
					<<npcrelationship _npcData.nam>>
				</div>
				<div @class="'relation-stat-list' + ($options.images ? '' : ' no-images')">
					<<if _importantNPCs[_k].nam is "Black Wolf">><<set _npcStats to _importantNpcStats.length>>
						<<else>><<set _npcStats to _importantNpcStats.length-2>>
					<</if>>
					<<for _j = 0; _j lt _npcStats; _j++>>
						<<if _npcData[_importantNpcStats[_j]] gt 0 and _checkRequirements(_importantNpcStats[_j])>>
							<<relation-box-stat _getStatConfig(_importantNpcStats[_j]) true>>
						<</if>>
					<</for>>
				</div>
			</div>
		<<else>>
			<div class="relation-box">
				<div class="relation-top-line">
					<span class="relation-name">
						<<print _npcData.nam.replace("Avery","艾弗里").replace("Bailey","贝利").replace("Briar","布莱尔").replace("Charlie","查里").replace("Darryl","达里尔").replace("Doren","多伦").replace("Eden","伊甸").replace("Gwylan","格威岚").replace("Harper","哈珀").replace("Jordan","约旦").replace("Kylar","凯拉尔").replace("Landry","兰德里").replace("Leighton","礼顿").replace("Mason","梅森").replace("Morgan","摩根").replace("River","瑞沃").replace("Robin","罗宾").replace("Sam","萨姆").replace("Sirris","西里斯").replace("Whitney","惠特尼").replace("Winter","温特").replace("Niki","尼奇").replace("Quinn","奎因").replace("Remy","雷米").replace("Alex","艾利克斯").replace("Wren","伦恩").replace("Sydney","悉尼").replace("Taylor","泰勒").replace("Casey","凯西").replace("Ivory Wraith","象牙幽灵").replace("Black Wolf","黑狼").replace("Great Hawk","巨鹰")>>
						<small class="relation-title black"><i><<print _npcData.title.replace("businessperson", "商人").replace("businessman", "商人").replace("businesswoman", "商人").replace("caretaker", "监护人").replace("brothel owner", "妓院老板").replace("dance coach", "舞蹈教练").replace("club owner", "俱乐部老板").replace("English teacher", "英语老师").replace("huntress", "猎人").replace("hunter", "猎人").replace("shopkeeper", "商店店主").replace("doctor", "医生").replace("pious", "虔信者").replace("nun", "修女").replace("monk", "修士").replace("loner", "不合群者").replace("criminal", "罪犯").replace("headteacher", "校长").replace("headmaster", "校长").replace("headmistress", "校长").replace("swimming teacher", "游泳老师").replace("sewer dweller", "下水道居民").replace("maths teacher", "数学老师").replace("orphan", "孤儿").replace("cafe owner", "咖啡店主").replace("science teacher", "科学老师").replace("bully", "霸凌者").replace("history teacher", "历史老师").replace("alpha", "头狼").replace("photographer", "摄影师").replace("mayor", "市长").replace("farmer", "农场主").replace("farmhand", "农工").replace("terror", "恐怖者").replace("smuggler", "走私者").replace("faithful", "信徒").replace("fallen", "堕落者").replace("reflection", "映像").replace("explorer", "探险家").replace("delinquent", "违法者")>></i></small>
					</span>
					<div class="quick-stats">
						<<for _j = 0; _j lt _otherNpcStats.length; _j++>>
							<<if _npcData[_otherNpcStats[_j]] gt 0 and _checkRequirements(_otherNpcStats[_j])>>
								<<relation-box-stat _getStatConfig(_importantNpcStats[_j])>>
							<</if>>
						<</for>>
					</div>
				</div>
				<div class="relation-description">
					<<npcrelationship _npcData.nam>>
				</div>
			</div>
		<</if>>
	<</if>>
<</widget>>

<<widget "relation-box-stat">>
	<<silently>>
		<<set _config = _args[0]>>
		<<set _important = _args[1]>>

		<<set _config.progress = Math.floor(Math.clamp(100*((_config.value - (_config.minValue || 0)) / (_config.maxValue || 100)), 0, 100))>>
	<</silently>>
	<div class="relation-stat-block" @style="'--progress: ' + _config.progress + '%;'">
		<<if _important>>
			<label><<print _config.name.replace("Love", "爱意").replace("Lust", "性欲").replace("Dominance", "支配欲").replace("Trauma", "创伤").replace("Rage", "愤怒").replace("Purity", "纯洁").replace("Corruption", "堕落").replace("Wolf Pack Harmony", "狼窝的和谐").replace("Wolf Pack Ferocity", "狼窝的凶猛").replace("Confidence", "自信").replace("Jealousy", "嫉妒")>></label>
		<</if>>
		<<if $options.images>>
			<div class="relation-stat">
				<span @class="'relation-stat-icon ' + (_config.iconOrientation || 'horizontal')">
					<img class="active-icon-img" @src="_config.activeIcon">
					<<if _config.inactiveIcon>>
						<img class="inactive-icon-img" @src="_config.inactiveIcon">
					<<else>>
						<img class="inactive-icon-img outlined" @src="_config.activeIcon">
					<</if>>
				</span>
				<span class="relation-stat-percent black">_config.progress<small>%</small></span>
			</div>
		<<else>>
			<<if _important>>
				<span class="relation-stat-percent black">&nbsp;_config.progress<small>%</small></span>
				<div @class="'progress-bar ' + _config.color + 'bar'"></div>
			<</if>>
		<</if>>
	</div>
<</widget>>

<<widget "connector-box">>
	<div @class="'connector-box ' + (_args[3] ? 'invert' : '')" @style="'--connector-height: ' + _args[0] + 'px; --center-offset: ' + (_args[1] || 50) + '%; --end-offset: ' + (_args[2] || 0) + 'px;'">
		<div class="connector-box-top"></div>
		<div class="connector-box-bottom"></div>
	</div>
<</widget>>

<<widget "oralpassage">>
	<<takeVirginity _args[0] "oral">><<oralstat>><<oralejacstat>><<ejacstat>><<cumswallow 'human'>>
<</widget>>

<<widget "relationshipclamp">>
	<<set _i to $NPCNameList.indexOf("Robin")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 100)>>
	<<set $NPCName[_i].lust = Math.clamp($NPCName[_i].lust, 0, 100)>>
	<<set $NPCName[_i].trauma = Math.clamp($NPCName[_i].trauma, 0, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, 0, 100)>>
	<<set _i to $NPCNameList.indexOf("Whitney")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 30)>>
	<<set $NPCName[_i].lust = Math.clamp($NPCName[_i].lust, 0, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, 0, 20)>>
	<<set _i to $NPCNameList.indexOf("Eden")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 200)>>
	<<set $NPCName[_i].lust = Math.clamp($NPCName[_i].lust, 0, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, 0, 150)>>
	<<set _i to $NPCNameList.indexOf("Kylar")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 100)>>
	<<set $NPCName[_i].lust = Math.clamp($NPCName[_i].lust, 0, 100)>>
	<<set $NPCName[_i].rage = Math.clamp($NPCName[_i].rage, 0, 100)>>
	<<set _i to $NPCNameList.indexOf("Avery")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 100)>>
	<<set $NPCName[_i].rage = Math.clamp($NPCName[_i].rage, 0, 100)>>
	<<set _i to $NPCNameList.indexOf("Great Hawk")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, 0, 100)>>
	<<alexclamp>>
	<<set _i to $NPCNameList.indexOf("Sydney")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 150)>>
	<<set $NPCName[_i].lust = Math.clamp($NPCName[_i].lust, 0, 100)>>
	<<set $NPCName[_i].purity = Math.clamp($NPCName[_i].purity, 0, 100)>>
	<<set $NPCName[_i].corruption = Math.clamp($NPCName[_i].corruption, 0, 50)>>
	<<set _i to $NPCNameList.indexOf("Black Wolf")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 150)>>
	<<set $NPCName[_i].harmony = Math.clamp($wolfpackharmony || 0, 0, 100)>>
	<<set $NPCName[_i].ferocity = Math.clamp($wolfpackferocity || 0, 0, 100)>>

	<<set _i to $NPCNameList.indexOf("Darryl")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -50, 50)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("River")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -50, 50)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Mason")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -50, 50)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Sam")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -50, 50)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Wren")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Charlie")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Bailey")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Briar")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Doren")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Gwylan")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Harper")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Jordan")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Landry")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Leighton")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Morgan")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Winter")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Niki")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Quinn")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 50)>>
	<<set _i to $NPCNameList.indexOf("Remy")>>
	<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, -100, 100)>>
	<<set $NPCName[_i].lust = Math.clamp($NPCName[_i].lust, 0, 100)>>
	<<set $NPCName[_i].dom = Math.clamp($NPCName[_i].dom, -50, 100)>>

	<<set _i to $NPCNameList.indexOf("Ivory Wraith")>>
	<<if $wraith.state is "haunt">>
		<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 10)>>
		<<set $NPCName[_i].lust = Math.clamp($NPCName[_i].lust, 10, 20)>>
	<<else>>
		<<set $NPCName[_i].love = Math.clamp($NPCName[_i].love, 0, 20)>>
		<<set $NPCName[_i].lust = Math.clamp($NPCName[_i].lust, 0, 20)>>
	<</if>>
<</widget>>

<<widget "fringecheck">>
	<<if $fringetype is "default">>
		<<set $fringetype to "messy">>
	<</if>>
<</widget>>

<<widget "haircheck">>
	<<if $hairtype is "default">>
		<<set $hairtype to "messy">>
	<</if>>
<</widget>>

<<widget "fringedescription">>
	<<if $haircolour isnot $hairfringecolour>>
		<<if $hairFringeColourStyle is "gradient">>
			<<set _colour to "双色">>
		<<else>>
			<<run Object.values(setup.colours.hair_map).forEach(colour => {if (V.hairfringecolour== colour.variable) V.hairfringecolourCN = colour.name_cap;})>><<set _colour to $hairfringecolourCN>>
		<</if>>
		<<set $_fringe to _colour + "刘海">>
	<<else>>
		<<set $_fringe to "刘海">>
	<</if>>

	<<if $fringelength gte 980>>
		而且你的<<print $_fringe>>非常长。
	<<elseif $fringelength gte 800>>
		而且你的<<print $_fringe>>很长.
	<<elseif $fringelength gte 600>>
		而且你的<<print $_fringe>>有些长。
	<<elseif $fringelength gte 400>>
		而且你的<<print $_fringe>>非常普通。
	<<elseif $fringelength gte 200>>
		而且你的<<print $_fringe>>有些短。
	<<else>>
		而且你的<<print $_fringe>>特别短。
	<</if>>
<</widget>>

<<widget "willpowerpain">>
	<<if $pain gte 100 and $willpowerpain is undefined and _willpowerpainchecked isnot true>>
		<<if (currentSkillValue('willpower') / 10) gte (($pain - 100) + random(1, 100))>>
			<span class="green">压倒性的疼痛朝你袭来，但你撑了过去。</span>
			<<gwillpower>><<willpower 1>>
			<br>
		<<else>>
			<span class="red">压倒性的疼痛夺去了你反抗的力气。</span>
			<<if $position is "stalk">>
				你膝盖一软，瘫了下去。
			<</if>>
			<<ggwillpower>><<willpower 5>><<set $willpowerpain to 0>>
			<br>
		<</if>>
	<<set _willpowerpainchecked to true>>
	<</if>>
<</widget>>

<<widget "willpowerorgasm">>
	<<if $orgasmdown gte 1 and _willpowerorgasmchecked isnot true>>
		<<if (currentSkillValue('willpower') / 10) gte (($orgasmdown * 30) + random(1, 80))>>
			<span class="green">高潮如同电流一般击穿了你战栗的身体，你强忍着不被快感所击溃。</span>
			<<gwillpower>><<willpower 1>><<set $orgasmdown to 0>>
			<br>
		<<else>>
			<span class="red">高潮如同电流一般击穿了你痉挛的身体，你的大脑因快乐而一片空白。</span>
			<<if $position is "stalk">>
				你膝盖一软，瘫了下去。
			<</if>>
			<<gwillpower>><<willpower 1>>
			<br>
		<</if>>
	<<set _willpowerorgasmchecked to true>>
	<</if>>
<</widget>>

<<widget "clothescolour">><<silently>>
	<<set _slot to _args[0]>>
	<<if $worn[_slot].colour isnot 0 and $worn[_slot].colour isnot undefined>>
		<<if $worn[_slot].colour.substring(0, 3) is "wet">>
			<<set _text_output to $worn[_slot].colour.substring(3)>>
		<<elseif $worn[_slot].colour_sidebar is 1>>
			<<if $worn[_slot].colour == "custom">>
				<<set _text_output to getCustomColourName($worn[_slot].colourCustom)>>
			<<else>>
				<<set _text_output to $worn[_slot].colour>>
			<</if>>
		<</if>>
	<</if>>
<</silently>><<print _text_output>><</widget>>

<<widget "nounderwearcheck">>
	/*Checks if the PC is pantiless, but otherwise decent. Results in low level exhibitionism increases.*/
	<<if !$worn.lower.type.includes("naked") and $worn.under_lower.type.includes("naked") and $exposed lte 0 and $exhibitionism lt 19>>
		<<set $no_underwear += 1>>
	<</if>>
	<<if $no_underwear gte 8>>
		<<set $no_underwear to 0>>
		<<set $effectsmessage to 1>>
		<<set $exhibitionism_message to 1>>
	<</if>>
<</widget>>

<<widget "breastfed">>
	<<set $milk_drank_stat += random(1, 5)>>
	<<if random(1, 100) gte 70>>
		<<if $NPCList[0].type and $NPCList[0].type is "wolfgirl">>
			<<transform wolf 1>>
		<<elseif $NPCList[0].type and $NPCList[0].type is "foxgirl">>
			<<transform fox 1>>
		<<else>>
			<<transform cat 1>>
		<</if>>
	<</if>>
	<<if $milkdranktrait is 1>><<physique 1>><</if>>
	<<purity -1>>
	<<set $hunger -= 200>><<set $thirst -= 200>>
<</widget>>

<<widget "nectarfed">>
	<<set _nectarGain to 0>>
	<<set _nectarGain += (Math.ceil(_args[0] / 10) + random(0,2))>>
	<<set $nectar_drank_stat += _nectarGain>>
	<<set $nectar_addiction += _nectarGain>>
	<<if _args[0] gte 11>>
		<<purity -1>>
	<</if>>
	<<set $hunger -= (_args[0] * 5)>><<set $thirst -= (_args[0] * 5)>>
	<<drugs _args[0]>><<set $arousal += _args[0]>>
	<<if $ejaculating is 1>>
		<<alcohol `(_args[0] * 3)`>>
		<<bodyliquid "mouth" "nectar">>
	<</if>>
	<<if $backgroundTraits.includes("plantlover")>>
		<<if $nectar_timer lte 14>>
			<span class="green">你感到一股如释重负的解脱感。</span> <<stress -12>><<llstress>><<pain -4>><<lpain>>
		<<else>>
			<<set _nectarStress to (-1 * _nectarGain)>>
			<<physique 1 "invig">><<stress _nectarStress>><<lstress>>
		<</if>>
		<<set $nectar_timer to 21>>
	<</if>>
	<<set $nectar_addiction = Math.clamp($nectar_addiction, 0, 200)>>
<</widget>>

<<widget "setup_pillory">>
	<<set $pillory_tenant to {person : clone($baseNPC), exists : 0, duration : 0, served : 0, startday: 0, starthour : 0, endday : 0, endhour : 0,
								crowd : 0, wet : 0, upperexposed : 0 , lowerexposed : 0, fruit : 0, fruitstock: 0, face : 0, ass : 0, genital : 0, broken : 0,
								lastviewed : { day : 0, hour: 0}, special : {name : "", desc : ""}}>>
<</widget>>

<<widget "new_npc_pillory">>
	<<if not _args[0]>>
		<<if $rng gte 20>><<generate1>><<else>><<generatec1>><</if>>
		<<set _already_served to random(0,2)>>
	<<else>>
		<<set _already_served to 0>>
	<</if>>
	<<set $pillory_tenant.exists to 1>>
	<<set $pillory_tenant.person to clone($NPCList[0])>>
	<<set $pillory_tenant.duration to random(4,27)>>
	<<set $pillory_tenant.startday to Time.days>>
	<<set $pillory_tenant.starthour to (Time.hour - _already_served)>>
	<<set _endhour to ($pillory_tenant.starthour + $pillory_tenant.duration)>>
	<<set $pillory_tenant.endday to Time.days>>
	<<if _endhour gte 24>><<set $pillory_tenant.endday += 1>><<set _endhour -= 24>><</if>>
	/*Repeat incase $duration is gte 24hrs and starting time gte 21. E.g. worst case: Time.hour = 23 and duration=27hrs, end time should be 0200 @ +2days.
	So 23 + 27 = 50; add 1 to end-day and minus 24hrs gives 26; add 1 to end-day and minus 24 gives hr 2.*/
	<<if _endhour gte 24>><<set $pillory_tenant.endday += 1>><<set _endhour -= 24>><</if>>
	<<set $pillory_tenant.endhour to _endhour>>
	<<set $pillory_tenant.crowd to 1>>
	<<set $pillory_tenant.wet to 0>>
	<<set $pillory_tenant.upperexposed to 0>>
	<<set $pillory_tenant.lowerexposed to 0>>
	<<set $pillory_tenant.fruit to 0>>
	<<set $pillory_tenant.fruitstock to 3>>
	<<set $pillory_tenant.spank to 0>>
	<<set $pillory_tenant.face to 0>>
	<<set $pillory_tenant.ass to 0>>
	<<set $pillory_tenant.genital to 0>>
	<<set $pillory_tenant.broken to 0>>
	<<set $pillory_tenant.lastviewed.day to Time.days>>
	<<set $pillory_tenant.lastviewed.hour to Time.hour>>

	<<person1>>
	<<if $pillory_tenant.special.name is "">>
		一个<<person>><<if _already_served is 0>>正被锁在颈手枷上。<<else>>在不久前刚被锁到颈手枷上<</if>>
		<<endevent>>
		<<npc_pillory_release_schedule>>
		<br><br>
	<<else>>
		流言称<<he>>将被锁到颈手枷上。
		<br>
		<<endevent>>
	<</if>>
<</widget>>

<<widget "imprison_whitney">>
	<<clear_pillory>>
	<<npc Whitney>>
	<<set C.npc.Whitney.state to "pillory">>
	<<set $pillory_tenant.special.name to "Whitney">>
	<<set $pillory_tenant.special.desc to C.npc.Whitney.title>>
	<<new_npc_pillory $NPCList[0]>>
	<<endevent>>
	<<set $framed to 0>>
<</widget>>

<<widget "imprison_leighton">>
	<<clear_pillory>>
	<<npc Leighton>>
	<<set $pillory_tenant.special.name to "Leighton">>
	<<set $pillory_tenant.special.desc to C.npc.Leighton.title>>
	<<new_npc_pillory $NPCList[0]>>
	<<endevent>>
	<<set $framed to 0>>
<</widget>>

<<widget "imprison_npc">> /* number as argument to select npc 0-5. Only use at end of scene. */
	<<clear_pillory>>
	<<if not _args[0]>>
		<<set _id to 0>>
	<<else>>
		<<set _id to _args[0]>>
	<</if>>
	<<if _args[1]>>
		<<set $pillory_tenant.special.desc to _args[1]>>
	<</if>>
	<<new_npc_pillory $NPCList[_id]>>
	<<endevent>>
<</widget>>

<<widget "get_pillory_npc">>
	<<set $NPCList[0] to clone($pillory_tenant.person)>><<person1>>
<</widget>>

<<widget "A_pillory_person">>  /* Can't simplify to <<pillory_person>> because: 'a thin man', but not 'a Whitney') */
	<<silently>><<set _out to "">>
	<<get_pillory_npc>>
	<<if $pillory_tenant.special.name is "">>
		<<set _out += "一个<<person>>">>
	<<else>>
		<<set _out += $pillory_tenant.special.name.replace("Avery","艾弗里").replace("Bailey","贝利").replace("Briar","布莱尔").replace("Charlie","查里").replace("Darryl","达里尔").replace("Doren","多伦").replace("Eden","伊甸").replace("Gwylan","格威岚").replace("Harper","哈珀").replace("Jordan","约旦").replace("Kylar","凯拉尔").replace("Landry","兰德里").replace("Leighton","礼顿").replace("Mason","梅森").replace("Morgan","摩根").replace("River","瑞沃").replace("Robin","罗宾").replace("Sam","萨姆").replace("Sirris","西里斯").replace("Whitney","惠特尼").replace("Winter","温特").replace("Niki","尼奇").replace("Quinn","奎因").replace("Remy","雷米").replace("Alex","艾利克斯").replace("Wren","伦恩").replace("Sydney","悉尼").replace("Taylor","泰勒").replace("Casey","凯西").replace("Ivory Wraith","象牙幽灵").replace("Black Wolf","黑狼").replace("Great Hawk","巨鹰")>>
	<</if>>
	<</silently>><<print _out>>
<</widget>>

<<widget "The_pillory_person">>
	<<silently>><<set _out to "">>
	<<get_pillory_npc>>
	<<if $pillory_tenant.special.name is "">>
		<<set _out += "那<<person>>">>
	<<else>>
		<<set _out += $pillory_tenant.special.name.replace("Avery","艾弗里").replace("Bailey","贝利").replace("Briar","布莱尔").replace("Charlie","查里").replace("Darryl","达里尔").replace("Doren","多伦").replace("Eden","伊甸").replace("Gwylan","格威岚").replace("Harper","哈珀").replace("Jordan","约旦").replace("Kylar","凯拉尔").replace("Landry","兰德里").replace("Leighton","礼顿").replace("Mason","梅森").replace("Morgan","摩根").replace("River","瑞沃").replace("Robin","罗宾").replace("Sam","萨姆").replace("Sirris","西里斯").replace("Whitney","惠特尼").replace("Winter","温特").replace("Niki","尼奇").replace("Quinn","奎因").replace("Remy","雷米").replace("Alex","艾利克斯").replace("Wren","伦恩").replace("Sydney","悉尼").replace("Taylor","泰勒").replace("Casey","凯西").replace("Ivory Wraith","象牙幽灵").replace("Black Wolf","黑狼").replace("Great Hawk","巨鹰")>>
	<</if>>
	<</silently>><<print _out>>
<</widget>>

<<widget "a_pillory_person">>
	<<silently>><<set _out to "">>
	<<get_pillory_npc>>
	<<if $pillory_tenant.special.name is "">>
		<<set _out += "一个<<person>>">>
	<<else>>
		<<set _out += $pillory_tenant.special.name.replace("Avery","艾弗里").replace("Bailey","贝利").replace("Briar","布莱尔").replace("Charlie","查里").replace("Darryl","达里尔").replace("Doren","多伦").replace("Eden","伊甸").replace("Gwylan","格威岚").replace("Harper","哈珀").replace("Jordan","约旦").replace("Kylar","凯拉尔").replace("Landry","兰德里").replace("Leighton","礼顿").replace("Mason","梅森").replace("Morgan","摩根").replace("River","瑞沃").replace("Robin","罗宾").replace("Sam","萨姆").replace("Sirris","西里斯").replace("Whitney","惠特尼").replace("Winter","温特").replace("Niki","尼奇").replace("Quinn","奎因").replace("Remy","雷米").replace("Alex","艾利克斯").replace("Wren","伦恩").replace("Sydney","悉尼").replace("Taylor","泰勒").replace("Casey","凯西").replace("Ivory Wraith","象牙幽灵").replace("Black Wolf","黑狼").replace("Great Hawk","巨鹰")>>
	<</if>>
	<</silently>><<print _out>>
<</widget>>

<<widget "the_pillory_person">>
	<<silently>><<set _out to "">>
	<<get_pillory_npc>>
	<<if $pillory_tenant.special.name is "">>
		<<set _out += "那<<person>>">>
	<<else>>
		<<set _out += $pillory_tenant.special.name.replace("Avery","艾弗里").replace("Bailey","贝利").replace("Briar","布莱尔").replace("Charlie","查里").replace("Darryl","达里尔").replace("Doren","多伦").replace("Eden","伊甸").replace("Gwylan","格威岚").replace("Harper","哈珀").replace("Jordan","约旦").replace("Kylar","凯拉尔").replace("Landry","兰德里").replace("Leighton","礼顿").replace("Mason","梅森").replace("Morgan","摩根").replace("River","瑞沃").replace("Robin","罗宾").replace("Sam","萨姆").replace("Sirris","西里斯").replace("Whitney","惠特尼").replace("Winter","温特").replace("Niki","尼奇").replace("Quinn","奎因").replace("Remy","雷米").replace("Alex","艾利克斯").replace("Wren","伦恩").replace("Sydney","悉尼").replace("Taylor","泰勒").replace("Casey","凯西").replace("Ivory Wraith","象牙幽灵").replace("Black Wolf","黑狼").replace("Great Hawk","巨鹰")>>
	<</if>>
	<</silently>><<print _out>>
<</widget>>

<<widget "pillory_type">>
	<<silently>><<set _out to "">>
	<<get_pillory_npc>>
	<<if $pillory_tenant.special.name is "">>
		<<set _out += "<<person>>">>
	<<else>>
		<<set _out += $pillory_tenant.special.desc.replace("businessperson", "商人").replace("businessman", "商人").replace("businesswoman", "商人").replace("caretaker", "监护人").replace("brothel owner", "妓院老板").replace("dance coach", "舞蹈教练").replace("club owner", "俱乐部老板").replace("English teacher", "英语老师").replace("huntress", "猎人").replace("hunter", "猎人").replace("shopkeeper", "商店店主").replace("doctor", "医生").replace("pious", "虔信者").replace("nun", "修女").replace("monk", "修士").replace("loner", "不合群者").replace("criminal", "罪犯").replace("headteacher", "校长").replace("headmaster", "校长").replace("headmistress", "校长").replace("swimming teacher", "游泳老师").replace("sewer dweller", "下水道居民").replace("maths teacher", "数学老师").replace("orphan", "孤儿").replace("cafe owner", "咖啡店主").replace("science teacher", "科学老师").replace("bully", "霸凌者").replace("history teacher", "历史老师").replace("alpha", "头狼").replace("photographer", "摄影师").replace("mayor", "市长").replace("farmer", "农场主").replace("farmhand", "农工").replace("terror", "恐怖者").replace("smuggler", "走私者").replace("faithful", "信徒").replace("fallen", "堕落者").replace("reflection", "映像").replace("explorer", "探险家").replace("delinquent", "违法者")>>
	<</if>>
	<</silently>><<print _out>>
<</widget>>

<<widget "npc_pillory">>
	<<A_pillory_person>>被锁在小镇的颈手枷上。
	<<npc_pillory_release_schedule>>
	<br><br>
	<<endevent>>
<</widget>>

<<widget "npc_pillory_detail">>
	<<get_pillory_npc>>
	<<A_pillory_person>>被锁在小镇的颈手枷上。
	<<npc_pillory_appearance>>
	<<npc_pillory_abuse>>
	<<npc_pillory_release_schedule>>
	<br><br>
	<<endevent>>
<</widget>>

<<widget "npc_pillory_appearance">>
	<<update_npc_pillory_appearance>>
	/*Desc*/
	<<if Time.dayState is "night">>
		<<if $pillory_tenant.crowd gte 10>>一大群醉醺醺的暴徒围了上来
		<<elseif $pillory_tenant.crowd gte 6>>一大群喧闹的人群聚集在周围
		<<elseif $pillory_tenant.crowd gte 4>>一群险恶的人围在一起
		<<else>>一群人数不多但险恶的团体潜伏在周围
		<</if>>
	<<else>>
		<<if $pillory_tenant.crowd gte 10>>一群兴奋、嘲笑的人群围了上来
		<<elseif $pillory_tenant.crowd gte 6>>一大群人挤在周围
		<<elseif $pillory_tenant.crowd gte 4>>一群好奇的人在附近徘徊
		<<else>>一小群人在看着
		<</if>>
	<</if>>一个<<pillory_type>>被锁在颈手枷上。
	<<if $pillory_tenant.broken gte 32>><<He>>看起来受到了创伤，也许因为已经遭受的虐待而永远地崩溃了。
	<<elseif $pillory_tenant.broken gte 16>><<He>>正因所遭受的虐待而哭泣着。
	<<elseif $pillory_tenant.broken gte 8>><<He>>正因那些欺压而哭泣着。
	<<elseif $pillory_tenant.broken gte 4>><<He>>虽然很不安，但努力掩饰着。
	<<else>><<He>>目中无人，一脸不屑。
	<</if>>
	<br>

	/*describe exposure*/
	<<if $pillory_tenant.upperexposed gte 3>>
		<<His>>的$pillory_tenant.person.breastsdesc完全暴露在人群中。
		<<if $pillory_tenant.spank gte 8>><<His>>的乳头通红，被捏、拍打、吸吮、咬和拉扯过。
		<<elseif $pillory_tenant.spank gte 4>><<His>>的乳头看起来因虐待而疼痛。
		<</if>>
	<<elseif $pillory_tenant.upperexposed gte 2>>
		<<if $pronoun is "f">>
			<<His>>赤裸着上身，仅剩一副可怜的胸罩将<<his>>的$pillory_tenant.person.breastsdesc挡住。
		<<else>>
			<<His>>赤裸着上身，把那$pillory_tenant.person.breastsdesc完全暴露了在人群之中。
			<<if $pillory_tenant.spank gte 8>><<His>>乳头通红,被捏,拍打,咬和拉扯过.
			<<elseif $pillory_tenant.spank gte 4>><<His>>的乳头看起来因虐待而疼痛。
			<</if>>
		<</if>>
	<<elseif $pillory_tenant.upperexposed gte 1>><<His>>上衣被撕破，把<<his>>的<<if $pronoun is "f">>胸罩<<else>>$pillory_tenant.person.breastsdesc<</if>>暴露在了人群之中。
	<</if>>
	<<if $pillory_tenant.lowerexposed gte 2>><<His>>的屁股<<if $pillory_tenant.upperexposed gte 1>>也<</if>>已经被暴露，这使得
		<<if $pillory_tenant.person.gender is "f">><<his>>的小穴
		<<else>><<his>> $pillory_tenant.person.penisdesc
		<</if>>人人都能看到。
		<<if $pillory_tenant.spank gte 5>><<His>>屁股有被粗暴对待过的迹象
			<<if $pillory_tenant.fruit gte 5>>被拍打着，并且<<his>>那<<if $pillory_tenant.face gte 2>>被精液<<if $pillory_tenant.face gte 4>>涂满的<<else>>粘到的<</if>><</if>>脸上尽是淤青和烂水果。
			<<else>>被拍打着。
			<</if>>
		<<elseif $pillory_tenant.fruit gte 6>><<His>><<if $pillory_tenant.face gte 2>><<if $pillory_tenant.face gte 4>>沾满<<else>>沾有<</if>>精液<</if>>的脸上满是淤青和碎水果。
		<<elseif $pillory_tenant.fruit gte 2>><<His>><<if $pillory_tenant.face gte 2>><<if $pillory_tenant.face gte 4>>沾满<<else>>沾有<</if>>精液<</if>>的脸上满是伤痕和碎水果。
		<</if>>
		<<if $pillory_tenant.ass gte 2>><<His>>屁股被强奸的次数不止
			<<if $pillory_tenant.genital gte 2>>一次,而且
				<<if $pillory_tenant.person.gender is "m">>史莱姆覆盖着<<his>><<print either("raw","abused","sorry")>>肉棒.
				<<else>>精液从<<his>><<print either("袒露","红肿","被残虐")>>的小穴中<<if $pillory_tenant.genital gte 4>>流出<<else>>滴落<</if>>。
				<</if>>
			<<else>>一次.
			<</if>>
		<<elseif $pillory_tenant.genital gte 5>><<His>>的<<if $pillory_tenant.person.gender is "m">>肉棒<<else>>小穴<</if>>正被人残暴的凌辱着。
		<<elseif $pillory_tenant.genital gte 2>><<He>>看上去被侵犯了不止一次。
		<</if>>
	<<elseif $pillory_tenant.lowerexposed gte 1>>
		<<His>><<if $pronoun is "f">>衣服被拉起越过腰部,<<else>>裤子被拉下,<</if>>
		把<<his>>的内衣暴露在了人群之中。
	<<elseif $pillory_tenant.wet is 2>><<His>>衣服被雨淋湿了。
	<<elseif $pillory_tenant.wet is 1>><<His>>透明的衣服在慢慢地变干。
	<</if>>
	<<if $pillory_tenant.upperexposed is 0 and $pillory_tenant.lowerexposed is 0 and $pillory_tenant.face is 0 and $pillory_tenant.fruit gte 1>>
		<<if $pillory_tenant.fruit gte 6>><<His>>脸上满是伤痕和烂水果。
		<<elseif $pillory_tenant.fruit gte 2>><<His>>的脸上满是瘀伤和碎水果。
		<</if>>
	<</if>>
<</widget>>

<<widget "update_npc_pillory_appearance">>
	<<if ($pillory_tenant.lastviewed.day isnot Time.days) or (Time.hour gte $pillory_tenant.lastviewed.hour + 2)>>
		/* last viewed time tracked to avoid this firing on every viewing */
		<<set $pillory_tenant.lastviewed.day to Time.days>>
		<<set $pillory_tenant.lastviewed.hour to Time.hour>>

		/*Weather effects*/
		<<if $weather is "rain">><<set $pillory_tenant.wet to 2>>
		<<elseif $pillory_tenant.wet is 2>><<set $pillory_tenant.wet to 1>>
		<<else>><<set $pillory_tenant.wet to 0>>
		<</if>>

		/*Chance of abuse based on crowd and time passed*/
		<<if Time.days - $pillory_tenant.startday is 2>><<set _chance to 24>>
		<<elseif Time.days - $pillory_tenant.startday is 1>><<set _chance to 12>>
		<<else>><<set _chance to (Time.hour - $pillory_tenant.starthour)>>
		<</if>>
		<<set _chance *= $pillory_tenant.crowd>>
		/*increased by spectacle*/
		<<set _factor to ($pillory_tenant.upperexposed + $pillory_tenant.lowerexposed + $pillory_tenant.fruit
							+ $pillory_tenant.spank + $pillory_tenant.face + $pillory_tenant.ass + $pillory_tenant.genital)>>
		<<if Time.dayState is "night">><<set _factor += 3>><</if>>
		<<if $pillory_tenant.wet is 2>><<set _factor += 4>><</if>>
		<<set _prob to (_chance * _factor)>>

		/*Out of sight changes to tenant */
		<<rng>>
		<<if $rng gte (40 - _prob)>><<set $pillory_tenant.fruit += 1>><</if>>
		<<rng>>
		<<if $rng gte (60 - _prob)>><<set $pillory_tenant.crowd += 2>><</if>>
		<<rng>>
		<<if $rng gte (60 - _prob)>><<set $pillory_tenant.upperexposed += 1>><</if>>
		<<rng>>
		<<if $rng gte (80 - _prob)>><<set $pillory_tenant.lowerexposed += 1>><</if>>
		<<rng>>
		<<if $rng gte (100 - _prob)>><<set $pillory_tenant.crowd += 2>><</if>>
		<<rng>>
		<<if $rng gte (100 - _prob)>><<set $pillory_tenant.fruit += 2>><<set $pillory_tenant.face += 1>><</if>>
		<<rng>>
		<<if $rng gte (100 - _prob) and $pillory_tenant.lowerexposed gte 2>><<set $pillory_tenant.spank += 2>><<else>><<set $pillory_tenant.spank += 1>><</if>>
		<<rng>>
		<<if $rng gte (100 - _prob) and $pillory_tenant.lowerexposed gte 2>><<set $pillory_tenant.genital += 1>><</if>>
		<<rng>>
		<<if $rng gte (100 - _prob) and $pillory_tenant.lowerexposed gte 2>><<set $pillory_tenant.ass += 1>><</if>>

		/*lock down exposure and replenish fruit */
		<<if $pillory_tenant.upperexposed gte 3>><<if $pillory_tenant.person.gender is "f" or $pillory_tenant.person.pronoun is "f">><<set $pillory_tenant.upperexposed to 3>><<else>><<set $pillory_tenant.upperexposed to 2>><</if>><</if>>
		<<if $pillory_tenant.lowerexposed gt 2>><<set $pillory_tenant.lowerexposed to 2>><</if>>
		<<set $pillory_tenant.fruitstock to 3>>
		<<set $pillory_tenant.broken += ($pillory_tenant.ass + $pillory_tenant.genital + $pillory_tenant.face + $pillory_tenant.fruit + $pillory_tenant.spank)>>
	<</if>>
<</widget>>

<<widget "npc_pillory_abuse">>
	<br>
	<<if ($pillory_tenant.lastviewed.day isnot Time.days) or (Time.hour gte $pillory_tenant.lastviewed.hour + 1)>>
		<<set $pillory_tenant.lastviewed.hour to Time.hour>>
		<<rng>><<generate2>><<person2>>
		<<set _ly to either("violently","openly","angrily","furiously","cheekily","repeatedly","clumsily","roughly","theatrically","dutifully","merrily","gleefully","drunkenly","ineptly")>>
		<<if Time.dayState isnot "night">>
			<<if $rng gte 56>> /* 45% chance of jeer and shout only, 55% chance of something active */
				一群人在一个<<person>>的带领下，开始对犯人大声地嘲笑和辱骂。
			<<elseif $rng gte 41>> /* 15% */
				<<rng>>
				<<if $pillory_tenant.person.pronoun is "f" and $rng gte 40>> /* 60% if upper-exposed F */
					一个穿着粗糙的农民服装的<<person>>拿着铁桶向着颈手枷走去。
					在把水桶放在<<pillory_type>>的胸部下面后，<<person2>><<he>>
					<<if $pillory_tenant.upperexposed lte 1>>囚犯的上衣被移除了,<</if>>
					<<if $pillory_tenant.upperexposed lte 2>><<set $pillory_tenant.upperexposed to 3>>的胸罩被脱了下来,<</if>>
					抓住<<pillory_type>>的$pillory_tenant.person.breastsdesc，并开始尝试将奶水挤进桶里。
					<br><br>
					<<if $rng % 3 is 0>>
						<<if $rng % 2>>
							乳汁从她的胸部喷涌而出。农夫微笑着很快掌握了节奏，熟练地开始用手挤着双乳。
							<br>
							"好姑娘，"那个农夫揉了揉<<the_pillory_person>>的头发，然后带着几乎满满的水桶离开了。
						<<else>><<set $pillory_tenant.spank += 1>>
							乳汁从<<pillory_type>>的乳房中滴落下来，在持续不断地挤压和拉扯的下，农夫最终
							在挤了相当多的乳汁之后，她的$pillory_tenant.person.breastsdesc看起来红肿不堪。
							<br>
							农夫拍了拍囚犯的头，然后带着 <<person2>><<his>>那半满的铁桶离开了。
						<</if>>
					<<else>><<set $pillory_tenant.spank += 1>>
						尽管拉动与挤压变得愈发的粗暴，但乳汁还是没有出来。
						<<if $rng % 2>>
							<<person2>><<person>>了口气，然后拍了拍她的头。 "可怜的女孩，你都干涸了。"
							<br>
							<<He>>走到<<pillory_type>>的后面，然后
							<<if $pillory_tenant.lowerexposed lte 1>>脱掉了<<his>><<print either("丝绸内裤","单色内裤","破损内裤","男式短裤")>>,
							<<else>>将<<his>>的臀瓣分开，<</if>><<if $pillory_tenant.person.gender is "f">>把<<his>>的小穴<<else>>把<<his>>的屁股<</if>>暴露在了所有人的面前。
							<br>
							"这头牛没奶了，"<<person2>><<he>>向人群呼喊，<<if $pillory_tenant.person.gender is "f">>"来个人给她添个牛犊。"<<else>>"来个人填满她。"<</if>>
							<br>
							<<He>>拿着空桶走了。
							<<set $pillory_tenant.lowerexposed to 2>>
						<<else>>
							在得知什么也挤不出来之后，农夫叹了口气，失望地带着空桶离开了。
						<</if>>
						<br>
					<</if>>
				<<elseif $pillory_tenant.person.gender is "m" and $rng gte 40>>
					一个穿着粗糙的农民服装的<<person>>拿着透明玻璃杯向着颈手枷靠近。
					<br>
					把一个玻璃罐放在了<<pillory_type>>的乳房下方，随后<<person2>><<he>>
					<<if $pillory_tenant.lowerexposed lte 0>><<if $pillory_tenant.person.pronoun is "m">>拉下囚犯的裤子,<<else>>撩起囚犯的裙子,<</if>><</if>>
					<<if $pillory_tenant.lowerexposed lte 1>><<set $pillory_tenant.lowerexposed to 2>><<if $pillory_tenant.person.pronoun is "m">>脱掉底裤,<<else>>脱掉内裤,<</if>><</if>>
					抓住囚犯的$pillory_tenant.person.penisdesc，并开始摩擦。
					囚犯看起来被震惊住了——之后是愤怒，最后又成了矛盾。<<person1>><<he>>最终在嘲笑声中射了出来，填满了靠近的透明玻璃杯，重又回归到了震惊之中。
					<<person2>>
					<<if $rng % 3>>
						农夫朝玻璃杯里瞥了一眼，又开始磨蹭那个囚犯的下体……手法非常的娴熟，甚至在一旁玩起了手机。
						用一只手扶着罐子，然后用另一只手让那个<<pillory_type>>来到高潮.
						<br>
						十分钟后，农夫端着一杯精液走开了，而<<the_pillory_person>>仍被挂在颈手枷上，脸上的表情
						在震惊、羞愧、痛苦和满足之间徘徊。
					<<else>><<set $pillory_tenant.spank += 1>>
						那个农夫一手拿着<<his>>的手机，另一只手则在试图让<<pillory_type>>重新达到高潮。
						<br>
						大概过了一分钟左右，那个农夫困惑的抬起头，然后对那个<<the_pillory_person>>的不回应感到恼火。
						那个<<person2>><<person>>从<<his>>的口袋里掏出一个装置，然后将装置的一端夹在那个<<pillory_type>>的阴茎根部,
						并将另一端深深地插入了囚犯的菊穴里。
						<br>
						农夫按下一个按钮。伴随着一声响亮的电子噼啪声，<<the_pillory_person>>不停地叫喊、抽搐着，身体开始持续不断地高潮。
						<br>
						浏览手机约20秒后，<<person2>><<person>>关掉设备，看了一眼玻璃杯，满意地点了点头。
						<br>
						人群全神贯注地看着农夫重复着过程，一遍又一遍，直到精液填满了杯子，农夫才欣然离开。
						<<the_pillory_person>>瘫软地挂在颈手枷上，<<his>>的脸因痛苦、羞耻和一种奇怪的满足而抽搐扭曲着。
					<</if>>
					<br>
				<<elseif $pillory_tenant.person.gender is "f" and $rng gte 20>>
					一个穿着粗糙的农民服装的<<person>>拿着玻璃杯向颈手枷靠近。
					<br>
					把烧杯放在<<pillory_type>>腹股沟下，随后<<person2>><<he>>
					<<if $pillory_tenant.lowerexposed lte 0>><<if $pillory_tenant.person.pronoun is "f">>拉起犯人的裙子,<<else>>下犯人的裤子,<</if>><</if>>
					<<if $pillory_tenant.lowerexposed lte 1>><<set $pillory_tenant.lowerexposed to 2>><<if $pillory_tenant.person.pronoun is "f">>脱下她的内裤,<<else>>脱掉他的内裤,<</if>><</if>>
					贴近囚犯的小穴开始摩擦了起来。
					片刻的震惊之后，<<the_pillory_person>>抿着嘴，让自己屈服于这种堕落，任由冰冷的金属塞进
					<<his>>的小穴。不过片刻之后，<<he>>脸上的表情就变为了惊恐——有什么东西夹住了<<he>>的阴蒂。强烈的电流顿时袭来，<<he>>尖叫着扭动着身躯。
					<br>
					人群全神贯注地看着<<the_pillory_person>>在高潮中颤抖着扭动。农夫则一脸淡定，拿着
					用烧杯接着<<the_pillory_person>>体内流出的液体的同时浏览着<<person2>><<his>>的手机。
					最后，农夫关掉并取走了<<his>>的机器。<<Hes>>耸了耸肩，看着手机拿着
					装满液体的烧杯满意地离开了
					<br>
					<<The_pillory_person>>看起来羞愧异常，脸上的表情在震惊、羞耻和性疲惫之间来回转换着。
				<<else>>
					<<if Time.month > 4 && Time.month < 9 and $rng % 4>>
						<<set _bug to either("bee","wasp","bumblebee")>>
						一只_bug围着<<The_pillory_person>>转来转去。<<him>>害怕地大喊大叫，无助地扭动拍打着。
						<br>
						<<if $rng % 3 is 0>>
							一位好心的旁观者挥手将_bug赶走。
						<<elseif $rng % 3 is 1>>
							人群哄堂大笑，最终_bug失去了兴趣，慢悠悠地飞走了。
						<<else>>
							<<if $pillory_tenant.lowerexposed is 2 and $rng % 2>>
								<<if $pronoun is "m">><<set _part to either("butt","upper leg","inner thigh","dick","balls","hip")>>
								<<else>><<set _part to either("ass","leg","inner thigh","pussy","hip")>>
								<</if>>
							<<elseif $pillory_tenant.upperexposed gte 3 and $pronoun is "f">>
								<<set _part to either("breast","nipple","armpit","ribs","midriff","back")>>
							<<elseif $pillory_tenant.upperexposed gte 2>>
								<<set _part to either("chest","armpit","ribs","belly","back")>>
							<<else>>
								<<set _part to either("arm","shoulder","cheek","leg","waist","wrist","elbow")>>
							<</if>>
							<<He>><<print either("大叫着","尖叫着","抱怨着","哭叫着")>>祈求虫子的离开，_part传来阵阵刺痛。
						<</if>>
					<<else>>
						一个愤怒的<<monk>>从神殿责骂人群的道德沦丧。
						许多人看起来很惭愧，有些人离开了。
						<<set $pillory_tenant.crowd -= 1>>
						<<if $pillory_tenant.upperexposed + $pillory_tenant.lowerexposed gte 1>>
							<<set $pillory_tenant.upperexposed to 0>><<set $pillory_tenant.lowerexposed to 0>>
							那个<<monk>>最终通过更换<<pillory_type>>的衣服来恢复<<his>>的尊严。
						<</if>>
					<</if>>
				<</if>>
			<<elseif $rng gte 36>> /* 5% */
				一个<<person>>朝那个<<pillory_type>>扔水果，由于无法移动或抵御，水果直接击中了<<him>>的脸。
				这看起来很痛，尤其是在<<he>>无法擦掉眼睛里的汁液时。
				<<set $pillory_tenant.fruit += 1>>
			<<elseif $rng gte 26>> /* 10% */
				一个<<person>>把水果扔向<<pillory_type>>，但却没有丢中。
			<<elseif $rng gte 16>> /* 10% */
				一个<<person>>走到颈手枷前，轻轻地抚摸起<<pillory_type>>的<<if $pronoun is "f">>乳房。<<else>>蛋蛋.<</if>>
			<<elseif $rng gte 11 and $pillory_tenant.upperexposed lt 3>>/* 5% */
				一个<<person>>走到那个<<pillory_type>>面前，然后
				<<if $pillory_tenant.upperexposed is 2>>
					<<if $pronoun is "f">>
					_ly脱掉<<his>>的胸罩，把$pillory_tenant.person.breastsdesc直直地暴露在了嘲笑的人群面前。
					<<else>>
					_ly扭着<<his>>的乳头。
					<<set $pillory_tenant.spank += 1>>
					<</if>>
				<<elseif $pillory_tenant.upperexposed is 1>>
					<<if $pronoun is "f">>
					脱掉了<<his>>的上衣，只留下可怜的胸罩暴露在嘲笑的人群面前。
					<<else>>
					脱掉了<<his>>的上衣，就这样把$pillory_tenant.person.breastsdesc暴露在了嘲笑的人群面前。
					<</if>>
				<<else>>
					<<if $pronoun is "f">>
					在嘲笑声中掀起<<his>>的上衣，让胸罩在人群面前一闪而过。
					<<else>>
					掀起<<his>>的上衣，把大半块胸部暴露在了嘲笑的人群面前。
					<</if>>
				<</if>><<set $pillory_tenant.upperexposed += 1>>
			<<elseif $rng gte 6 and $pillory_tenant.lowerexposed lt 2>>/* 5% */
				一个<<person>>走到<<the_pillory_person>>前，并
				<<if $pillory_tenant.lowerexposed is 1>>
					<<if $pillory_tenant.person.gender is "f">>脱掉<<pillory_type>>的内衣，将<<his>>的屁股和阴部完全暴露在嘲笑的人群面前。
					<<else>>完全脱下<<pillory_type>>的内衣，将<<his>>的屁股和<<his>>的$pillory_tenant.person.penisdesc暴露在正在嘲笑的人群面前。
					<</if>>
				<<else>>
					<<if $pronoun is "f">>掀起了<<pillory_type>>的裙子,<<else>>脱下来<<his>>的裤子,<</if>>把<<his>>的内衣暴露给了正在嘲笑的观众.
				<</if>><<set $pillory_tenant.lowerexposed += 1>>
			<<else>><<set $pillory_tenant.spank += 1>>/* 5% */
				一个<<person>>走到<<pillory_type>>前，并狠狠地拍打<<him>>的屁股。啪啪的声音回荡在整个街道上。
			<</if>>
		<<else>> /*night*/
			<<if $rng gte 86>> /* 15% chance of jeer and shout only, 85% chance of something active */
				一群人在一个<<person>>的带领下对犯人放肆嘲笑着。
			<<elseif $rng gte 81>> /* 5% */
				一个<<person>>把水果扔向<<pillory_type>>，因为无法防御和闪躲，水果直接打在了<<the_pillory_person>>的脸上，这引起了一片欢呼声.
				这看起来很痛，尤其是在<<he>>无法擦掉眼睛里的汁液时。
				<<set $pillory_tenant.fruit += 1>>
			<<elseif $rng gte 76>> /* 5% */
				一个<<person>>把水果扔向<<pillory_type>>，但却没有丢中。
			<<elseif $pillory_tenant.person.pronoun is "f" and $pillory_tenant.upperexposed lt 3>>
				<<set $pillory_tenant.upperexposed to 3>>
				一个<<person>>走到那个无助的<<pillory_type>>面前，然后脱掉了<<his>>所有的上衣，把<<his>>的<<if $pronoun is "f">>$pillory_tenant.person.breastsdesc<<else>>胸部<</if>>暴露在人群前。
			<<elseif $pillory_tenant.person.pronoun is "m" and $pillory_tenant.upperexposed lt 2>>
				<<set $pillory_tenant.upperexposed to 2>>
				一个<<person>>走到那个无助的<<pillory_type>>面前，然后脱掉了<<his>>所有的上衣，把<<his>>的<<if $pronoun is "f">>$pillory_tenant.person.breastsdesc<<else>>胸部<</if>>暴露在人群前。
			<<elseif $pillory_tenant.lowerexposed lt 2>>
				<<set $pillory_tenant.lowerexposed to 2>>
				一个<<person>>走到无助的<<pillory_type>>前，脱掉了<<his>>下身所有的衣服，把<<his>>的<<if $pillory_tenant.person.gender is "f">>小穴<<else>>$pillory_tenant.person.penisdesc<</if>>就这样直直地暴露在人群的面前。口哨声顿时响起，一片欢呼雀跃。
			<<elseif $rng gte 66>> /* 10% */
				一个<<person>>试图煽动附近的狗爬到犯人赤裸的屁股上。它
				<<if $rng % 2>>对着<<the_pillory_person>>的屁股试探地闻了几下,但
				<</if>>不感兴趣.
			<<elseif $rng gte 58>> /* 8% */
				<<set $pillory_tenant.spank += 1>>
				一个<<person>>偷偷溜到颈手枷后，然后_ly打向<<pillory_type>>那裸露的<<if $pillory_tenant.person.gender is "f">>小穴，<<else>>蛋蛋。<</if>>当<<he>>发出痛苦的嚎叫声时，人群无情嘲笑了起来。
			<<elseif $rng gte 51>> /* 7% */
				<<set $pillory_tenant.spank += 2>><br>
				某个你在学校附近见过但从未上过课的老师正醉醺醺地走向颈手枷。
				<<if $pillory_tenant.special.name is "Whitney">>
					<br><<set $pillory_tenant.spank += 1>>
					"嘿，你好啊，惠特尼!<<print either("很高兴在这里见到你!","看看这是谁啊!","你被困在那里了吗？多么不幸啊!","这不是一个大转变吗?","在这里看到你真是个惊喜!")>>"<<he>>边说边笑道。
					"<<print either("我们都知道，这是你应得的.","我们都知道你是有资格获得这个待遇的.","而今天的课程将是关于后果的问题。","还记得你给我起的那个刻薄绰号吗?","还记得你那天在我的课上做了什么吗？")>>"
				<<elseif $pillory_tenant.special.name is "Leighton">>
					<br><<set $pillory_tenant.spank += 1>>
					"嗯，你好,是你吗，老板？"<<he>>说着的同时躲在颈手枷后面尽量不让人发现。
					"<<print either("我想现在是时候进行一些'匿名员工反馈'了.","还记得你说过的'残忍是为了仁慈'吗？'","所以我想现在轮到你来做一些 '坦率和诚实的反馈'了。?","那么，这是表达员工不满的'正确论坛'吗？")>>"
				<<else>><br>
					"喂，你好，"<<he>>咧嘴笑着说道。
					"<<print either("看起来你很调皮.","纪律是很重要的.","这不是一个可爱的夜晚吗？你不觉得吗？看看那轮圆月!")>>"
				<</if>><br>
				<<He>>开始打<<pillory_type>>的屁股，直到<<person2>><<his>>的手臂打到发软为止.当<<person1>><<person>>因痛苦而嚎叫时，人群爆发出一阵一阵的嘲笑声。
			<<elseif $rng gte 41>> /* 10% */
				<<set $pillory_tenant.face += 1>>
				一个<<person>>走到颈手枷前，_ly在<<pillory_type>>面前自慰。
				<<person2>><<if $pronoun is "m">>的精液很快就溅到了<<the_pillory_person>>的脸上。
				<<else>><<He>>用<<his>>的下体摩擦着<<the_pillory_person>><<person2>>的脸，直到达到高潮为止。
				<</if>>人群欢呼雀跃，笑声不断.
			<<elseif $rng gte 31>> /* 10% */
				<<set $pillory_tenant.ass += 1>>
				一个<<person>>走到颈手枷后，_ly<<if $pronoun is "m">>强暴着<<else>>指奸着<</if>><<pillory_type>>的菊穴。而人群则为<<person2>><<him>>欢呼了起来。
			<<elseif $rng gte 21>> /* 10% */
				<<set $pillory_tenant.genital += 1>>
				一个<<person>>走到颈手枷后，_ly<<if $pronoun is "m">>强暴着<<the_pillory_person>><<else>>用穿戴式假阳具强暴着<<the_pillory_person>><</if>>。而人群则为<<person2>><<him>>拍照欢呼。
			<<elseif $rng gte 11>> /* 10% */
				<<set $pillory_tenant.genital += 1>><<set $pillory_tenant.ass += 1>>
				人群围观並拍下流浪狗_ly强暴<<the_pillory_person>>的照片。一个<<person2>><<person>><<print either("用饼干","拍拍它的頭","用甜食","奶油面包")>>奖励这只狗狗。
				<br>
				众人享受着这样的变态的景象，颈项伸得很长，仿佛许多鸭，被无形的手捏住了似的，向上提着。
			<<elseif $rng gte 6 and maleChance() gt 0 and (maleChance() lt 100 or $pillory_tenant.person.gender isnot "m")>> /* 5% - with men allowed */
				<<set $pillory_tenant.ass += 1>><<set $pillory_tenant.face += 1>>
				<<if $rng % 3 is 0>>一对下班的警察走了过来.当他们给<<person>>做笔录时,<<else>>两个男人靠了过来.他们一块<</if>>
				<<if $pillory_tenant.person.gender is "m">>对着菊穴<<else>>_ly <</if>>和<<the_pillory_person>>做起了3P。人群享受这精彩的表演.
			<<elseif $rng gte 6 and maleChance() lt 100 and (maleChance() gt 0 or $pillory_tenant.person.gender isnot "f")>> /* 5% - with women allowed */
				<<set $pillory_tenant.ass += 1>><<set $pillory_tenant.face += 1>>
				<<if $rng % 3 is 0>>一对下班的女警察走过来.当他们让<<person>>做笔录时,<<else>>两个女人靠了过来.他们一块<</if>>
				<<if $pillory_tenant.person.gender is "m">>对着菊穴<<else>>_ly <</if>>和<<the_pillory_person>>用穿戴式假阳具做起了3P。人群享受这精彩的表演.
			<<else>> /* 5% */
				<<set $pillory_tenant.spank += 1>>
				一个<<person>>走到<<pillory_type>>前，并狠狠地拍打<<him>>的屁股。啪啪的声音回荡在整个街道上。
			<</if>>
		<</if>>
	<<else>>/* already abused this hour - no action, don't want spamming this scene to accelerate things ridiculously */
		周围的人都在<<print either("嘲笑着","取笑着","指指点点着","大声辱骂着","奚落着","嘲弄着","嘲讽着")>>
		<<if Time.schoolDay and ((Time.hour gte 7 and Time.hour lte 8) or Time.hour is 15) and $rng lte 34>>
			<<pillory_type>>. 附近学校的一群学生在路过时目瞪口呆的看着
			<<if $pillory_tenant.lowerexposed gte 2 or $pillory_tenant.upperexposed gte 3>>那个裸露得很淫荡的犯人。
				<<if $rng % 3 is 0>>
				一个愤怒的旁观者跑到颈手枷上，把<<pillory_type>>的衣服换了下来。
				<<set $pillory_tenant.lowerexposed to 0>><<set $pillory_tenant.upperexposed to 0>><</if>>
			<<else>>囚犯。
			<</if>>
		<<elseif Time.dayState isnot "night">>
			<<if $rng lte 80>>
				那个<<pillory_type>>并<<print either("窃窃私语着.","拍照","嘲笑了起来.")>>
			<<elseif $rng lte 93>>
				那个<<pillory_type>>，其中一部分人厌倦的离开了.
				<<set $pillory_tenant.crowd -= 1>>
			<<else>>
				那个<<pillory_type>>.一辆公交车在附近停下，其中一些人下车并加入了围观颈手枷的人群中。
				<<set $pillory_tenant.crowd += 1>>
			<</if>>
		<<else>>
			<<if $rng lte 67>>
				<<if $pillory_tenant.lowerexposed gte 2 and $rng % 4 is 0>>那个<<pillory_type>>并在<<his>>那裸露的屁股旁边摆着姿势自拍.
				<<else>><<pillory_type>>，同时还对着<<his>><<print either("自言自语。","喝上一杯。","投掷酒瓶。","进行诅咒。","一起拍照。","手冲打胶。")>>
				<</if>>
			<<elseif $rng lte 85>>
				那个<<pillory_type>>.有些人在觉得累了之后便离开了。
				<<set $pillory_tenant.crowd -= 1>>
			<<else>>
				那个<<pillory_type>>.一些路过的人加入了围观颈手枷的人群中。
				<<set $pillory_tenant.crowd += 1>>
			<</if>>
		<</if>>
	<</if>>
	<<if $pillory_tenant.upperexposed gte 3>><<if $pillory_tenant.person.gender is "f" or $pillory_tenant.person.pronoun is "f">><<set $pillory_tenant.upperexposed to 3>><<else>><<set $pillory_tenant.upperexposed to 2>><</if>><</if>>
	<<if $pillory_tenant.lowerexposed gt 2>><<set $pillory_tenant.lowerexposed to 2>><</if>>
<</widget>>

<<widget "npc_pillory_release_schedule">>
	<<get_pillory_npc>>
	<br>
	<<if Time.days is $pillory_tenant.endday>>
	<<set _a_few to ($pillory_tenant.endhour - Time.hour)>>
		<<He>>将在
		<<if _a_few gt 0>>_a_few小时后被释放。
		<<else>>时间快到了。
		<</if>>
	<<else>>
		<<set _days_left to ($pillory_tenant.endday - Time.days)>>
		<<He>>预定要被释放于<<if _days_left is 1>>明天<<else>>两天后<</if>>的
		<<switch $pillory_tenant.endhour>>
			<<case 0>>午夜时。
			<<case 12>>中午时。
			<<default>><<ampm $pillory_tenant.endhour>>.
		<</switch>>
	<</if>>
	<<endevent>>
<</widget>>

<<widget "end_npc_pillory">>
	<<get_pillory_npc>>
	<<if Time.minute lte 15>>
		一个警察<<print either("正在释放","刚刚释放","正在努力释放","即将释放")>>
		<<the_pillory_person>>.<<if $weather is "rain">><<His>>的衣服被淋湿得能够看透.<<elseif $weather is "snow">><<He>>冻得发抖.<</if>>
	<<elseif Time.minute lte 30>>
		<<The_pillory_person>>跌跌撞撞地离开了颈手枷，眼睛<<print either("里含着泪水","里流露出蔑视","里满是痛苦","里带着愤怒")>>。
		<<if $weather is "rain">><<His>>衣服被雨淋透了.<</if>>
	<<else>>
		<<The_pillory_person>>终于被释放了。几个职员正在清理颈手枷上的污痕。
	<</if>>
	<<set $rng += $pillory_tenant.duration>>
	<<if $rng gte 67 or $rng gte 33 and $weather is "rain">>一大批人群发出嘲笑和叫喊声.<</if>>
	<br><br>
	<<clear_pillory>>
	<<endevent>>
<</widget>>

<<widget "clear_pillory">>
	<<if $pillory_tenant and $pillory_tenant.special.name is "Whitney">>
		<<set C.npc.Whitney.state to "active">>
	<</if>>
	<<setup_pillory>>
<</widget>>

<<widget "drench">>
	<!-- Drench PC in lewd liquid(s). First arguments set filth type: semen(default), goo, nectar or multiple. Last argument sets level 1-5 (default 1). Body interiors will be ignored if "outside" is specified as any of the arguments. -->
	<!-- valid examples: <<drench>> <<drench goo nectar 3 outside>><<drench outside 2>> -->
	<!-- invalid example: <<drench 3 semen>> -->
	<<set $_outside to _args.includes("outside") ? "outside" : "all">>
	<!-- "outside" can appear as the last argument, if so - delete it so the $_amount will be properly detected -->
	<<run _args.delete("outside")>>
	<<set $_amount to Number.isInteger(_args.last()) ? Math.clamp(_args.last(), 1, 5) : 1>>
	<<set $_goo to _args.includesAny("goo", "slime", "liquid") ? "goo" : "">>
	<<set $_nectar to _args.includes("nectar") ? "nectar" : "">>
	<<set $_semen to (_args.includesAny("semen","cum") || ($_goo + $_nectar).length === 0) ? "semen" : "">>
	<<set $hygiene to 3000>>
	<<bodyliquid $_outside $_semen $_goo $_nectar $_amount>>
<</widget>>

<<widget "awarenessup">>
	<<set _awareness to _args[1]>>
	<<if $awareness gte _args[0]>>
		<span class="pink">没有什么是你不知道的。</span>
	<<else>>
		<<gawareness>><<awareness _awareness>>
	<</if>>
<</widget>>

<<widget "linkradiogroup">>
	<<set _receiver_name to _args[0]>>
	<<set _options to _args[1]>>
	<<set _set_value to State.getVar(_receiver_name)>>

	<span class="no-numberify">
		<<for _label, _value range _options>>
			<<capture _receiver_name, _value>>
				<span @class="(_set_value is _value ? 'goldLink' : '')">
					<<link _label>>
						<<run State.setVar(_receiver_name, _value)>>
						<<run Engine.show()>> <!-- refresh the page without leaving it -->
					<</link>>
				</span>
			<</capture>>
			|
		<</for>>
	</span>
<</widget>>

<<widget "deskText">>
<<if $studyBooks is undefined>>
	<<set $studyBooks to {}>>
	<<set $studyBooks.rented to "none">>
	<<set $studyBooks.stolen to "none">>
<</if>>
<<set _desk to Furniture.get('desk')>>
<<set _chair to Furniture.get('chair')>>
<<set _projectOptions to [$scienceproject, $mathsproject].includes("ongoing")>>
<<set _bookOptions to [$studyBooks.stolen, $studyBooks.rented].includesAny("Raul and Janet","Pinch")>>
<<set _wardrobe to Furniture.get('wardrobe')>>
<<set _playOptions to ($englishPlay is 'ongoing' and $englishPlayRoles.Player isnot 'none')>>

<<if _projectOptions || _playOptions || _bookOptions || $christmas_gift is "clothes_unwrapped" || ($christmas_gift_robin and $christmas_gift_robin_wrapped isnot 1)>>
	<<if _args[0] is "noicon">>
		你的_desk.nameCap和<<if _chair.name isnot "chair">>一张<</if>>_chair.nameCap占据着你衣柜旁那狭小的空间。
		<br>
		<<projectoptions>>
		<<homeStudyOptions>>
		<<christmas_options>>
		<br>
	<</if>>
<<else>>
	<<if _args[0] is "icon">>
		<br>
		<<deskchairicon>>你的_desk.nameCap和<<if _chair.name isnot "chair">>一张<</if>>_chair.nameCap占据着你衣柜旁那狭小的空间。
	<</if>>
<</if>>
<</widget>>


<<widget "tableText">>
<<set _table to Furniture.get('table')>>
<<set _chair to Furniture.get('chair')>>
<<if $pregnancyStats.parasiteDoctorEvents gte 2>>
	<<if _args[0] is "noicon">>
		<<if _table>>
			<br>
			你的_table.nameCap<<if _chair and _chair.name isnot "chair">>和你的一把_chair.nameCap<<else>><</if>>位于墙边。
			<br>
		<<elseif _chair and _chair.name isnot "chair">>
			<br>
			你的一张_chair.nameCap紧靠着墙。
			<br>
		<<else>>
			<br>
			你的鱼缸放在地板上。
			<br>
		<</if>>
		<<fishtankicon>><<containersLink>>
	<</if>>
<<else>>
	<<if _args[0] is "icon">>
		<<if _table>>
			<br>
			<<bedroomtablechairicon>>你的_table.nameCap<<if _chair and _chair.name isnot "chair">>和另一张_chair.nameCap<<else>><</if>>紧挨在墙壁边上。
		<<elseif _chair and _chair.name isnot "chair">>
			<br>
			<<bedroomtablechairicon>>另有一张_chair.nameCap紧挨在墙壁边上。
		<</if>>
	<</if>>
<</if>>
<</widget>>

<<widget "radiogroup">>
	<<set _receiver_name to _args[0]>>
	<<set _possible_values_by_label to _args[1]>>
	<<set _set_value to State.getVar(_receiver_name)>>

	<<for _label, _value range _possible_values_by_label>>
		<label>
		<<if _set_value is _value>>
			<<radiobutton _receiver_name _value checked>>
		<<else>>
			<<radiobutton _receiver_name _value>>
		<</if>>
		_label
		</label>
	<</for>>
<</widget>>

<<widget "settextcolorfromfemininity">>
	<<if _args[0] gt 0>>
		<<set _text_color to "pink">>
	<<elseif _args[0] lt 0>>
		<<set _text_color to "lblue">>
	<<else>>
		<<set _text_color to "">>
	<</if>>
<</widget>>

<<widget "settextcolorfromgender">>
	<<if _args[0] is "f">>
		<<set _text_color to "pink">>
	<<elseif _args[0] is "m">>
		<<set _text_color to "lblue">>
	<<else>>
		<<set _text_color to "">>
	<</if>>
<</widget>>

<<widget "cheatStart">>
	<<set $cheatdisable to "f">><<set $money to 500000>>
	<<set $rentmoney to 10000>><<rentmod>>
	<<set $renttime to 7>><<set $rentday to Time.weekDay>>
	<<set $rentstage to 1>>
<</widget>>

<<widget "swim_check">>
	<<if ($worn.upper.type.includes("naked") or $worn.upper.type.includes("swim")) and
	($worn.lower.type.includes("naked") or $worn.lower.type.includes("swim")) and
	($worn.under_upper.type.includes("naked") or $worn.under_upper.type.includes("swim")) and
	($worn.under_lower.type.includes("naked") or $worn.under_lower.type.includes("swim"))>>
		<<set _swim_check to 1>>
	<</if>>
<</widget>>

<<widget "skulduggeryuse">>
	<<if _args[0] is true>>
		<!-- This argument lets us use skulduggery without adding extra linebreaks that make formatting things a nightmare. -->
		<<if $skulduggery lte ($skulduggerydifficulty + 100)>>
			<<combatskulduggeryskilluse>>
		<<else>>
			<span class="blue">这对你来说实在太简单了，你什么都没有学到。</span>
		<</if>>
	<<else>>
		<<if $skulduggery lte ($skulduggerydifficulty + 100)>>
			<<skulduggeryskilluse>>
		<<else>>
			<span class="blue">这对你来说实在太简单了，你什么都没有学到。</span>
			<br><br>
		<</if>>
	<</if>>
<</widget>>

<<widget "wetness_init">>
	<<if $objectVersion.vaginaWetness lt 3 or $objectVersion.vaginaWetness is undefined>>
		<<set $vaginaWetness to 0>>
		<<set $trackedArousal to [0]>>
		<<set $masturbation_vaginaFluid to 0>>
		<<set $vaginaArousalWetness to 0>>
		<<set $timeSinceArousal to 0>>

		<<set $objectVersion.vaginaWetness to 3>>
	<</if>>
<</widget>>

<<widget "hand_gag">>/*First arg the NPC index. Second arg the hand used.*/
	<<if !$worn.face.type.includes("gag") and _args[0] isnot undefined>>
		<<if _args[1] is "left">>
			<<set $mouthuse to "lefthand">><<set $NPCList[_args[0]].lefthand to "mouth">>
		<<else>>
			<<set $mouthuse to "righthand">><<set $NPCList[_args[0]].righthand to "mouth">>
		<</if>>
	<</if>>
<</widget>>

<<widget "prop">>
	<<for _i = 0; _i < _args.length; _i++>>
		<<set $prop.push(_args[_i])>>
	<</for>>
<</widget>>

<<widget "schoolrep">>
	<<if _args[0] and _args[1] and (!$worn.face.type.includes("mask") or _args[1] lt 0)>>
		<<if $schoolrep[_args[0]] lt 5 or _args[1] lt 0>>
			<<if _args[0] is "crossdress" and ($daily.school.crossdress is undefined or _args[1] lt 0)>>
				<<set $daily.school.crossdress to 1>>
				<<set $schoolrep[_args[0]] += _args[1]>>
				<<if $schoolrep.crossdress gte 5>>
					<<set $genderknown.pushUnique("Kylar")>>
					<<set $genderknown.pushUnique("Whitney")>>
					<<set $genderknown.pushUnique("Sydney")>>
					<<set $genderknown.pushUnique("Sirris")>>
					<<set $genderknown.pushUnique("River")>>
					<<set $genderknown.pushUnique("Doren")>>
					<<set $genderknown.pushUnique("Winter")>>
					<<set $genderknown.pushUnique("Mason")>>
					<<set $genderknown.pushUnique("Leighton")>>
					<<set $school_crossdress_message to 5>>
				<<elseif $schoolrep.crossdress gte 1 and _args[1] gte 1>>
					<<set $school_crossdress_message to $schoolrep.crossdress>>
				<</if>>
				<<set $schoolrep.crossdress = Math.clamp($schoolrep.crossdress, 0, 5)>>
			<<elseif _args[0] is "herm" and ($daily.school.herm is undefined or _args[1] lt 0)>>
				<<set $daily.school.herm to 1>>
				<<set $schoolrep[_args[0]] += _args[1]>>
				<<if $schoolrep.herm gte 5>>
					<<set $genderknown.pushUnique("Kylar")>>
					<<set $genderknown.pushUnique("Whitney")>>
					<<set $genderknown.pushUnique("Sydney")>>
					<<set $genderknown.pushUnique("Sirris")>>
					<<set $genderknown.pushUnique("River")>>
					<<set $genderknown.pushUnique("Doren")>>
					<<set $genderknown.pushUnique("Winter")>>
					<<set $genderknown.pushUnique("Mason")>>
					<<set $genderknown.pushUnique("Leighton")>>
					<<set $school_herm_message to 5>>
				<<elseif $schoolrep.herm gte 1 and _args[1] gte 1>>
					<<set $school_herm_message to $schoolrep.herm>>
				<</if>>
				<<set $schoolrep.herm = Math.clamp($schoolrep.herm, 0, 5)>>
			<</if>>
		<</if>>
	<</if>>
<</widget>>

<<widget "schoolrep_naked">>
	<<if !playerChastity("hidden")>>
		<<if $player.gender is "h">>
			<<schoolrep herm 1>>
		<<elseif $player.gender isnot $player.gender_appearance>>
			<<schoolrep crossdress 1>>
		<</if>>
	<</if>>
<</widget>>

<<widget "event_trigger">>
	<<set $danger to random(1, 10000)>>
	<<if $danger gte (9900 - $allure)>>
		<<set $event_trigger to 1>>
	<</if>>
<</widget>>

<<widget "combat_lewdity_text">>
	<<combat_promiscuity_text>>
	<<combat_deviancy_text>>
<</widget>>

<<widget "adjust_school_traits">>
	<<if $science gte 1000>>
		<<set $sciencetrait to 4>>
	<<elseif $science gte 700>>
		<<set $sciencetrait to 3>>
	<<elseif $science gte 400>>
		<<set $sciencetrait to 2>>
	<<elseif $science gte 200>>
		<<set $sciencetrait to 1>>
	<<else>>
		<<set $sciencetrait to 0>>
	<</if>>
	<<if $maths gte 1000>>
		<<set $mathstrait to 4>>
	<<elseif $maths gte 700>>
		<<set $mathstrait to 3>>
	<<elseif $maths gte 400>>
		<<set $mathstrait to 2>>
	<<elseif $maths gte 200>>
		<<set $mathstrait to 1>>
	<<else>>
		<<set $mathstrait to 0>>
	<</if>>
	<<if $english gte 1000>>
		<<set $englishtrait to 4>>
	<<elseif $english gte 700>>
		<<set $englishtrait to 3>>
	<<elseif $english gte 400>>
		<<set $englishtrait to 2>>
	<<elseif $english gte 200>>
		<<set $englishtrait to 1>>
	<<else>>
		<<set $englishtrait to 0>>
	<</if>>
	<<if $history gte 1000>>
		<<set $historytrait to 4>>
	<<elseif $history gte 700>>
		<<set $historytrait to 3>>
	<<elseif $history gte 400>>
		<<set $historytrait to 2>>
	<<elseif $history gte 200>>
		<<set $historytrait to 1>>
	<<else>>
		<<set $historytrait to 0>>
	<</if>>
	<<set $english to Math.clamp($english, 0, 1000)>>
	<<set $maths to Math.clamp($maths, 0, 1000)>>
	<<set $science to Math.clamp($science, 0, 1000)>>
	<<set $history to Math.clamp($history, 0, 1000)>>
<</widget>>

/*
	Argument 1 is base amount. You can also use decimals.
	Argument 2 is variation.
	Argument 3 is crime.
	<<moneyGain 1>> will give £1.00 which is not stolen.
	<<moneyGain 1 false false>> will give £1.00 which is not stolen.
	<<moneyGain 1 true>> will give between £0.80 and £1.20 which is not stolen.
	<<moneyGain 1 true true>> will give between £0.80 and £1.20 which is stolen, and can scale further with skulduggery.
	<<moneyGain 1 false true>> will give £1.00 which is stolen, and can scale with skulduggery.
*/
<<widget "moneyGain">><<silently>>
	<<if _args[0]>>
		<<set _base_amount to _args[0] * 100>>
	<<else>>
		<<set _base_amount to 100>>
	<</if>>
	<<if _args[1]>>
		<<set _variation to Math.floor(random(Math.floor(_base_amount / 5 * -1), Math.floor(_base_amount / 5)))>>
	<<else>>
		<<set _variation to 0>>
	<</if>>
	<<if _args[2]>>
		<<set _skulduggeryMulti to (1 + (currentSkillValue('skulduggery') / 2000))>>
	<<else>>
		<<set _skulduggeryMulti to 1>>
	<</if>>
	<<set _money_gain to Math.floor((_base_amount + _variation) * _skulduggeryMulti)>>
	<<if _args[2]>>
		<<crimeup `_money_gain / 100`>>
	<</if>>
	<<set $money += _money_gain>>
<</silently>><<printmoney _money_gain>><</widget>>

/*
	Used like above, but only shows the money amount, doesn't add money or crime.
	Use <<crimeup `_money_gain / 100`>> and <<set $money += _money_gain>> where necessary in links, etc.
*/
<<widget "moneyGainDisplay">><<silently>>
	<<if _args[0]>>
		<<set _base_amount to _args[0] * 100>>
	<<else>>
		<<set _base_amount to 100>>
	<</if>>
	<<if _args[1]>>
		<<set _variation to Math.floor(random(Math.floor(_base_amount / 5 * -1), Math.floor(_base_amount / 5)))>>
	<<else>>
		<<set _variation to 0>>
	<</if>>
	<<if _args[2]>>
		<<set _skulduggeryMulti to (1 + (currentSkillValue('skulduggery') / 2000))>>
	<<else>>
		<<set _skulduggeryMulti to 1>>
	<</if>>
	<<set _money_gain to Math.floor((_base_amount + _variation) * _skulduggeryMulti)>>
<</silently>><<printmoney _money_gain>><</widget>>

<<widget "formatmoney">>
	<<set _printargs to Math.floor(Math.abs(_args[0]/100)).toLocaleString("en-GB")>>
	<<set _printargs to _printargs + (_args[0] % 100 ? "." + ("0" + Math.floor(Math.abs(_args[0] % 100))).slice(-2) : "")>>
	<<set _printmoney to (_args[0] gte 0 ? "" : "-") + "£" + _printargs>>
<</widget>>

<<widget "printmoney">><<silently>><!-- (amount in pennies, highlight toggle) -->
	<<if _args.length gt 2 or typeof(_args[0]) isnot "number">><!-- sanity checks -->
		<<set _printmoney to '<span class="red">printmoney error: invalid arguments: _args</span>'>>
	<<else>>
		<<formatmoney _args[0]>>
	<</if>>
	<<set _text_output to `<span @class='_args[1]?_args[1]:"gold"'>` + _printmoney + '</span>'>>
<</silently>><<print _text_output>><</widget>>

<<widget "sadism">>
	<<if _args[0]>>
		<<set $sadism += _args[0]>>
		<<set $sadism to Math.clamp($sadism, 0, 1000)>>
	<</if>>
<</widget>>

<<widget "masochism">>
	<<if _args[0]>>
		<<set $masochism += _args[0]>>
		<<set $masochism to Math.clamp($masochism, 0, 1000)>>
	<</if>>
<</widget>>

<<widget "enable_rescue">>
	<<set $rescue to 1>>
<</widget>>

<<widget "hypnotised">>
	<<if _args[0]>>
		<<set $hypnotised += _args[0]>>
	<</if>>
<</widget>>

<<widget "giftSexToys">>
	<!-- _args[0] is the named NPC. -->
	<!-- Currently only works for strap-ons. Will need a refactor when other toy scenes are written. -->
	<<run window.handSextoysGiftToNPC(_args[0])>>
	<<set _strapons to checkIfNPCHasCategorySextoy(_args[0],"strap-on")>>
	<<if _strapons.length > 0>>
		<<for _i = 0; _i lt _strapons.length; _i++>>
			<<if _strapons[_i].shape is undefined>>
				<<set _strapons[_i].shape to "dildo">>
			<</if>>
			<<if _strapons[_i].prefixdescriptor is undefined>>
				<<set _strapons[_i].prefixdescriptor to "">>
			<</if>>
			<<generateNewStrapon _strapons[_i].size _strapons[_i].colour _strapons[_i].shape>>
			<<giveNNPCnewstrapon _args[0]>>
		<</for>>
	<</if>>
<</widget>>

<<widget "bodyliquid">><<silently>>
	<!-- first argument is either bodypart, all, outside, inside, or clear (required) -->
	<!-- second and later arguments are liquid types (semen, goo, nectar, or all; at least one required) -->
	<!-- last argument is optional and if numeric - specifies the amount (default: 1) -->

	<!-- process first argument and delete it so <<bodyliquid all all>> will work as expected -->
	<<set $_bodypart to _args[0]>>
	<<run _args.deleteAt(0)>>
	<<set $_clear to $_bodypart is "clear">>
	<<switch $_bodypart>>
		<<case "all" "clear">>
			<!-- use clone() to make sure we're not modifying setup -->
			<<set $_bodypart to clone(setup.bodyliquid.bodyparts)>>
		<<case "outside">>
			<<set $_bodypart to clone(setup.bodyliquid.bodyparts)>>
			<<run $_bodypart.delete(setup.bodyliquid.innerbodyparts)>>
		<<case "inside">>
			<<set $_bodypart to clone(setup.bodyliquid.innerbodyparts)>>
		<<default>>
			<<if setup.bodyliquid.bodyparts.includes($_bodypart)>>
				<<set $_bodypart to [$_bodypart]>>
			<<else>>
				<<set $_fail to true>>
			<</if>>
		<!--/case -->
	<</switch>>
	<<if !$_fail>>
		<<if !V.player.penisExist>>
			<<run $_bodypart.delete("penis")>>
		<</if>>
		<<if !V.player.vaginaExist>>
			<<run $_bodypart.delete("vagina", "vaginaoutside")>>
		<</if>>
		<<if $_bodypart.length is 0 and $options.debugdisable is "f">>
			<<run console.log(Utils.GetStack(), "- attempt to slap bodyliquid on nonexistent genitals failed successfully")>>
		<</if>>
	<</if>>

	<!-- select which liquids to modify, fail if none -->
	<<if $_clear or _args.includes("all")>>
		<<set $_liquids to clone(setup.bodyliquid.liquidtype)>>
	<<else>>
		<<set $_liquids to []>>
		<<if _args.includesAny("goo", "slime", "fluid")>>
			<!-- "slime" alternative because slime is a common descriptor -->
			<!-- "fluid" alternative for <<tentacleadv>> -->
			<<set $_liquids.push("goo")>>
		<</if>>
		<<if _args.includes("nectar")>>
			<<set $_liquids.push("nectar")>>
		<</if>>
	<</if>>
	<<if _args.includesAny("cum", "semen")>>
		<!-- "cum" alternative because cum is a common descriptor -->
		<<set $_liquids.push("semen")>>
	<</if>>
	 <<if $_liquids.length is 0>>
		<<set $_fail to true>>
	 <</if>>

	<!-- process The Final Argument, if integer - assume amount, else default to 1 -->
	<<if $_clear>>
		<<set $_amount to -10>>
	<<elseif Number.isInteger(_args.last())>>
		<<set $_amount to _args.last()>>
	<<else>>
		<<set $_amount to 1>>
	<</if>>

	<<if $_fail is true>>
	<<else>>
		<<for $_part range $_bodypart>>
			<<for $_type range $_liquids>>
				<<set $player.bodyliquid[$_part][$_type] to Math.clamp($player.bodyliquid[$_part][$_type] + $_amount, 0, 5)>>
			<</for>>
		<</for>>
	<</if>>
	<</silently>>
	<<if $options.debugdisable is "f" and $_fail is true>>
		<<error {
			message	: `bodyliquid widget on ${Utils.GetStack()} failed, please report`,
			source	: `Arguments: ${$_bodypart} | ${_args[0]} | ${_args[1]} | ${_args[2]} | ${_args[3]}.`
		}>>
	<</if>>
<</widget>>


<<widget "semenswallowedstat">>
	<<if $statFreeze isnot true and $args[0] isnot undefined>>
		<<set $semenswallowedstat += $args[0]>>
	<</if>>
<</widget>>

<<widget "animalsemenswallowedstat">>
	<<if $statFreeze isnot true and $args[0] isnot undefined>>
		<<set $animalsemenswallowedstat += $args[0]>>
	<</if>>
<</widget>>
